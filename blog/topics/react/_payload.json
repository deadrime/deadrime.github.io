[{"data":1,"prerenderedAt":8666},["ShallowReactive",2],{"articles_react":3},[4,6007],{"id":5,"title":6,"body":7,"date":5993,"description":5994,"extension":5995,"meta":5996,"navigation":92,"path":5997,"previewImg":5998,"seo":5999,"stem":6000,"topics":6001,"__hash__":6006},"articles/blog/implementing-own-redux-toolkit.md","Пишем свой redux-toolkit",{"type":8,"value":9,"toc":5983},"minimark",[10,15,39,68,72,75,630,634,640,1145,1148,1152,1161,1228,1231,1357,1360,1363,1366,1458,1461,1471,1477,1486,2202,2205,2214,2234,2237,2456,2463,2467,2479,2528,2546,2553,2633,2637,2644,2651,2654,2718,2725,2728,2759,2762,2773,2779,3001,3005,3012,3570,3615,3619,5325,5616,5693,5979],[11,12,14],"h2",{"id":13},"motivation","Мотивация",[16,17,18,19,23,24,27,28,31,32,27,35,38],"p",{},"Как правило мы задумываемся о глобальном стейте, когда приложение обрастает какой-то сложной бизнес логикой и прокидывать пропсы становится больно.\nВ случае с более менее легкой бизнес логикой можно обойтись ",[20,21,22],"code",{},"React Context",". Но когда уже не хватает и его - на помощь приходит стейт менеджер,\nнапример редакс. Обычно в качестве примера использования редакса показывают TODO лист, что на мой взгляд тупо - мне трудно представить\nсебе туду лист, который был бы достаточно сложен, что для него бы мог потребоваться глобальный стейт.\nСкорее вы будете хранить в стейте профиль авторизованного юзера или какие-то сложные структуры,\nкоторые нужно уметь находить разными способами, скажем ",[20,25,26],{},"profileById",", ",[20,29,30],{},"profileByUsername"," или ",[20,33,34],{},"noteIdsByWeekTs",[20,36,37],{},"noteIdsByDayTs",".",[16,40,41,42,50,51,55,56,59,60,63,64,67],{},"Глобальный стейт решает 3 основный задачи - хранить, записывать и доставать данные. Чем удобнее, тем лучше.\nRedux предлагает редьюсеры, экшены и селекторы для этих задач.\nЕсли говорить про ",[43,44,49],"a",{"href":45,"rel":46,"target":48},"https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers",[47],"nofollow","_blank","стандартную реализацию",",\nто про про удобство говорить не приходится, switch case конструкция для экшенов - это боль.\nРазработчики редакса тоже так подумали и изобрели красивую обертку под названием ",[52,53,54],"strong",{},"Redux Toolkit.","\nОднако они умудрились превратить ",[52,57,58],{},"3.33 kB"," в ",[52,61,62],{},"37 kB"," и это наталкивает на мысль, что они напихали слишком много лишнего.\nВозможно, им следовало бы остановиться на методе ",[20,65,66],{},"createSlice",",\nкоторый позволяет создавать редьюсер и экшены без лишней головной боли, а так же хуке useSlectors.\nИменно эти вещи я и хочу реализовать самостоятельно. Это будет интересно еще и точки зрения типизации.",[11,69,71],{"id":70},"api","API",[16,73,74],{},"Для начала нужно прикинуть, что именно мы хотим получить на выходе.\nВ рамках данной статьи я хочу реализовать метод createSlice, где можно было бы создать экшены и селекторы,\nа так же useSelector для доступа к данным из реакт компонента и dispatch для вызова экшенов",[76,77,83],"pre",{"className":78,"code":79,"filename":80,"language":81,"meta":82,"style":82},"language-ts shiki shiki-themes github-light github-dark","\ntype User = {\n  id: string;\n  username: string;\n  displayName: string;\n}\n\nexport const usersSlice = createSlice({\n  name: 'users',\n  defaultState: {\n    userById: {} as Record\u003Cstring, User>,\n    usernameById: {} as Record\u003Cstring, string>,\n  },\n  actions: {\n    addUser: (state, user: User) => {\n      // state должен иметь тот же тип, что и defaultState\n      state.userById[user.id] = user;\n      state.usernameById[user.username] = user.id;\n    },\n    deleteUser: (state, userId: string) => {\n      const user = state.userById[userId];\n      delete state.usernameById[user.username];\n      delete state.userById[userId];\n    }\n  },\n  selectors: {\n    selectUserByUsername: (state, username: string) => state.userById[state.usernameById[username]],\n  }\n});\n\nusersSlice.actions;// экшены\nusersSlice.selectors;// селекторы\n\n// ...\n\n// SomeComponent.tsx\n\n// user Должен иметь тип User\nconst user = useSelector(state => state.selectUserByUsername(state.users, 'someUsername'));\n\nconst addUser = useCallback(() => {\n  dispatch(\n    // Аргументом addUser должен быть объект User\n    usersSlice.actions.addUser({\n      id: '2',\n      username: 'username2',\n      displayName: 'some display name',\n    })\n  );\n}, [dispatch]);\n","usersSlice.ts","ts","",[20,84,85,94,112,129,141,153,159,164,184,197,203,229,249,255,261,290,297,309,320,326,351,365,374,381,387,392,398,424,430,436,441,450,459,464,470,475,481,486,492,528,533,553,562,568,579,590,601,612,618,624],{"__ignoreMap":82},[86,87,90],"span",{"class":88,"line":89},"line",1,[86,91,93],{"emptyLinePlaceholder":92},true,"\n",[86,95,97,101,105,108],{"class":88,"line":96},2,[86,98,100],{"class":99},"szBVR","type",[86,102,104],{"class":103},"sScJk"," User",[86,106,107],{"class":99}," =",[86,109,111],{"class":110},"sVt8B"," {\n",[86,113,115,119,122,126],{"class":88,"line":114},3,[86,116,118],{"class":117},"s4XuR","  id",[86,120,121],{"class":99},":",[86,123,125],{"class":124},"sj4cs"," string",[86,127,128],{"class":110},";\n",[86,130,132,135,137,139],{"class":88,"line":131},4,[86,133,134],{"class":117},"  username",[86,136,121],{"class":99},[86,138,125],{"class":124},[86,140,128],{"class":110},[86,142,144,147,149,151],{"class":88,"line":143},5,[86,145,146],{"class":117},"  displayName",[86,148,121],{"class":99},[86,150,125],{"class":124},[86,152,128],{"class":110},[86,154,156],{"class":88,"line":155},6,[86,157,158],{"class":110},"}\n",[86,160,162],{"class":88,"line":161},7,[86,163,93],{"emptyLinePlaceholder":92},[86,165,167,170,173,176,178,181],{"class":88,"line":166},8,[86,168,169],{"class":99},"export",[86,171,172],{"class":99}," const",[86,174,175],{"class":124}," usersSlice",[86,177,107],{"class":99},[86,179,180],{"class":103}," createSlice",[86,182,183],{"class":110},"({\n",[86,185,187,190,194],{"class":88,"line":186},9,[86,188,189],{"class":110},"  name: ",[86,191,193],{"class":192},"sZZnC","'users'",[86,195,196],{"class":110},",\n",[86,198,200],{"class":88,"line":199},10,[86,201,202],{"class":110},"  defaultState: {\n",[86,204,206,209,212,215,218,221,223,226],{"class":88,"line":205},11,[86,207,208],{"class":110},"    userById: {} ",[86,210,211],{"class":99},"as",[86,213,214],{"class":103}," Record",[86,216,217],{"class":110},"\u003C",[86,219,220],{"class":124},"string",[86,222,27],{"class":110},[86,224,225],{"class":103},"User",[86,227,228],{"class":110},">,\n",[86,230,232,235,237,239,241,243,245,247],{"class":88,"line":231},12,[86,233,234],{"class":110},"    usernameById: {} ",[86,236,211],{"class":99},[86,238,214],{"class":103},[86,240,217],{"class":110},[86,242,220],{"class":124},[86,244,27],{"class":110},[86,246,220],{"class":124},[86,248,228],{"class":110},[86,250,252],{"class":88,"line":251},13,[86,253,254],{"class":110},"  },\n",[86,256,258],{"class":88,"line":257},14,[86,259,260],{"class":110},"  actions: {\n",[86,262,264,267,270,273,275,278,280,282,285,288],{"class":88,"line":263},15,[86,265,266],{"class":103},"    addUser",[86,268,269],{"class":110},": (",[86,271,272],{"class":117},"state",[86,274,27],{"class":110},[86,276,277],{"class":117},"user",[86,279,121],{"class":99},[86,281,104],{"class":103},[86,283,284],{"class":110},") ",[86,286,287],{"class":99},"=>",[86,289,111],{"class":110},[86,291,293],{"class":88,"line":292},16,[86,294,296],{"class":295},"sJ8bj","      // state должен иметь тот же тип, что и defaultState\n",[86,298,300,303,306],{"class":88,"line":299},17,[86,301,302],{"class":110},"      state.userById[user.id] ",[86,304,305],{"class":99},"=",[86,307,308],{"class":110}," user;\n",[86,310,312,315,317],{"class":88,"line":311},18,[86,313,314],{"class":110},"      state.usernameById[user.username] ",[86,316,305],{"class":99},[86,318,319],{"class":110}," user.id;\n",[86,321,323],{"class":88,"line":322},19,[86,324,325],{"class":110},"    },\n",[86,327,329,332,334,336,338,341,343,345,347,349],{"class":88,"line":328},20,[86,330,331],{"class":103},"    deleteUser",[86,333,269],{"class":110},[86,335,272],{"class":117},[86,337,27],{"class":110},[86,339,340],{"class":117},"userId",[86,342,121],{"class":99},[86,344,125],{"class":124},[86,346,284],{"class":110},[86,348,287],{"class":99},[86,350,111],{"class":110},[86,352,354,357,360,362],{"class":88,"line":353},21,[86,355,356],{"class":99},"      const",[86,358,359],{"class":124}," user",[86,361,107],{"class":99},[86,363,364],{"class":110}," state.userById[userId];\n",[86,366,368,371],{"class":88,"line":367},22,[86,369,370],{"class":99},"      delete",[86,372,373],{"class":110}," state.usernameById[user.username];\n",[86,375,377,379],{"class":88,"line":376},23,[86,378,370],{"class":99},[86,380,364],{"class":110},[86,382,384],{"class":88,"line":383},24,[86,385,386],{"class":110},"    }\n",[86,388,390],{"class":88,"line":389},25,[86,391,254],{"class":110},[86,393,395],{"class":88,"line":394},26,[86,396,397],{"class":110},"  selectors: {\n",[86,399,401,404,406,408,410,413,415,417,419,421],{"class":88,"line":400},27,[86,402,403],{"class":103},"    selectUserByUsername",[86,405,269],{"class":110},[86,407,272],{"class":117},[86,409,27],{"class":110},[86,411,412],{"class":117},"username",[86,414,121],{"class":99},[86,416,125],{"class":124},[86,418,284],{"class":110},[86,420,287],{"class":99},[86,422,423],{"class":110}," state.userById[state.usernameById[username]],\n",[86,425,427],{"class":88,"line":426},28,[86,428,429],{"class":110},"  }\n",[86,431,433],{"class":88,"line":432},29,[86,434,435],{"class":110},"});\n",[86,437,439],{"class":88,"line":438},30,[86,440,93],{"emptyLinePlaceholder":92},[86,442,444,447],{"class":88,"line":443},31,[86,445,446],{"class":110},"usersSlice.actions;",[86,448,449],{"class":295},"// экшены\n",[86,451,453,456],{"class":88,"line":452},32,[86,454,455],{"class":110},"usersSlice.selectors;",[86,457,458],{"class":295},"// селекторы\n",[86,460,462],{"class":88,"line":461},33,[86,463,93],{"emptyLinePlaceholder":92},[86,465,467],{"class":88,"line":466},34,[86,468,469],{"class":295},"// ...\n",[86,471,473],{"class":88,"line":472},35,[86,474,93],{"emptyLinePlaceholder":92},[86,476,478],{"class":88,"line":477},36,[86,479,480],{"class":295},"// SomeComponent.tsx\n",[86,482,484],{"class":88,"line":483},37,[86,485,93],{"emptyLinePlaceholder":92},[86,487,489],{"class":88,"line":488},38,[86,490,491],{"class":295},"// user Должен иметь тип User\n",[86,493,495,498,500,502,505,508,510,513,516,519,522,525],{"class":88,"line":494},39,[86,496,497],{"class":99},"const",[86,499,359],{"class":124},[86,501,107],{"class":99},[86,503,504],{"class":103}," useSelector",[86,506,507],{"class":110},"(",[86,509,272],{"class":117},[86,511,512],{"class":99}," =>",[86,514,515],{"class":110}," state.",[86,517,518],{"class":103},"selectUserByUsername",[86,520,521],{"class":110},"(state.users, ",[86,523,524],{"class":192},"'someUsername'",[86,526,527],{"class":110},"));\n",[86,529,531],{"class":88,"line":530},40,[86,532,93],{"emptyLinePlaceholder":92},[86,534,536,538,541,543,546,549,551],{"class":88,"line":535},41,[86,537,497],{"class":99},[86,539,540],{"class":124}," addUser",[86,542,107],{"class":99},[86,544,545],{"class":103}," useCallback",[86,547,548],{"class":110},"(() ",[86,550,287],{"class":99},[86,552,111],{"class":110},[86,554,556,559],{"class":88,"line":555},42,[86,557,558],{"class":103},"  dispatch",[86,560,561],{"class":110},"(\n",[86,563,565],{"class":88,"line":564},43,[86,566,567],{"class":295},"    // Аргументом addUser должен быть объект User\n",[86,569,571,574,577],{"class":88,"line":570},44,[86,572,573],{"class":110},"    usersSlice.actions.",[86,575,576],{"class":103},"addUser",[86,578,183],{"class":110},[86,580,582,585,588],{"class":88,"line":581},45,[86,583,584],{"class":110},"      id: ",[86,586,587],{"class":192},"'2'",[86,589,196],{"class":110},[86,591,593,596,599],{"class":88,"line":592},46,[86,594,595],{"class":110},"      username: ",[86,597,598],{"class":192},"'username2'",[86,600,196],{"class":110},[86,602,604,607,610],{"class":88,"line":603},47,[86,605,606],{"class":110},"      displayName: ",[86,608,609],{"class":192},"'some display name'",[86,611,196],{"class":110},[86,613,615],{"class":88,"line":614},48,[86,616,617],{"class":110},"    })\n",[86,619,621],{"class":88,"line":620},49,[86,622,623],{"class":110},"  );\n",[86,625,627],{"class":88,"line":626},50,[86,628,629],{"class":110},"}, [dispatch]);\n",[11,631,633],{"id":632},"implementation","Реализация",[16,635,636,637,639],{},"Для начала определимся с параметрами ",[20,638,66],{}," и набросаем небольшой черновик:",[76,641,643],{"className":78,"code":642,"language":81,"meta":82,"style":82},"type SliceActionCreator\u003CState, Payload = any> = (\n  state: State,\n  payload: Payload\n) => void;\n\ntype SliceSelector\u003CState, Payload = unknown, SelectorReturn = unknown> = (\n  state: State,\n  payload: Payload\n) => SelectorReturn;\n\ntype CreateSliceProps\u003C\n  Name extends string,\n  State extends Record\u003Cstring, unknown>,\n  Actions extends Record\u003Cstring, SliceActionCreator\u003CState>>,\n  Selectors extends Record\u003Cstring, SliceSelector\u003CState>>\n> = {\n  name: Name;\n  actions: Actions;\n  defaultState: State;\n  selectors: Selectors;\n};\n\nexport const createSlice = \u003C\n  Name extends string,\n  State extends Record\u003Cstring, unknown>,\n  Actions extends Record\u003Cstring, SliceActionCreator\u003CState>>,\n  Selectors extends Record\u003Cstring, SliceSelector\u003CState>>\n>({\n    name,\n    actions,\n    defaultState,\n    selectors,\n  }: CreateSliceProps\u003CName, State, Actions, Selectors>) => {\n  let sliceActions; // TODO\n  let reducer; // TODO\n  let sliceSelectors; // TODO\n\n  return {\n    reducer,\n    selectors: sliceSelectors,\n    actions: sliceActions,\n  };\n};\n\n",[20,644,645,675,687,697,708,712,747,757,765,776,780,790,802,822,847,872,880,892,904,915,927,932,936,949,959,977,999,1021,1026,1031,1036,1041,1046,1081,1092,1101,1110,1114,1121,1126,1131,1136,1141],{"__ignoreMap":82},[86,646,647,649,652,654,657,659,662,664,667,670,672],{"class":88,"line":89},[86,648,100],{"class":99},[86,650,651],{"class":103}," SliceActionCreator",[86,653,217],{"class":110},[86,655,656],{"class":103},"State",[86,658,27],{"class":110},[86,660,661],{"class":103},"Payload",[86,663,107],{"class":99},[86,665,666],{"class":124}," any",[86,668,669],{"class":110},"> ",[86,671,305],{"class":99},[86,673,674],{"class":110}," (\n",[86,676,677,680,682,685],{"class":88,"line":96},[86,678,679],{"class":117},"  state",[86,681,121],{"class":99},[86,683,684],{"class":103}," State",[86,686,196],{"class":110},[86,688,689,692,694],{"class":88,"line":114},[86,690,691],{"class":117},"  payload",[86,693,121],{"class":99},[86,695,696],{"class":103}," Payload\n",[86,698,699,701,703,706],{"class":88,"line":131},[86,700,284],{"class":110},[86,702,287],{"class":99},[86,704,705],{"class":124}," void",[86,707,128],{"class":110},[86,709,710],{"class":88,"line":143},[86,711,93],{"emptyLinePlaceholder":92},[86,713,714,716,719,721,723,725,727,729,732,734,737,739,741,743,745],{"class":88,"line":155},[86,715,100],{"class":99},[86,717,718],{"class":103}," SliceSelector",[86,720,217],{"class":110},[86,722,656],{"class":103},[86,724,27],{"class":110},[86,726,661],{"class":103},[86,728,107],{"class":99},[86,730,731],{"class":124}," unknown",[86,733,27],{"class":110},[86,735,736],{"class":103},"SelectorReturn",[86,738,107],{"class":99},[86,740,731],{"class":124},[86,742,669],{"class":110},[86,744,305],{"class":99},[86,746,674],{"class":110},[86,748,749,751,753,755],{"class":88,"line":161},[86,750,679],{"class":117},[86,752,121],{"class":99},[86,754,684],{"class":103},[86,756,196],{"class":110},[86,758,759,761,763],{"class":88,"line":166},[86,760,691],{"class":117},[86,762,121],{"class":99},[86,764,696],{"class":103},[86,766,767,769,771,774],{"class":88,"line":186},[86,768,284],{"class":110},[86,770,287],{"class":99},[86,772,773],{"class":103}," SelectorReturn",[86,775,128],{"class":110},[86,777,778],{"class":88,"line":199},[86,779,93],{"emptyLinePlaceholder":92},[86,781,782,784,787],{"class":88,"line":205},[86,783,100],{"class":99},[86,785,786],{"class":103}," CreateSliceProps",[86,788,789],{"class":110},"\u003C\n",[86,791,792,795,798,800],{"class":88,"line":231},[86,793,794],{"class":103},"  Name",[86,796,797],{"class":99}," extends",[86,799,125],{"class":124},[86,801,196],{"class":110},[86,803,804,807,809,811,813,815,817,820],{"class":88,"line":251},[86,805,806],{"class":103},"  State",[86,808,797],{"class":99},[86,810,214],{"class":103},[86,812,217],{"class":110},[86,814,220],{"class":124},[86,816,27],{"class":110},[86,818,819],{"class":124},"unknown",[86,821,228],{"class":110},[86,823,824,827,829,831,833,835,837,840,842,844],{"class":88,"line":257},[86,825,826],{"class":103},"  Actions",[86,828,797],{"class":99},[86,830,214],{"class":103},[86,832,217],{"class":110},[86,834,220],{"class":124},[86,836,27],{"class":110},[86,838,839],{"class":103},"SliceActionCreator",[86,841,217],{"class":110},[86,843,656],{"class":103},[86,845,846],{"class":110},">>,\n",[86,848,849,852,854,856,858,860,862,865,867,869],{"class":88,"line":263},[86,850,851],{"class":103},"  Selectors",[86,853,797],{"class":99},[86,855,214],{"class":103},[86,857,217],{"class":110},[86,859,220],{"class":124},[86,861,27],{"class":110},[86,863,864],{"class":103},"SliceSelector",[86,866,217],{"class":110},[86,868,656],{"class":103},[86,870,871],{"class":110},">>\n",[86,873,874,876,878],{"class":88,"line":292},[86,875,669],{"class":110},[86,877,305],{"class":99},[86,879,111],{"class":110},[86,881,882,885,887,890],{"class":88,"line":299},[86,883,884],{"class":117},"  name",[86,886,121],{"class":99},[86,888,889],{"class":103}," Name",[86,891,128],{"class":110},[86,893,894,897,899,902],{"class":88,"line":311},[86,895,896],{"class":117},"  actions",[86,898,121],{"class":99},[86,900,901],{"class":103}," Actions",[86,903,128],{"class":110},[86,905,906,909,911,913],{"class":88,"line":322},[86,907,908],{"class":117},"  defaultState",[86,910,121],{"class":99},[86,912,684],{"class":103},[86,914,128],{"class":110},[86,916,917,920,922,925],{"class":88,"line":328},[86,918,919],{"class":117},"  selectors",[86,921,121],{"class":99},[86,923,924],{"class":103}," Selectors",[86,926,128],{"class":110},[86,928,929],{"class":88,"line":353},[86,930,931],{"class":110},"};\n",[86,933,934],{"class":88,"line":367},[86,935,93],{"emptyLinePlaceholder":92},[86,937,938,940,942,944,946],{"class":88,"line":376},[86,939,169],{"class":99},[86,941,172],{"class":99},[86,943,180],{"class":103},[86,945,107],{"class":99},[86,947,948],{"class":110}," \u003C\n",[86,950,951,953,955,957],{"class":88,"line":383},[86,952,794],{"class":103},[86,954,797],{"class":99},[86,956,125],{"class":124},[86,958,196],{"class":110},[86,960,961,963,965,967,969,971,973,975],{"class":88,"line":389},[86,962,806],{"class":103},[86,964,797],{"class":99},[86,966,214],{"class":103},[86,968,217],{"class":110},[86,970,220],{"class":124},[86,972,27],{"class":110},[86,974,819],{"class":124},[86,976,228],{"class":110},[86,978,979,981,983,985,987,989,991,993,995,997],{"class":88,"line":394},[86,980,826],{"class":103},[86,982,797],{"class":99},[86,984,214],{"class":103},[86,986,217],{"class":110},[86,988,220],{"class":124},[86,990,27],{"class":110},[86,992,839],{"class":103},[86,994,217],{"class":110},[86,996,656],{"class":103},[86,998,846],{"class":110},[86,1000,1001,1003,1005,1007,1009,1011,1013,1015,1017,1019],{"class":88,"line":400},[86,1002,851],{"class":103},[86,1004,797],{"class":99},[86,1006,214],{"class":103},[86,1008,217],{"class":110},[86,1010,220],{"class":124},[86,1012,27],{"class":110},[86,1014,864],{"class":103},[86,1016,217],{"class":110},[86,1018,656],{"class":103},[86,1020,871],{"class":110},[86,1022,1023],{"class":88,"line":426},[86,1024,1025],{"class":110},">({\n",[86,1027,1028],{"class":88,"line":432},[86,1029,1030],{"class":110},"    name,\n",[86,1032,1033],{"class":88,"line":438},[86,1034,1035],{"class":110},"    actions,\n",[86,1037,1038],{"class":88,"line":443},[86,1039,1040],{"class":110},"    defaultState,\n",[86,1042,1043],{"class":88,"line":452},[86,1044,1045],{"class":110},"    selectors,\n",[86,1047,1048,1051,1053,1055,1057,1060,1062,1064,1066,1069,1071,1074,1077,1079],{"class":88,"line":461},[86,1049,1050],{"class":110},"  }",[86,1052,121],{"class":99},[86,1054,786],{"class":103},[86,1056,217],{"class":110},[86,1058,1059],{"class":103},"Name",[86,1061,27],{"class":110},[86,1063,656],{"class":103},[86,1065,27],{"class":110},[86,1067,1068],{"class":103},"Actions",[86,1070,27],{"class":110},[86,1072,1073],{"class":103},"Selectors",[86,1075,1076],{"class":110},">) ",[86,1078,287],{"class":99},[86,1080,111],{"class":110},[86,1082,1083,1086,1089],{"class":88,"line":466},[86,1084,1085],{"class":99},"  let",[86,1087,1088],{"class":110}," sliceActions; ",[86,1090,1091],{"class":295},"// TODO\n",[86,1093,1094,1096,1099],{"class":88,"line":472},[86,1095,1085],{"class":99},[86,1097,1098],{"class":110}," reducer; ",[86,1100,1091],{"class":295},[86,1102,1103,1105,1108],{"class":88,"line":477},[86,1104,1085],{"class":99},[86,1106,1107],{"class":110}," sliceSelectors; ",[86,1109,1091],{"class":295},[86,1111,1112],{"class":88,"line":483},[86,1113,93],{"emptyLinePlaceholder":92},[86,1115,1116,1119],{"class":88,"line":488},[86,1117,1118],{"class":99},"  return",[86,1120,111],{"class":110},[86,1122,1123],{"class":88,"line":494},[86,1124,1125],{"class":110},"    reducer,\n",[86,1127,1128],{"class":88,"line":530},[86,1129,1130],{"class":110},"    selectors: sliceSelectors,\n",[86,1132,1133],{"class":88,"line":535},[86,1134,1135],{"class":110},"    actions: sliceActions,\n",[86,1137,1138],{"class":88,"line":555},[86,1139,1140],{"class":110},"  };\n",[86,1142,1143],{"class":88,"line":564},[86,1144,931],{"class":110},[16,1146,1147],{},"План такой - сначала реализовать экшены, потом редьюсер и в самом конце - селекторы.",[11,1149,1151],{"id":1150},"actions","Экшены",[16,1153,1154,1155,1157,1158],{},"Экшен представляет из себя объект с обязательным полем ",[20,1156,100],{}," и опциональным ",[20,1159,1160],{},"payload",[76,1162,1164],{"className":78,"code":1163,"language":81,"meta":82,"style":82},"type Action\u003CType extends string = string, Payload = unknown> = {\n  type: Type;\n  payload?: Payload;\n};\n",[20,1165,1166,1200,1212,1224],{"__ignoreMap":82},[86,1167,1168,1170,1173,1175,1178,1180,1182,1184,1186,1188,1190,1192,1194,1196,1198],{"class":88,"line":89},[86,1169,100],{"class":99},[86,1171,1172],{"class":103}," Action",[86,1174,217],{"class":110},[86,1176,1177],{"class":103},"Type",[86,1179,797],{"class":99},[86,1181,125],{"class":124},[86,1183,107],{"class":99},[86,1185,125],{"class":124},[86,1187,27],{"class":110},[86,1189,661],{"class":103},[86,1191,107],{"class":99},[86,1193,731],{"class":124},[86,1195,669],{"class":110},[86,1197,305],{"class":99},[86,1199,111],{"class":110},[86,1201,1202,1205,1207,1210],{"class":88,"line":96},[86,1203,1204],{"class":117},"  type",[86,1206,121],{"class":99},[86,1208,1209],{"class":103}," Type",[86,1211,128],{"class":110},[86,1213,1214,1216,1219,1222],{"class":88,"line":114},[86,1215,691],{"class":117},[86,1217,1218],{"class":99},"?:",[86,1220,1221],{"class":103}," Payload",[86,1223,128],{"class":110},[86,1225,1226],{"class":88,"line":131},[86,1227,931],{"class":110},[16,1229,1230],{},"Пусть, если в метод createSlice прокинуты",[76,1232,1234],{"className":78,"code":1233,"language":81,"meta":82,"style":82},"const props = {\n  name: 'users',\n  actions: {\n    addUser: (state, user: User) => {\n      state.userById[user.id] = user;\n      state.usernameById[user.username] = user.id;\n    },\n    deleteUser: (state, userId: string) => {\n      const user = state.userById[userId];\n      delete state.usernameById[user.username];\n      delete state.userById[userId];\n    }\n  }\n};\n",[20,1235,1236,1247,1255,1259,1281,1289,1297,1301,1323,1333,1339,1345,1349,1353],{"__ignoreMap":82},[86,1237,1238,1240,1243,1245],{"class":88,"line":89},[86,1239,497],{"class":99},[86,1241,1242],{"class":124}," props",[86,1244,107],{"class":99},[86,1246,111],{"class":110},[86,1248,1249,1251,1253],{"class":88,"line":96},[86,1250,189],{"class":110},[86,1252,193],{"class":192},[86,1254,196],{"class":110},[86,1256,1257],{"class":88,"line":114},[86,1258,260],{"class":110},[86,1260,1261,1263,1265,1267,1269,1271,1273,1275,1277,1279],{"class":88,"line":131},[86,1262,266],{"class":103},[86,1264,269],{"class":110},[86,1266,272],{"class":117},[86,1268,27],{"class":110},[86,1270,277],{"class":117},[86,1272,121],{"class":99},[86,1274,104],{"class":103},[86,1276,284],{"class":110},[86,1278,287],{"class":99},[86,1280,111],{"class":110},[86,1282,1283,1285,1287],{"class":88,"line":143},[86,1284,302],{"class":110},[86,1286,305],{"class":99},[86,1288,308],{"class":110},[86,1290,1291,1293,1295],{"class":88,"line":155},[86,1292,314],{"class":110},[86,1294,305],{"class":99},[86,1296,319],{"class":110},[86,1298,1299],{"class":88,"line":161},[86,1300,325],{"class":110},[86,1302,1303,1305,1307,1309,1311,1313,1315,1317,1319,1321],{"class":88,"line":166},[86,1304,331],{"class":103},[86,1306,269],{"class":110},[86,1308,272],{"class":117},[86,1310,27],{"class":110},[86,1312,340],{"class":117},[86,1314,121],{"class":99},[86,1316,125],{"class":124},[86,1318,284],{"class":110},[86,1320,287],{"class":99},[86,1322,111],{"class":110},[86,1324,1325,1327,1329,1331],{"class":88,"line":186},[86,1326,356],{"class":99},[86,1328,359],{"class":124},[86,1330,107],{"class":99},[86,1332,364],{"class":110},[86,1334,1335,1337],{"class":88,"line":199},[86,1336,370],{"class":99},[86,1338,373],{"class":110},[86,1340,1341,1343],{"class":88,"line":205},[86,1342,370],{"class":99},[86,1344,364],{"class":110},[86,1346,1347],{"class":88,"line":231},[86,1348,386],{"class":110},[86,1350,1351],{"class":88,"line":251},[86,1352,429],{"class":110},[86,1354,1355],{"class":88,"line":257},[86,1356,931],{"class":110},[16,1358,1359],{},"то мы будем генерировать два actionType:",[16,1361,1362],{},"users/addUser\nusers/deleteUser",[16,1364,1365],{},"и два экшена -",[76,1367,1369],{"className":78,"code":1368,"language":81,"meta":82,"style":82},"const addUser = (user: User) => ({\n  type: \"users/addUser\",\n  payload: user,\n});\n\nconst deleteUser = (userId: string) => ({\n  type: \"users/deleteUser\",\n  payload: user,\n});\n",[20,1370,1371,1395,1405,1410,1414,1418,1441,1450,1454],{"__ignoreMap":82},[86,1372,1373,1375,1377,1379,1382,1384,1386,1388,1390,1392],{"class":88,"line":89},[86,1374,497],{"class":99},[86,1376,540],{"class":103},[86,1378,107],{"class":99},[86,1380,1381],{"class":110}," (",[86,1383,277],{"class":117},[86,1385,121],{"class":99},[86,1387,104],{"class":103},[86,1389,284],{"class":110},[86,1391,287],{"class":99},[86,1393,1394],{"class":110}," ({\n",[86,1396,1397,1400,1403],{"class":88,"line":96},[86,1398,1399],{"class":110},"  type: ",[86,1401,1402],{"class":192},"\"users/addUser\"",[86,1404,196],{"class":110},[86,1406,1407],{"class":88,"line":114},[86,1408,1409],{"class":110},"  payload: user,\n",[86,1411,1412],{"class":88,"line":131},[86,1413,435],{"class":110},[86,1415,1416],{"class":88,"line":143},[86,1417,93],{"emptyLinePlaceholder":92},[86,1419,1420,1422,1425,1427,1429,1431,1433,1435,1437,1439],{"class":88,"line":155},[86,1421,497],{"class":99},[86,1423,1424],{"class":103}," deleteUser",[86,1426,107],{"class":99},[86,1428,1381],{"class":110},[86,1430,340],{"class":117},[86,1432,121],{"class":99},[86,1434,125],{"class":124},[86,1436,284],{"class":110},[86,1438,287],{"class":99},[86,1440,1394],{"class":110},[86,1442,1443,1445,1448],{"class":88,"line":161},[86,1444,1399],{"class":110},[86,1446,1447],{"class":192},"\"users/deleteUser\"",[86,1449,196],{"class":110},[86,1451,1452],{"class":88,"line":166},[86,1453,1409],{"class":110},[86,1455,1456],{"class":88,"line":186},[86,1457,435],{"class":110},[16,1459,1460],{},"Префикс с названием слайса добавлен для удобства и для того, чтобы предотвратить конфликт экшенов с одинаковыми названиями.",[16,1462,1463,1464,1467,1468],{},"Нам понадобится два новых типа - ",[20,1465,1466],{},"ActionKey"," и ",[20,1469,1470],{},"ActionType",[16,1472,1473,1474,1476],{},"это ключи переданного объекта actions, а ",[20,1475,1470],{}," - это экшены, которые генерирует слайс, те же ключи, но с префиксом,",[16,1478,1479,1480,1482,1483],{},"Для создания типа ",[20,1481,1470],{}," используется небольшой генерик хелпер ",[20,1484,1485],{},"Scoped",[76,1487,1489],{"className":78,"code":1488,"language":81,"meta":82,"style":82},"type Scoped\u003CString extends string, Scope extends string> = `${Scope}/${String}`;\n\nexport const createSlice = \u003C\n  Name extends string,\n  State extends Record\u003Cstring, unknown>,\n  Actions extends Record\u003Cstring, SliceActionCreator\u003CState>>,\n  ActionKey extends Extract\u003Ckeyof Actions, string>,\n  ScopedActionType extends Scoped\u003CActionKey, Name>,\n  ActionPayload extends Parameters\u003CActions[ActionKey]>[1],\n  Action extends { type: ScopedActionType, payload: ActionPayload },\n>({\n    name,\n    actions,\n    defaultState,\n    selectors,\n  }: CreateSliceProps\u003CName, State, Actions, Selectors>) => {\n  const actionKeys = Object.keys(actions) as ActionKey[];\n  const actionTypeByActionKey = actionKeys.reduce((acc, action) => {\n    const scopedActionType = `${name}/${action}` as ScopedActionType;\n    acc[scopedActionType] = action;\n    return acc;\n  }, {} as Record\u003CScopedActionType, ActionKey>);\n\n  const reducer = (state: State = defaultState, action: Action) => {\n    const nextState = produce(state, draft => {\n      const actionType = actionTypeByActionKey[action.type];\n      actions[actionType]?.(draft as State, action.payload);\n    });\n    return nextState;\n  };\n\n  const sliceActions = actionKeys.reduce((acc, curr) => {\n    acc[curr] = (payload) => {\n      const scopedActionType = `${name}/${curr}` as ScopedActionType;\n\n      return {\n        type: scopedActionType,\n        payload,\n      };\n    };\n    return acc;\n  }, {} as {\n    [ActionKey in Extract\u003Ckeyof Actions, string>]: (payload: Parameters\u003CActions[ActionKey]>[1]) => { type: Scoped\u003CActionKey, Name>, payload: P }\n  });\n\n  return {\n    actions: sliceActions,\n  };\n};\n",[20,1490,1491,1535,1539,1551,1561,1579,1601,1624,1643,1671,1700,1704,1708,1712,1716,1720,1750,1777,1809,1837,1847,1855,1876,1880,1914,1936,1948,1960,1965,1972,1976,1980,2008,2025,2049,2053,2060,2065,2070,2075,2080,2086,2094,2175,2180,2184,2190,2194,2198],{"__ignoreMap":82},[86,1492,1493,1495,1498,1500,1503,1505,1507,1509,1512,1514,1516,1518,1520,1523,1525,1528,1530,1533],{"class":88,"line":89},[86,1494,100],{"class":99},[86,1496,1497],{"class":103}," Scoped",[86,1499,217],{"class":110},[86,1501,1502],{"class":103},"String",[86,1504,797],{"class":99},[86,1506,125],{"class":124},[86,1508,27],{"class":110},[86,1510,1511],{"class":103},"Scope",[86,1513,797],{"class":99},[86,1515,125],{"class":124},[86,1517,669],{"class":110},[86,1519,305],{"class":99},[86,1521,1522],{"class":192}," `${",[86,1524,1511],{"class":103},[86,1526,1527],{"class":192},"}/${",[86,1529,1502],{"class":103},[86,1531,1532],{"class":192},"}`",[86,1534,128],{"class":110},[86,1536,1537],{"class":88,"line":96},[86,1538,93],{"emptyLinePlaceholder":92},[86,1540,1541,1543,1545,1547,1549],{"class":88,"line":114},[86,1542,169],{"class":99},[86,1544,172],{"class":99},[86,1546,180],{"class":103},[86,1548,107],{"class":99},[86,1550,948],{"class":110},[86,1552,1553,1555,1557,1559],{"class":88,"line":131},[86,1554,794],{"class":103},[86,1556,797],{"class":99},[86,1558,125],{"class":124},[86,1560,196],{"class":110},[86,1562,1563,1565,1567,1569,1571,1573,1575,1577],{"class":88,"line":143},[86,1564,806],{"class":103},[86,1566,797],{"class":99},[86,1568,214],{"class":103},[86,1570,217],{"class":110},[86,1572,220],{"class":124},[86,1574,27],{"class":110},[86,1576,819],{"class":124},[86,1578,228],{"class":110},[86,1580,1581,1583,1585,1587,1589,1591,1593,1595,1597,1599],{"class":88,"line":155},[86,1582,826],{"class":103},[86,1584,797],{"class":99},[86,1586,214],{"class":103},[86,1588,217],{"class":110},[86,1590,220],{"class":124},[86,1592,27],{"class":110},[86,1594,839],{"class":103},[86,1596,217],{"class":110},[86,1598,656],{"class":103},[86,1600,846],{"class":110},[86,1602,1603,1606,1608,1611,1613,1616,1618,1620,1622],{"class":88,"line":161},[86,1604,1605],{"class":103},"  ActionKey",[86,1607,797],{"class":99},[86,1609,1610],{"class":103}," Extract",[86,1612,217],{"class":110},[86,1614,1615],{"class":99},"keyof",[86,1617,901],{"class":103},[86,1619,27],{"class":110},[86,1621,220],{"class":124},[86,1623,228],{"class":110},[86,1625,1626,1629,1631,1633,1635,1637,1639,1641],{"class":88,"line":166},[86,1627,1628],{"class":103},"  ScopedActionType",[86,1630,797],{"class":99},[86,1632,1497],{"class":103},[86,1634,217],{"class":110},[86,1636,1466],{"class":103},[86,1638,27],{"class":110},[86,1640,1059],{"class":103},[86,1642,228],{"class":110},[86,1644,1645,1648,1650,1653,1655,1657,1660,1662,1665,1668],{"class":88,"line":186},[86,1646,1647],{"class":103},"  ActionPayload",[86,1649,797],{"class":99},[86,1651,1652],{"class":103}," Parameters",[86,1654,217],{"class":110},[86,1656,1068],{"class":103},[86,1658,1659],{"class":110},"[",[86,1661,1466],{"class":103},[86,1663,1664],{"class":110},"]>[",[86,1666,1667],{"class":124},"1",[86,1669,1670],{"class":110},"],\n",[86,1672,1673,1676,1678,1681,1683,1685,1688,1690,1692,1694,1697],{"class":88,"line":199},[86,1674,1675],{"class":103},"  Action",[86,1677,797],{"class":99},[86,1679,1680],{"class":110}," { ",[86,1682,100],{"class":117},[86,1684,121],{"class":99},[86,1686,1687],{"class":103}," ScopedActionType",[86,1689,27],{"class":110},[86,1691,1160],{"class":117},[86,1693,121],{"class":99},[86,1695,1696],{"class":103}," ActionPayload",[86,1698,1699],{"class":110}," },\n",[86,1701,1702],{"class":88,"line":205},[86,1703,1025],{"class":110},[86,1705,1706],{"class":88,"line":231},[86,1707,1030],{"class":110},[86,1709,1710],{"class":88,"line":251},[86,1711,1035],{"class":110},[86,1713,1714],{"class":88,"line":257},[86,1715,1040],{"class":110},[86,1717,1718],{"class":88,"line":263},[86,1719,1045],{"class":110},[86,1721,1722,1724,1726,1728,1730,1732,1734,1736,1738,1740,1742,1744,1746,1748],{"class":88,"line":292},[86,1723,1050],{"class":110},[86,1725,121],{"class":99},[86,1727,786],{"class":103},[86,1729,217],{"class":110},[86,1731,1059],{"class":103},[86,1733,27],{"class":110},[86,1735,656],{"class":103},[86,1737,27],{"class":110},[86,1739,1068],{"class":103},[86,1741,27],{"class":110},[86,1743,1073],{"class":103},[86,1745,1076],{"class":110},[86,1747,287],{"class":99},[86,1749,111],{"class":110},[86,1751,1752,1755,1758,1760,1763,1766,1769,1771,1774],{"class":88,"line":299},[86,1753,1754],{"class":99},"  const",[86,1756,1757],{"class":124}," actionKeys",[86,1759,107],{"class":99},[86,1761,1762],{"class":110}," Object.",[86,1764,1765],{"class":103},"keys",[86,1767,1768],{"class":110},"(actions) ",[86,1770,211],{"class":99},[86,1772,1773],{"class":103}," ActionKey",[86,1775,1776],{"class":110},"[];\n",[86,1778,1779,1781,1784,1786,1789,1792,1795,1798,1800,1803,1805,1807],{"class":88,"line":311},[86,1780,1754],{"class":99},[86,1782,1783],{"class":124}," actionTypeByActionKey",[86,1785,107],{"class":99},[86,1787,1788],{"class":110}," actionKeys.",[86,1790,1791],{"class":103},"reduce",[86,1793,1794],{"class":110},"((",[86,1796,1797],{"class":117},"acc",[86,1799,27],{"class":110},[86,1801,1802],{"class":117},"action",[86,1804,284],{"class":110},[86,1806,287],{"class":99},[86,1808,111],{"class":110},[86,1810,1811,1814,1817,1819,1821,1824,1826,1828,1830,1833,1835],{"class":88,"line":322},[86,1812,1813],{"class":99},"    const",[86,1815,1816],{"class":124}," scopedActionType",[86,1818,107],{"class":99},[86,1820,1522],{"class":192},[86,1822,1823],{"class":110},"name",[86,1825,1527],{"class":192},[86,1827,1802],{"class":110},[86,1829,1532],{"class":192},[86,1831,1832],{"class":99}," as",[86,1834,1687],{"class":103},[86,1836,128],{"class":110},[86,1838,1839,1842,1844],{"class":88,"line":328},[86,1840,1841],{"class":110},"    acc[scopedActionType] ",[86,1843,305],{"class":99},[86,1845,1846],{"class":110}," action;\n",[86,1848,1849,1852],{"class":88,"line":353},[86,1850,1851],{"class":99},"    return",[86,1853,1854],{"class":110}," acc;\n",[86,1856,1857,1860,1862,1864,1866,1869,1871,1873],{"class":88,"line":367},[86,1858,1859],{"class":110},"  }, {} ",[86,1861,211],{"class":99},[86,1863,214],{"class":103},[86,1865,217],{"class":110},[86,1867,1868],{"class":103},"ScopedActionType",[86,1870,27],{"class":110},[86,1872,1466],{"class":103},[86,1874,1875],{"class":110},">);\n",[86,1877,1878],{"class":88,"line":376},[86,1879,93],{"emptyLinePlaceholder":92},[86,1881,1882,1884,1887,1889,1891,1893,1895,1897,1899,1902,1904,1906,1908,1910,1912],{"class":88,"line":383},[86,1883,1754],{"class":99},[86,1885,1886],{"class":103}," reducer",[86,1888,107],{"class":99},[86,1890,1381],{"class":110},[86,1892,272],{"class":117},[86,1894,121],{"class":99},[86,1896,684],{"class":103},[86,1898,107],{"class":99},[86,1900,1901],{"class":110}," defaultState, ",[86,1903,1802],{"class":117},[86,1905,121],{"class":99},[86,1907,1172],{"class":103},[86,1909,284],{"class":110},[86,1911,287],{"class":99},[86,1913,111],{"class":110},[86,1915,1916,1918,1921,1923,1926,1929,1932,1934],{"class":88,"line":389},[86,1917,1813],{"class":99},[86,1919,1920],{"class":124}," nextState",[86,1922,107],{"class":99},[86,1924,1925],{"class":103}," produce",[86,1927,1928],{"class":110},"(state, ",[86,1930,1931],{"class":117},"draft",[86,1933,512],{"class":99},[86,1935,111],{"class":110},[86,1937,1938,1940,1943,1945],{"class":88,"line":394},[86,1939,356],{"class":99},[86,1941,1942],{"class":124}," actionType",[86,1944,107],{"class":99},[86,1946,1947],{"class":110}," actionTypeByActionKey[action.type];\n",[86,1949,1950,1953,1955,1957],{"class":88,"line":400},[86,1951,1952],{"class":110},"      actions[actionType]?.(draft ",[86,1954,211],{"class":99},[86,1956,684],{"class":103},[86,1958,1959],{"class":110},", action.payload);\n",[86,1961,1962],{"class":88,"line":426},[86,1963,1964],{"class":110},"    });\n",[86,1966,1967,1969],{"class":88,"line":432},[86,1968,1851],{"class":99},[86,1970,1971],{"class":110}," nextState;\n",[86,1973,1974],{"class":88,"line":438},[86,1975,1140],{"class":110},[86,1977,1978],{"class":88,"line":443},[86,1979,93],{"emptyLinePlaceholder":92},[86,1981,1982,1984,1987,1989,1991,1993,1995,1997,1999,2002,2004,2006],{"class":88,"line":452},[86,1983,1754],{"class":99},[86,1985,1986],{"class":124}," sliceActions",[86,1988,107],{"class":99},[86,1990,1788],{"class":110},[86,1992,1791],{"class":103},[86,1994,1794],{"class":110},[86,1996,1797],{"class":117},[86,1998,27],{"class":110},[86,2000,2001],{"class":117},"curr",[86,2003,284],{"class":110},[86,2005,287],{"class":99},[86,2007,111],{"class":110},[86,2009,2010,2013,2015,2017,2019,2021,2023],{"class":88,"line":461},[86,2011,2012],{"class":110},"    acc[curr] ",[86,2014,305],{"class":99},[86,2016,1381],{"class":110},[86,2018,1160],{"class":117},[86,2020,284],{"class":110},[86,2022,287],{"class":99},[86,2024,111],{"class":110},[86,2026,2027,2029,2031,2033,2035,2037,2039,2041,2043,2045,2047],{"class":88,"line":466},[86,2028,356],{"class":99},[86,2030,1816],{"class":124},[86,2032,107],{"class":99},[86,2034,1522],{"class":192},[86,2036,1823],{"class":110},[86,2038,1527],{"class":192},[86,2040,2001],{"class":110},[86,2042,1532],{"class":192},[86,2044,1832],{"class":99},[86,2046,1687],{"class":103},[86,2048,128],{"class":110},[86,2050,2051],{"class":88,"line":472},[86,2052,93],{"emptyLinePlaceholder":92},[86,2054,2055,2058],{"class":88,"line":477},[86,2056,2057],{"class":99},"      return",[86,2059,111],{"class":110},[86,2061,2062],{"class":88,"line":483},[86,2063,2064],{"class":110},"        type: scopedActionType,\n",[86,2066,2067],{"class":88,"line":488},[86,2068,2069],{"class":110},"        payload,\n",[86,2071,2072],{"class":88,"line":494},[86,2073,2074],{"class":110},"      };\n",[86,2076,2077],{"class":88,"line":530},[86,2078,2079],{"class":110},"    };\n",[86,2081,2082,2084],{"class":88,"line":535},[86,2083,1851],{"class":99},[86,2085,1854],{"class":110},[86,2087,2088,2090,2092],{"class":88,"line":555},[86,2089,1859],{"class":110},[86,2091,211],{"class":99},[86,2093,111],{"class":110},[86,2095,2096,2099,2101,2104,2106,2108,2110,2112,2114,2116,2119,2121,2123,2125,2127,2129,2131,2133,2135,2137,2139,2141,2144,2146,2148,2150,2152,2154,2156,2158,2160,2162,2165,2167,2169,2172],{"class":88,"line":564},[86,2097,2098],{"class":110},"    [",[86,2100,1466],{"class":103},[86,2102,2103],{"class":99}," in",[86,2105,1610],{"class":103},[86,2107,217],{"class":110},[86,2109,1615],{"class":99},[86,2111,901],{"class":103},[86,2113,27],{"class":110},[86,2115,220],{"class":124},[86,2117,2118],{"class":110},">]",[86,2120,121],{"class":99},[86,2122,1381],{"class":110},[86,2124,1160],{"class":117},[86,2126,121],{"class":99},[86,2128,1652],{"class":103},[86,2130,217],{"class":110},[86,2132,1068],{"class":103},[86,2134,1659],{"class":110},[86,2136,1466],{"class":103},[86,2138,1664],{"class":110},[86,2140,1667],{"class":124},[86,2142,2143],{"class":110},"]) ",[86,2145,287],{"class":99},[86,2147,1680],{"class":110},[86,2149,100],{"class":117},[86,2151,121],{"class":99},[86,2153,1497],{"class":103},[86,2155,217],{"class":110},[86,2157,1466],{"class":103},[86,2159,27],{"class":110},[86,2161,1059],{"class":103},[86,2163,2164],{"class":110},">, ",[86,2166,1160],{"class":117},[86,2168,121],{"class":99},[86,2170,2171],{"class":103}," P",[86,2173,2174],{"class":110}," }\n",[86,2176,2177],{"class":88,"line":570},[86,2178,2179],{"class":110},"  });\n",[86,2181,2182],{"class":88,"line":581},[86,2183,93],{"emptyLinePlaceholder":92},[86,2185,2186,2188],{"class":88,"line":592},[86,2187,1118],{"class":99},[86,2189,111],{"class":110},[86,2191,2192],{"class":88,"line":603},[86,2193,1135],{"class":110},[86,2195,2196],{"class":88,"line":614},[86,2197,1140],{"class":110},[86,2199,2200],{"class":88,"line":620},[86,2201,931],{"class":110},[16,2203,2204],{},"Остановлюсь на некоторых аспектах типизации чуть подробнее",[16,2206,2207,2208,2210,2211],{},"должен быть генериком, который будет на лету подхватывать ключи из переданного объекта ",[20,2209,1068],{},".\nУ объекта в качестве ключа помимо строки может быть число или символ.\nЧтобы избежать проблем с типизацией, нужно достать только строки при помощи  ",[20,2212,2213],{},"Extract\u003Ckeyof Actions, string>",[16,2215,2216,2217,2219,2220,2223,2224,2227,2228,2230,2231],{},"Чтобы сгенерировать экшены с правильным payload (чтобы у ",[20,2218,576],{}," была поддержка типизации и аргументом был именно ",[20,2221,2222],{},"user: User","),\nнужно достать второй аргумент из переданного коллбека. Для этого воспользуемся хелпером ",[20,2225,2226],{},"Parameters","\nи укажем нужный ",[20,2229,1466],{},"-  ",[20,2232,2233],{},"Parameters\u003CActions[ActionType]>[1]",[16,2235,2236],{},"Проверим, что все работает правильно:",[76,2238,2240],{"className":78,"code":2239,"language":81,"meta":82,"style":82},"export const usersSlice = createSlice({\n  name: 'users',\n  defaultState: {\n    userById: {} as Record\u003Cstring, User>,\n    usernameById: {} as Record\u003Cstring, string>,\n  },\n  actions: {\n    addUser: (state, user: User) => {\n      // state должен иметь тот же тип, что и defaultState\n      state.userById[user.id] = user;\n      state.usernameById[user.username] = user.id;\n    },\n    deleteUser: (state, userId: string) => {\n      const user = state.userById[userId];\n      delete state.usernameById[user.username];\n      delete state.userById[userId];\n    }\n  },\n  selectors: {\n    selectUserByUsername: (state, username: string) => state.userById[state.usernameById[username]],\n  }\n});\n\nusersSlice.actions; // можно навести на actions и увидеть его тип\n",[20,2241,2242,2256,2264,2268,2286,2304,2308,2312,2334,2338,2346,2354,2358,2380,2390,2396,2402,2406,2410,2414,2436,2440,2444,2448],{"__ignoreMap":82},[86,2243,2244,2246,2248,2250,2252,2254],{"class":88,"line":89},[86,2245,169],{"class":99},[86,2247,172],{"class":99},[86,2249,175],{"class":124},[86,2251,107],{"class":99},[86,2253,180],{"class":103},[86,2255,183],{"class":110},[86,2257,2258,2260,2262],{"class":88,"line":96},[86,2259,189],{"class":110},[86,2261,193],{"class":192},[86,2263,196],{"class":110},[86,2265,2266],{"class":88,"line":114},[86,2267,202],{"class":110},[86,2269,2270,2272,2274,2276,2278,2280,2282,2284],{"class":88,"line":131},[86,2271,208],{"class":110},[86,2273,211],{"class":99},[86,2275,214],{"class":103},[86,2277,217],{"class":110},[86,2279,220],{"class":124},[86,2281,27],{"class":110},[86,2283,225],{"class":103},[86,2285,228],{"class":110},[86,2287,2288,2290,2292,2294,2296,2298,2300,2302],{"class":88,"line":143},[86,2289,234],{"class":110},[86,2291,211],{"class":99},[86,2293,214],{"class":103},[86,2295,217],{"class":110},[86,2297,220],{"class":124},[86,2299,27],{"class":110},[86,2301,220],{"class":124},[86,2303,228],{"class":110},[86,2305,2306],{"class":88,"line":155},[86,2307,254],{"class":110},[86,2309,2310],{"class":88,"line":161},[86,2311,260],{"class":110},[86,2313,2314,2316,2318,2320,2322,2324,2326,2328,2330,2332],{"class":88,"line":166},[86,2315,266],{"class":103},[86,2317,269],{"class":110},[86,2319,272],{"class":117},[86,2321,27],{"class":110},[86,2323,277],{"class":117},[86,2325,121],{"class":99},[86,2327,104],{"class":103},[86,2329,284],{"class":110},[86,2331,287],{"class":99},[86,2333,111],{"class":110},[86,2335,2336],{"class":88,"line":186},[86,2337,296],{"class":295},[86,2339,2340,2342,2344],{"class":88,"line":199},[86,2341,302],{"class":110},[86,2343,305],{"class":99},[86,2345,308],{"class":110},[86,2347,2348,2350,2352],{"class":88,"line":205},[86,2349,314],{"class":110},[86,2351,305],{"class":99},[86,2353,319],{"class":110},[86,2355,2356],{"class":88,"line":231},[86,2357,325],{"class":110},[86,2359,2360,2362,2364,2366,2368,2370,2372,2374,2376,2378],{"class":88,"line":251},[86,2361,331],{"class":103},[86,2363,269],{"class":110},[86,2365,272],{"class":117},[86,2367,27],{"class":110},[86,2369,340],{"class":117},[86,2371,121],{"class":99},[86,2373,125],{"class":124},[86,2375,284],{"class":110},[86,2377,287],{"class":99},[86,2379,111],{"class":110},[86,2381,2382,2384,2386,2388],{"class":88,"line":257},[86,2383,356],{"class":99},[86,2385,359],{"class":124},[86,2387,107],{"class":99},[86,2389,364],{"class":110},[86,2391,2392,2394],{"class":88,"line":263},[86,2393,370],{"class":99},[86,2395,373],{"class":110},[86,2397,2398,2400],{"class":88,"line":292},[86,2399,370],{"class":99},[86,2401,364],{"class":110},[86,2403,2404],{"class":88,"line":299},[86,2405,386],{"class":110},[86,2407,2408],{"class":88,"line":311},[86,2409,254],{"class":110},[86,2411,2412],{"class":88,"line":322},[86,2413,397],{"class":110},[86,2415,2416,2418,2420,2422,2424,2426,2428,2430,2432,2434],{"class":88,"line":328},[86,2417,403],{"class":103},[86,2419,269],{"class":110},[86,2421,272],{"class":117},[86,2423,27],{"class":110},[86,2425,412],{"class":117},[86,2427,121],{"class":99},[86,2429,125],{"class":124},[86,2431,284],{"class":110},[86,2433,287],{"class":99},[86,2435,423],{"class":110},[86,2437,2438],{"class":88,"line":353},[86,2439,429],{"class":110},[86,2441,2442],{"class":88,"line":367},[86,2443,435],{"class":110},[86,2445,2446],{"class":88,"line":376},[86,2447,93],{"emptyLinePlaceholder":92},[86,2449,2450,2453],{"class":88,"line":383},[86,2451,2452],{"class":110},"usersSlice.actions; ",[86,2454,2455],{"class":295},"// можно навести на actions и увидеть его тип\n",[16,2457,2458],{},[2459,2460],"img",{"alt":2461,"src":2462},"Подсказка в vs code","/images/actions-type-hightlight.png",[11,2464,2466],{"id":2465},"reducer","Редьюсер",[16,2468,2469,2470,1467,2472,2474,2475,2478],{},"По своей сути редьюсер - это чистая функция, которая принимает два аргумента - ",[20,2471,272],{},[20,2473,1802],{}," и возвращает ",[20,2476,2477],{},"nextState",".\nОчень важно при этом, чтобы стейт был иммутабельным, ради этого обычно используются страшные конструкции вроде",[76,2480,2482],{"className":78,"code":2481,"language":81,"meta":82,"style":82},"const nextState = {\n  ...state,\n  userById: {\n    ...state.userById,\n    [user.id]: user, \n  }\n};\n",[20,2483,2484,2494,2502,2507,2515,2520,2524],{"__ignoreMap":82},[86,2485,2486,2488,2490,2492],{"class":88,"line":89},[86,2487,497],{"class":99},[86,2489,1920],{"class":124},[86,2491,107],{"class":99},[86,2493,111],{"class":110},[86,2495,2496,2499],{"class":88,"line":96},[86,2497,2498],{"class":99},"  ...",[86,2500,2501],{"class":110},"state,\n",[86,2503,2504],{"class":88,"line":114},[86,2505,2506],{"class":110},"  userById: {\n",[86,2508,2509,2512],{"class":88,"line":131},[86,2510,2511],{"class":99},"    ...",[86,2513,2514],{"class":110},"state.userById,\n",[86,2516,2517],{"class":88,"line":143},[86,2518,2519],{"class":110},"    [user.id]: user, \n",[86,2521,2522],{"class":88,"line":155},[86,2523,429],{"class":110},[86,2525,2526],{"class":88,"line":161},[86,2527,931],{"class":110},[16,2529,2530,2531,2535,2536,2540,2541,2545],{},"Чтобы облегчить себе жизнь, для создания иммутабельного стейта предлагаю использовать\n",[43,2532,2533],{"href":2533,"rel":2534},"https://www.npmjs.com/package/immer",[47],"](",[43,2537,2538],{"href":2538,"rel":2539},"https://github.com/immerjs/immer",[47],"), в частности метод\nproduce](",[43,2542,2543],{"href":2543,"rel":2544},"https://immerjs.github.io/immer/produce",[47],")",[16,2547,2548,2549,2552],{},"таким образом все, что нам нужно - это вызвать внутри ",[20,2550,2551],{},"produce"," нужный коллбек (экшен), передав туда драфт стейта и payload экшена",[76,2554,2556],{"className":78,"code":2555,"language":81,"meta":82,"style":82},"const reducer = (state: State = defaultState, action: Action) => {\n  const nextState = produce(state, draft => {\n    actions[action.type]?.(draft as State, action.payload);\n  });\n  return nextState;\n};\n",[20,2557,2558,2590,2608,2619,2623,2629],{"__ignoreMap":82},[86,2559,2560,2562,2564,2566,2568,2570,2572,2574,2576,2578,2580,2582,2584,2586,2588],{"class":88,"line":89},[86,2561,497],{"class":99},[86,2563,1886],{"class":103},[86,2565,107],{"class":99},[86,2567,1381],{"class":110},[86,2569,272],{"class":117},[86,2571,121],{"class":99},[86,2573,684],{"class":103},[86,2575,107],{"class":99},[86,2577,1901],{"class":110},[86,2579,1802],{"class":117},[86,2581,121],{"class":99},[86,2583,1172],{"class":103},[86,2585,284],{"class":110},[86,2587,287],{"class":99},[86,2589,111],{"class":110},[86,2591,2592,2594,2596,2598,2600,2602,2604,2606],{"class":88,"line":96},[86,2593,1754],{"class":99},[86,2595,1920],{"class":124},[86,2597,107],{"class":99},[86,2599,1925],{"class":103},[86,2601,1928],{"class":110},[86,2603,1931],{"class":117},[86,2605,512],{"class":99},[86,2607,111],{"class":110},[86,2609,2610,2613,2615,2617],{"class":88,"line":114},[86,2611,2612],{"class":110},"    actions[action.type]?.(draft ",[86,2614,211],{"class":99},[86,2616,684],{"class":103},[86,2618,1959],{"class":110},[86,2620,2621],{"class":88,"line":131},[86,2622,2179],{"class":110},[86,2624,2625,2627],{"class":88,"line":143},[86,2626,1118],{"class":99},[86,2628,1971],{"class":110},[86,2630,2631],{"class":88,"line":155},[86,2632,931],{"class":110},[11,2634,2636],{"id":2635},"selectors","Селекторы",[16,2638,2639,2640,2643],{},"Для работы в связке с react + redux используется хук ",[20,2641,2642],{},"useSelector"," .",[16,2645,2646,2647,2545],{},"Чтобы реакт знал и мог реагировать (делать ререндер компонента) на изменения в стейте существует метод\nuseSyncExternalStore](",[43,2648,2649],{"href":2649,"rel":2650},"https://react.dev/reference/react/useSyncExternalStore",[47],[16,2652,2653],{},"Например, чтобы получить актуальный стейт, можно написать следующий код:",[76,2655,2657],{"className":78,"code":2656,"language":81,"meta":82,"style":82},"const useStore = () => {\n  const state = useSyncExternalStore(\n    myStore.subscribe,\n    myStore.getState,\n  );\n\n  return state;\n};\n",[20,2658,2659,2675,2689,2694,2699,2703,2707,2714],{"__ignoreMap":82},[86,2660,2661,2663,2666,2668,2671,2673],{"class":88,"line":89},[86,2662,497],{"class":99},[86,2664,2665],{"class":103}," useStore",[86,2667,107],{"class":99},[86,2669,2670],{"class":110}," () ",[86,2672,287],{"class":99},[86,2674,111],{"class":110},[86,2676,2677,2679,2682,2684,2687],{"class":88,"line":96},[86,2678,1754],{"class":99},[86,2680,2681],{"class":124}," state",[86,2683,107],{"class":99},[86,2685,2686],{"class":103}," useSyncExternalStore",[86,2688,561],{"class":110},[86,2690,2691],{"class":88,"line":114},[86,2692,2693],{"class":110},"    myStore.subscribe,\n",[86,2695,2696],{"class":88,"line":131},[86,2697,2698],{"class":110},"    myStore.getState,\n",[86,2700,2701],{"class":88,"line":143},[86,2702,623],{"class":110},[86,2704,2705],{"class":88,"line":155},[86,2706,93],{"emptyLinePlaceholder":92},[86,2708,2709,2711],{"class":88,"line":161},[86,2710,1118],{"class":99},[86,2712,2713],{"class":110}," state;\n",[86,2715,2716],{"class":88,"line":166},[86,2717,931],{"class":110},[16,2719,2720,2721,2724],{},"Мы могли бы даже использовать селектор, чтобы достать из стора нужные нам данные,\nоднако такая реализация будет реагировать на ",[52,2722,2723],{},"любые"," изменения в стейте.",[16,2726,2727],{},"Мы же хотим, чтобы наш useSelector реагировал только на изменения результата селектора, а не всего стейта.\nТ.е. чтобы селектор",[76,2729,2731],{"className":78,"code":2730,"language":81,"meta":82,"style":82},"const username = useSelector(state => state.users.usersById['some-id'].username);\n",[20,2732,2733],{"__ignoreMap":82},[86,2734,2735,2737,2740,2742,2744,2746,2748,2750,2753,2756],{"class":88,"line":89},[86,2736,497],{"class":99},[86,2738,2739],{"class":124}," username",[86,2741,107],{"class":99},[86,2743,504],{"class":103},[86,2745,507],{"class":110},[86,2747,272],{"class":117},[86,2749,512],{"class":99},[86,2751,2752],{"class":110}," state.users.usersById[",[86,2754,2755],{"class":192},"'some-id'",[86,2757,2758],{"class":110},"].username);\n",[16,2760,2761],{},"реагировал только на изменение username конкретного юзера (с id = “some-id”).",[16,2763,2764,2765,2768,2769,2772],{},"Предлагаю не писать велосипед и использовать ",[20,2766,2767],{},"useSyncExternalStoreWithSelector",".\nЭто модифицированная версия ",[20,2770,2771],{},"useSyncExternalStore"," c поддержкой селекторов и мемоизацией.",[16,2774,2775,2776,2778],{},"Таким образом хелпер для создания ",[20,2777,2642],{}," будет выглядеть следующим образом:",[76,2780,2782],{"className":78,"code":2781,"language":81,"meta":82,"style":82},"import type { Store as ReduxStore } from 'redux';\nimport { useSyncExternalStoreWithSelector } from 'use-sync-external-store/with-selector';\n\nexport const createUseSelector = \u003C\n  Store extends ReduxStore,\n  State extends ReturnType\u003CStore['getState']>,\n>(store: Store) => {\n  const useSelector = \u003CSelector extends (state: State) => unknown>(selector: Selector) => {\n    return useSyncExternalStoreWithSelector(\n      store.subscribe,\n      store.getState,\n      store.getState,\n      selector\n    ) as ReturnType\u003CSelector>;\n  };\n\n  return useSelector;\n};\n",[20,2783,2784,2808,2822,2826,2839,2851,2873,2892,2938,2947,2952,2957,2961,2966,2982,2986,2990,2997],{"__ignoreMap":82},[86,2785,2786,2789,2792,2795,2797,2800,2803,2806],{"class":88,"line":89},[86,2787,2788],{"class":99},"import",[86,2790,2791],{"class":99}," type",[86,2793,2794],{"class":110}," { Store ",[86,2796,211],{"class":99},[86,2798,2799],{"class":110}," ReduxStore } ",[86,2801,2802],{"class":99},"from",[86,2804,2805],{"class":192}," 'redux'",[86,2807,128],{"class":110},[86,2809,2810,2812,2815,2817,2820],{"class":88,"line":96},[86,2811,2788],{"class":99},[86,2813,2814],{"class":110}," { useSyncExternalStoreWithSelector } ",[86,2816,2802],{"class":99},[86,2818,2819],{"class":192}," 'use-sync-external-store/with-selector'",[86,2821,128],{"class":110},[86,2823,2824],{"class":88,"line":114},[86,2825,93],{"emptyLinePlaceholder":92},[86,2827,2828,2830,2832,2835,2837],{"class":88,"line":131},[86,2829,169],{"class":99},[86,2831,172],{"class":99},[86,2833,2834],{"class":103}," createUseSelector",[86,2836,107],{"class":99},[86,2838,948],{"class":110},[86,2840,2841,2844,2846,2849],{"class":88,"line":143},[86,2842,2843],{"class":103},"  Store",[86,2845,797],{"class":99},[86,2847,2848],{"class":103}," ReduxStore",[86,2850,196],{"class":110},[86,2852,2853,2855,2857,2860,2862,2865,2867,2870],{"class":88,"line":155},[86,2854,806],{"class":103},[86,2856,797],{"class":99},[86,2858,2859],{"class":103}," ReturnType",[86,2861,217],{"class":110},[86,2863,2864],{"class":103},"Store",[86,2866,1659],{"class":110},[86,2868,2869],{"class":192},"'getState'",[86,2871,2872],{"class":110},"]>,\n",[86,2874,2875,2878,2881,2883,2886,2888,2890],{"class":88,"line":161},[86,2876,2877],{"class":110},">(",[86,2879,2880],{"class":117},"store",[86,2882,121],{"class":99},[86,2884,2885],{"class":103}," Store",[86,2887,284],{"class":110},[86,2889,287],{"class":99},[86,2891,111],{"class":110},[86,2893,2894,2896,2898,2900,2903,2906,2908,2910,2912,2914,2916,2918,2920,2922,2924,2927,2929,2932,2934,2936],{"class":88,"line":166},[86,2895,1754],{"class":99},[86,2897,504],{"class":103},[86,2899,107],{"class":99},[86,2901,2902],{"class":110}," \u003C",[86,2904,2905],{"class":103},"Selector",[86,2907,797],{"class":99},[86,2909,1381],{"class":110},[86,2911,272],{"class":117},[86,2913,121],{"class":99},[86,2915,684],{"class":103},[86,2917,284],{"class":110},[86,2919,287],{"class":99},[86,2921,731],{"class":124},[86,2923,2877],{"class":110},[86,2925,2926],{"class":117},"selector",[86,2928,121],{"class":99},[86,2930,2931],{"class":103}," Selector",[86,2933,284],{"class":110},[86,2935,287],{"class":99},[86,2937,111],{"class":110},[86,2939,2940,2942,2945],{"class":88,"line":186},[86,2941,1851],{"class":99},[86,2943,2944],{"class":103}," useSyncExternalStoreWithSelector",[86,2946,561],{"class":110},[86,2948,2949],{"class":88,"line":199},[86,2950,2951],{"class":110},"      store.subscribe,\n",[86,2953,2954],{"class":88,"line":205},[86,2955,2956],{"class":110},"      store.getState,\n",[86,2958,2959],{"class":88,"line":231},[86,2960,2956],{"class":110},[86,2962,2963],{"class":88,"line":251},[86,2964,2965],{"class":110},"      selector\n",[86,2967,2968,2971,2973,2975,2977,2979],{"class":88,"line":257},[86,2969,2970],{"class":110},"    ) ",[86,2972,211],{"class":99},[86,2974,2859],{"class":103},[86,2976,217],{"class":110},[86,2978,2905],{"class":103},[86,2980,2981],{"class":110},">;\n",[86,2983,2984],{"class":88,"line":263},[86,2985,1140],{"class":110},[86,2987,2988],{"class":88,"line":292},[86,2989,93],{"emptyLinePlaceholder":92},[86,2991,2992,2994],{"class":88,"line":299},[86,2993,1118],{"class":99},[86,2995,2996],{"class":110}," useSelector;\n",[86,2998,2999],{"class":88,"line":311},[86,3000,931],{"class":110},[11,3002,3004],{"id":3003},"global-store","Глобальный стор",[16,3006,3007,3008,3011],{},"В redux-toolkit есть метод ",[20,3009,3010],{},"configureStore"," для создания глобального стора.\nПредлагаю написать минималистичную версию, которая лишь объединяет редьюсеры и создает store",[76,3013,3015],{"className":78,"code":3014,"language":81,"meta":82,"style":82},"import type { Reducer } from 'redux';\n\ntype SliceAction\u003CType extends string = string, Payload = unknown> = {\n  type: Type,\n  payload: Payload,\n}\n\ntype SimpleSlice\u003CName extends string, ReducerType extends Reducer\u003Cany, any>> = {\n  name: Name;\n  reducer: ReducerType,\n}\n\ntype TypesFromSlices\u003CT> = T extends readonly { name: infer Name extends string, reducer: Reducer\u003Cinfer State, infer Action> }[]\n  ? Action extends SliceAction\u003Cinfer Type, infer Payload>\n  ? {\n    action: SliceAction\u003CType, Payload>,\n    state: { [P in Name]: State }\n  } : never : never\n\nexport const configureStore = \u003C\n  Slice extends SimpleSlice\u003Cstring, Reducer\u003Cany, any, any>>,\n  State extends TypesFromSlices\u003CSlice[]>['state'],\n  Action extends TypesFromSlices\u003CSlice[]>['action'],\n>(slices: Slice[]) => {\n  const reducersByName = slices.reduce((acc, current) => {\n    acc[current.name] = current.reducer;\n    return acc;\n  }, {} as Record\u003Cstring, Reducer>);\n\n  const reducer = combineReducers(reducersByName) as Reducer\u003CState, Action>;\n\n  const store = createStore(reducer);\n\n  return {\n    store,\n  };\n};\n",[20,3016,3017,3032,3036,3069,3079,3089,3093,3097,3138,3148,3160,3164,3168,3231,3257,3263,3282,3308,3324,3328,3341,3373,3394,3413,3432,3461,3471,3477,3495,3499,3528,3532,3547,3551,3557,3562,3566],{"__ignoreMap":82},[86,3018,3019,3021,3023,3026,3028,3030],{"class":88,"line":89},[86,3020,2788],{"class":99},[86,3022,2791],{"class":99},[86,3024,3025],{"class":110}," { Reducer } ",[86,3027,2802],{"class":99},[86,3029,2805],{"class":192},[86,3031,128],{"class":110},[86,3033,3034],{"class":88,"line":96},[86,3035,93],{"emptyLinePlaceholder":92},[86,3037,3038,3040,3043,3045,3047,3049,3051,3053,3055,3057,3059,3061,3063,3065,3067],{"class":88,"line":114},[86,3039,100],{"class":99},[86,3041,3042],{"class":103}," SliceAction",[86,3044,217],{"class":110},[86,3046,1177],{"class":103},[86,3048,797],{"class":99},[86,3050,125],{"class":124},[86,3052,107],{"class":99},[86,3054,125],{"class":124},[86,3056,27],{"class":110},[86,3058,661],{"class":103},[86,3060,107],{"class":99},[86,3062,731],{"class":124},[86,3064,669],{"class":110},[86,3066,305],{"class":99},[86,3068,111],{"class":110},[86,3070,3071,3073,3075,3077],{"class":88,"line":131},[86,3072,1204],{"class":117},[86,3074,121],{"class":99},[86,3076,1209],{"class":103},[86,3078,196],{"class":110},[86,3080,3081,3083,3085,3087],{"class":88,"line":143},[86,3082,691],{"class":117},[86,3084,121],{"class":99},[86,3086,1221],{"class":103},[86,3088,196],{"class":110},[86,3090,3091],{"class":88,"line":155},[86,3092,158],{"class":110},[86,3094,3095],{"class":88,"line":161},[86,3096,93],{"emptyLinePlaceholder":92},[86,3098,3099,3101,3104,3106,3108,3110,3112,3114,3117,3119,3122,3124,3127,3129,3131,3134,3136],{"class":88,"line":166},[86,3100,100],{"class":99},[86,3102,3103],{"class":103}," SimpleSlice",[86,3105,217],{"class":110},[86,3107,1059],{"class":103},[86,3109,797],{"class":99},[86,3111,125],{"class":124},[86,3113,27],{"class":110},[86,3115,3116],{"class":103},"ReducerType",[86,3118,797],{"class":99},[86,3120,3121],{"class":103}," Reducer",[86,3123,217],{"class":110},[86,3125,3126],{"class":124},"any",[86,3128,27],{"class":110},[86,3130,3126],{"class":124},[86,3132,3133],{"class":110},">> ",[86,3135,305],{"class":99},[86,3137,111],{"class":110},[86,3139,3140,3142,3144,3146],{"class":88,"line":186},[86,3141,884],{"class":117},[86,3143,121],{"class":99},[86,3145,889],{"class":103},[86,3147,128],{"class":110},[86,3149,3150,3153,3155,3158],{"class":88,"line":199},[86,3151,3152],{"class":117},"  reducer",[86,3154,121],{"class":99},[86,3156,3157],{"class":103}," ReducerType",[86,3159,196],{"class":110},[86,3161,3162],{"class":88,"line":205},[86,3163,158],{"class":110},[86,3165,3166],{"class":88,"line":231},[86,3167,93],{"emptyLinePlaceholder":92},[86,3169,3170,3172,3175,3177,3180,3182,3184,3187,3189,3192,3194,3196,3198,3201,3203,3205,3207,3209,3211,3213,3215,3217,3220,3222,3224,3226,3228],{"class":88,"line":251},[86,3171,100],{"class":99},[86,3173,3174],{"class":103}," TypesFromSlices",[86,3176,217],{"class":110},[86,3178,3179],{"class":103},"T",[86,3181,669],{"class":110},[86,3183,305],{"class":99},[86,3185,3186],{"class":103}," T",[86,3188,797],{"class":99},[86,3190,3191],{"class":99}," readonly",[86,3193,1680],{"class":110},[86,3195,1823],{"class":117},[86,3197,121],{"class":99},[86,3199,3200],{"class":99}," infer",[86,3202,889],{"class":103},[86,3204,797],{"class":99},[86,3206,125],{"class":124},[86,3208,27],{"class":110},[86,3210,2465],{"class":117},[86,3212,121],{"class":99},[86,3214,3121],{"class":103},[86,3216,217],{"class":110},[86,3218,3219],{"class":99},"infer",[86,3221,684],{"class":103},[86,3223,27],{"class":110},[86,3225,3219],{"class":99},[86,3227,1172],{"class":103},[86,3229,3230],{"class":110},"> }[]\n",[86,3232,3233,3236,3238,3240,3242,3244,3246,3248,3250,3252,3254],{"class":88,"line":257},[86,3234,3235],{"class":99},"  ?",[86,3237,1172],{"class":103},[86,3239,797],{"class":99},[86,3241,3042],{"class":103},[86,3243,217],{"class":110},[86,3245,3219],{"class":99},[86,3247,1209],{"class":103},[86,3249,27],{"class":110},[86,3251,3219],{"class":99},[86,3253,1221],{"class":103},[86,3255,3256],{"class":110},">\n",[86,3258,3259,3261],{"class":88,"line":263},[86,3260,3235],{"class":99},[86,3262,111],{"class":110},[86,3264,3265,3268,3270,3272,3274,3276,3278,3280],{"class":88,"line":292},[86,3266,3267],{"class":117},"    action",[86,3269,121],{"class":99},[86,3271,3042],{"class":103},[86,3273,217],{"class":110},[86,3275,1177],{"class":103},[86,3277,27],{"class":110},[86,3279,661],{"class":103},[86,3281,228],{"class":110},[86,3283,3284,3287,3289,3292,3295,3297,3299,3302,3304,3306],{"class":88,"line":299},[86,3285,3286],{"class":117},"    state",[86,3288,121],{"class":99},[86,3290,3291],{"class":110}," { [",[86,3293,3294],{"class":103},"P",[86,3296,2103],{"class":99},[86,3298,889],{"class":103},[86,3300,3301],{"class":110},"]",[86,3303,121],{"class":99},[86,3305,684],{"class":103},[86,3307,2174],{"class":110},[86,3309,3310,3313,3315,3318,3321],{"class":88,"line":311},[86,3311,3312],{"class":110},"  } ",[86,3314,121],{"class":99},[86,3316,3317],{"class":124}," never",[86,3319,3320],{"class":99}," :",[86,3322,3323],{"class":124}," never\n",[86,3325,3326],{"class":88,"line":322},[86,3327,93],{"emptyLinePlaceholder":92},[86,3329,3330,3332,3334,3337,3339],{"class":88,"line":328},[86,3331,169],{"class":99},[86,3333,172],{"class":99},[86,3335,3336],{"class":103}," configureStore",[86,3338,107],{"class":99},[86,3340,948],{"class":110},[86,3342,3343,3346,3348,3350,3352,3354,3356,3359,3361,3363,3365,3367,3369,3371],{"class":88,"line":353},[86,3344,3345],{"class":103},"  Slice",[86,3347,797],{"class":99},[86,3349,3103],{"class":103},[86,3351,217],{"class":110},[86,3353,220],{"class":124},[86,3355,27],{"class":110},[86,3357,3358],{"class":103},"Reducer",[86,3360,217],{"class":110},[86,3362,3126],{"class":124},[86,3364,27],{"class":110},[86,3366,3126],{"class":124},[86,3368,27],{"class":110},[86,3370,3126],{"class":124},[86,3372,846],{"class":110},[86,3374,3375,3377,3379,3381,3383,3386,3389,3392],{"class":88,"line":367},[86,3376,806],{"class":103},[86,3378,797],{"class":99},[86,3380,3174],{"class":103},[86,3382,217],{"class":110},[86,3384,3385],{"class":103},"Slice",[86,3387,3388],{"class":110},"[]>[",[86,3390,3391],{"class":192},"'state'",[86,3393,1670],{"class":110},[86,3395,3396,3398,3400,3402,3404,3406,3408,3411],{"class":88,"line":376},[86,3397,1675],{"class":103},[86,3399,797],{"class":99},[86,3401,3174],{"class":103},[86,3403,217],{"class":110},[86,3405,3385],{"class":103},[86,3407,3388],{"class":110},[86,3409,3410],{"class":192},"'action'",[86,3412,1670],{"class":110},[86,3414,3415,3417,3420,3422,3425,3428,3430],{"class":88,"line":383},[86,3416,2877],{"class":110},[86,3418,3419],{"class":117},"slices",[86,3421,121],{"class":99},[86,3423,3424],{"class":103}," Slice",[86,3426,3427],{"class":110},"[]) ",[86,3429,287],{"class":99},[86,3431,111],{"class":110},[86,3433,3434,3436,3439,3441,3444,3446,3448,3450,3452,3455,3457,3459],{"class":88,"line":389},[86,3435,1754],{"class":99},[86,3437,3438],{"class":124}," reducersByName",[86,3440,107],{"class":99},[86,3442,3443],{"class":110}," slices.",[86,3445,1791],{"class":103},[86,3447,1794],{"class":110},[86,3449,1797],{"class":117},[86,3451,27],{"class":110},[86,3453,3454],{"class":117},"current",[86,3456,284],{"class":110},[86,3458,287],{"class":99},[86,3460,111],{"class":110},[86,3462,3463,3466,3468],{"class":88,"line":394},[86,3464,3465],{"class":110},"    acc[current.name] ",[86,3467,305],{"class":99},[86,3469,3470],{"class":110}," current.reducer;\n",[86,3472,3473,3475],{"class":88,"line":400},[86,3474,1851],{"class":99},[86,3476,1854],{"class":110},[86,3478,3479,3481,3483,3485,3487,3489,3491,3493],{"class":88,"line":426},[86,3480,1859],{"class":110},[86,3482,211],{"class":99},[86,3484,214],{"class":103},[86,3486,217],{"class":110},[86,3488,220],{"class":124},[86,3490,27],{"class":110},[86,3492,3358],{"class":103},[86,3494,1875],{"class":110},[86,3496,3497],{"class":88,"line":432},[86,3498,93],{"emptyLinePlaceholder":92},[86,3500,3501,3503,3505,3507,3510,3513,3515,3517,3519,3521,3523,3526],{"class":88,"line":438},[86,3502,1754],{"class":99},[86,3504,1886],{"class":124},[86,3506,107],{"class":99},[86,3508,3509],{"class":103}," combineReducers",[86,3511,3512],{"class":110},"(reducersByName) ",[86,3514,211],{"class":99},[86,3516,3121],{"class":103},[86,3518,217],{"class":110},[86,3520,656],{"class":103},[86,3522,27],{"class":110},[86,3524,3525],{"class":103},"Action",[86,3527,2981],{"class":110},[86,3529,3530],{"class":88,"line":443},[86,3531,93],{"emptyLinePlaceholder":92},[86,3533,3534,3536,3539,3541,3544],{"class":88,"line":452},[86,3535,1754],{"class":99},[86,3537,3538],{"class":124}," store",[86,3540,107],{"class":99},[86,3542,3543],{"class":103}," createStore",[86,3545,3546],{"class":110},"(reducer);\n",[86,3548,3549],{"class":88,"line":461},[86,3550,93],{"emptyLinePlaceholder":92},[86,3552,3553,3555],{"class":88,"line":466},[86,3554,1118],{"class":99},[86,3556,111],{"class":110},[86,3558,3559],{"class":88,"line":472},[86,3560,3561],{"class":110},"    store,\n",[86,3563,3564],{"class":88,"line":477},[86,3565,1140],{"class":110},[86,3567,3568],{"class":88,"line":483},[86,3569,931],{"class":110},[16,3571,3572,3573,3576,3577,3579,3580,3583,3584,3586,3587,1467,3589,3591,3592,3594,3595,3597,3598,1467,3600,3602,3603,3605,3606,1467,3608,3610,3611,1467,3613],{},"Чтобы правильно типизировать созданный стор, нужно указать стейт и экшены редьюсера,\nкоторый будет создан при помощи ",[20,3574,3575],{},"combineReducers",".\nМы можем извлечь стейт и экшены из редьюсеров при помощи ",[20,3578,3219],{},".\nВ хелпере ",[20,3581,3582],{},"TypesFromSlices"," мы постепенно проверяем сначала, что ",[20,3585,3179],{}," расширяет массив объектов,\nгде есть два интересующих нас поля - ",[20,3588,1823],{},[20,3590,2465],{},". Мы можем вытащить типы этих полей при помощи ",[20,3593,3219],{},".\nПохожим образом при помощи ",[20,3596,3219],{}," можно вытащить типы ",[20,3599,656],{},[20,3601,3525],{},".\nИз ",[20,3604,3525],{}," в свою очередь можно достать ",[20,3607,1177],{},[20,3609,661],{},".\nПосле этого мы можем вернуть извлеченные типы для ",[20,3612,1802],{},[20,3614,272],{},[11,3616,3618],{"id":3617},"bring-all-together","Собираем все вместе",[76,3620,3623],{"className":78,"code":3621,"filename":3622,"language":81,"meta":82,"style":82},"\nimport { createStore, combineReducers } from 'redux';\nimport type { Store as ReduxStore, Reducer } from 'redux';\nimport { produce } from 'immer';\nimport { useSyncExternalStoreWithSelector } from 'use-sync-external-store/with-selector';\n\ntype SliceActionCreator\u003CState, Payload = any> = (state: State, payload: Payload) => void\n\ntype SliceSelector\u003CState, Payload = any> = (state: State, payload: Payload) => void\n\ntype Scoped\u003CString extends string, Scope extends string> = `${Scope}/${String}`;\n\ntype CreateSliceProps\u003C\n  Name extends string,\n  State extends Record\u003Cstring, unknown>,\n  Actions extends Record\u003Cstring, SliceActionCreator\u003CState>>,\n  Selectors extends Record\u003Cstring, SliceSelector\u003CState>>\n> = {\n  name: Name\n  actions: Actions\n  defaultState: State\n  selectors: Selectors\n}\n\nexport const createSlice = \u003C\n  Name extends string,\n  State extends Record\u003Cstring, unknown>,\n  Actions extends Record\u003Cstring, SliceActionCreator\u003CState>>,\n  ActionKey extends Extract\u003Ckeyof Actions, string>,\n  ScopedActionType extends Scoped\u003CActionKey, Name>,\n  Selectors extends Record\u003Cstring, SliceSelector\u003CState>>,\n  ActionPayload extends Parameters\u003CActions[ActionKey]>[1],\n  Action extends { type: ScopedActionType, payload: ActionPayload },\n>({\n    name,\n    actions,\n    defaultState,\n    selectors,\n  }: CreateSliceProps\u003CName, State, Actions, Selectors>) => {\n  const actionKeys = Object.keys(actions) as ActionKey[];\n  const actionTypeByActionKey = actionKeys.reduce((acc, action) => {\n    const scopedActionType = `${name}/${action}` as ScopedActionType;\n    acc[scopedActionType] = action;\n    return acc;\n  }, {} as Record\u003CScopedActionType, ActionKey>);\n\n  const reducer = (state: State = defaultState, action: Action) => {\n    const nextState = produce(state, draft => {\n      const actionType = actionTypeByActionKey[action.type];\n      actions[actionType]?.(draft as State, action.payload);\n    });\n    return nextState;\n  };\n\n  const sliceActions = actionKeys.reduce((acc, curr) => {\n    acc[curr] = (payload) => {\n      const scopedActionType = `${name}/${curr}` as ScopedActionType;\n\n      return {\n        type: scopedActionType,\n        payload,\n      };\n    };\n    return acc;\n  }, {} as {\n    [ActionKey in Extract\u003Ckeyof Actions, string>]: \u003CP extends Parameters\u003CActions[ActionKey]>[1]>(payload: P) => { type: Scoped\u003CActionKey, Name>, payload: P }\n  });\n\n  return {\n    name,\n    reducer,\n    actions: sliceActions,\n    selectors: selectors,\n  };\n};\n\ntype SliceAction\u003CType extends string = string, Payload = unknown> = {\n  type: Type,\n  payload: Payload,\n}\n\ntype SimpleSlice\u003CName extends string, ReducerType extends Reducer\u003Cany, any>> = {\n  name: Name;\n  reducer: ReducerType,\n}\n\ntype TypesFromSlices\u003CT> = T extends { name: infer Name extends string, reducer: Reducer\u003Cinfer State, infer Action> }[]\n  ? Action extends SliceAction\u003Cinfer Type, infer Payload>\n  ? {\n    action: SliceAction\u003CType, Payload>,\n    state: { [P in Name]: State }\n  } : never : never\n\nexport const configureStore = \u003C\n  Slice extends SimpleSlice\u003Cstring, Reducer\u003Cany, any, any>>,\n  State extends TypesFromSlices\u003CSlice[]>['state'],\n  Action extends TypesFromSlices\u003CSlice[]>['action'],\n>(slices: Slice[]) => {\n  const reducersByName = slices.reduce((acc, current) => {\n    acc[current.name] = current.reducer;\n    return acc;\n  }, {} as Record\u003Cstring, Reducer>);\n\n  const reducer = combineReducers(reducersByName) as Reducer\u003CState, Action>;\n\n  const store = createStore(reducer);\n\n  return {\n    store,\n  };\n};\n\nexport const createUseSelector = \u003C\n  Store extends ReduxStore,\n  State extends ReturnType\u003CStore['getState']>,\n>(store: Store) => {\n  const useSelector = \u003CSelector extends (state: State) => unknown>(selector: Selector) => {\n    return useSyncExternalStoreWithSelector(\n      store.subscribe,\n      store.getState,\n      store.getState,\n      selector\n    ) as ReturnType\u003CSelector>;\n  };\n\n  return useSelector;\n};\n\n","myReduxToolkit.ts",[20,3624,3625,3629,3642,3661,3675,3687,3691,3736,3740,3784,3788,3826,3830,3838,3848,3866,3888,3910,3918,3927,3936,3945,3954,3958,3962,3974,3984,4002,4024,4044,4062,4084,4106,4130,4134,4138,4142,4146,4150,4180,4200,4226,4250,4258,4264,4282,4286,4318,4336,4346,4356,4361,4368,4373,4378,4405,4422,4447,4452,4459,4464,4469,4474,4479,4486,4495,4579,4584,4589,4596,4601,4606,4611,4617,4622,4627,4632,4665,4676,4687,4692,4697,4734,4745,4756,4761,4766,4821,4846,4853,4872,4895,4908,4913,4926,4957,4976,4995,5012,5039,5048,5055,5074,5079,5106,5111,5124,5129,5136,5141,5146,5151,5156,5169,5180,5199,5216,5259,5268,5273,5278,5283,5288,5303,5308,5313,5320],{"__ignoreMap":82},[86,3626,3627],{"class":88,"line":89},[86,3628,93],{"emptyLinePlaceholder":92},[86,3630,3631,3633,3636,3638,3640],{"class":88,"line":96},[86,3632,2788],{"class":99},[86,3634,3635],{"class":110}," { createStore, combineReducers } ",[86,3637,2802],{"class":99},[86,3639,2805],{"class":192},[86,3641,128],{"class":110},[86,3643,3644,3646,3648,3650,3652,3655,3657,3659],{"class":88,"line":114},[86,3645,2788],{"class":99},[86,3647,2791],{"class":99},[86,3649,2794],{"class":110},[86,3651,211],{"class":99},[86,3653,3654],{"class":110}," ReduxStore, Reducer } ",[86,3656,2802],{"class":99},[86,3658,2805],{"class":192},[86,3660,128],{"class":110},[86,3662,3663,3665,3668,3670,3673],{"class":88,"line":131},[86,3664,2788],{"class":99},[86,3666,3667],{"class":110}," { produce } ",[86,3669,2802],{"class":99},[86,3671,3672],{"class":192}," 'immer'",[86,3674,128],{"class":110},[86,3676,3677,3679,3681,3683,3685],{"class":88,"line":143},[86,3678,2788],{"class":99},[86,3680,2814],{"class":110},[86,3682,2802],{"class":99},[86,3684,2819],{"class":192},[86,3686,128],{"class":110},[86,3688,3689],{"class":88,"line":155},[86,3690,93],{"emptyLinePlaceholder":92},[86,3692,3693,3695,3697,3699,3701,3703,3705,3707,3709,3711,3713,3715,3717,3719,3721,3723,3725,3727,3729,3731,3733],{"class":88,"line":161},[86,3694,100],{"class":99},[86,3696,651],{"class":103},[86,3698,217],{"class":110},[86,3700,656],{"class":103},[86,3702,27],{"class":110},[86,3704,661],{"class":103},[86,3706,107],{"class":99},[86,3708,666],{"class":124},[86,3710,669],{"class":110},[86,3712,305],{"class":99},[86,3714,1381],{"class":110},[86,3716,272],{"class":117},[86,3718,121],{"class":99},[86,3720,684],{"class":103},[86,3722,27],{"class":110},[86,3724,1160],{"class":117},[86,3726,121],{"class":99},[86,3728,1221],{"class":103},[86,3730,284],{"class":110},[86,3732,287],{"class":99},[86,3734,3735],{"class":124}," void\n",[86,3737,3738],{"class":88,"line":166},[86,3739,93],{"emptyLinePlaceholder":92},[86,3741,3742,3744,3746,3748,3750,3752,3754,3756,3758,3760,3762,3764,3766,3768,3770,3772,3774,3776,3778,3780,3782],{"class":88,"line":186},[86,3743,100],{"class":99},[86,3745,718],{"class":103},[86,3747,217],{"class":110},[86,3749,656],{"class":103},[86,3751,27],{"class":110},[86,3753,661],{"class":103},[86,3755,107],{"class":99},[86,3757,666],{"class":124},[86,3759,669],{"class":110},[86,3761,305],{"class":99},[86,3763,1381],{"class":110},[86,3765,272],{"class":117},[86,3767,121],{"class":99},[86,3769,684],{"class":103},[86,3771,27],{"class":110},[86,3773,1160],{"class":117},[86,3775,121],{"class":99},[86,3777,1221],{"class":103},[86,3779,284],{"class":110},[86,3781,287],{"class":99},[86,3783,3735],{"class":124},[86,3785,3786],{"class":88,"line":199},[86,3787,93],{"emptyLinePlaceholder":92},[86,3789,3790,3792,3794,3796,3798,3800,3802,3804,3806,3808,3810,3812,3814,3816,3818,3820,3822,3824],{"class":88,"line":205},[86,3791,100],{"class":99},[86,3793,1497],{"class":103},[86,3795,217],{"class":110},[86,3797,1502],{"class":103},[86,3799,797],{"class":99},[86,3801,125],{"class":124},[86,3803,27],{"class":110},[86,3805,1511],{"class":103},[86,3807,797],{"class":99},[86,3809,125],{"class":124},[86,3811,669],{"class":110},[86,3813,305],{"class":99},[86,3815,1522],{"class":192},[86,3817,1511],{"class":103},[86,3819,1527],{"class":192},[86,3821,1502],{"class":103},[86,3823,1532],{"class":192},[86,3825,128],{"class":110},[86,3827,3828],{"class":88,"line":231},[86,3829,93],{"emptyLinePlaceholder":92},[86,3831,3832,3834,3836],{"class":88,"line":251},[86,3833,100],{"class":99},[86,3835,786],{"class":103},[86,3837,789],{"class":110},[86,3839,3840,3842,3844,3846],{"class":88,"line":257},[86,3841,794],{"class":103},[86,3843,797],{"class":99},[86,3845,125],{"class":124},[86,3847,196],{"class":110},[86,3849,3850,3852,3854,3856,3858,3860,3862,3864],{"class":88,"line":263},[86,3851,806],{"class":103},[86,3853,797],{"class":99},[86,3855,214],{"class":103},[86,3857,217],{"class":110},[86,3859,220],{"class":124},[86,3861,27],{"class":110},[86,3863,819],{"class":124},[86,3865,228],{"class":110},[86,3867,3868,3870,3872,3874,3876,3878,3880,3882,3884,3886],{"class":88,"line":292},[86,3869,826],{"class":103},[86,3871,797],{"class":99},[86,3873,214],{"class":103},[86,3875,217],{"class":110},[86,3877,220],{"class":124},[86,3879,27],{"class":110},[86,3881,839],{"class":103},[86,3883,217],{"class":110},[86,3885,656],{"class":103},[86,3887,846],{"class":110},[86,3889,3890,3892,3894,3896,3898,3900,3902,3904,3906,3908],{"class":88,"line":299},[86,3891,851],{"class":103},[86,3893,797],{"class":99},[86,3895,214],{"class":103},[86,3897,217],{"class":110},[86,3899,220],{"class":124},[86,3901,27],{"class":110},[86,3903,864],{"class":103},[86,3905,217],{"class":110},[86,3907,656],{"class":103},[86,3909,871],{"class":110},[86,3911,3912,3914,3916],{"class":88,"line":311},[86,3913,669],{"class":110},[86,3915,305],{"class":99},[86,3917,111],{"class":110},[86,3919,3920,3922,3924],{"class":88,"line":322},[86,3921,884],{"class":117},[86,3923,121],{"class":99},[86,3925,3926],{"class":103}," Name\n",[86,3928,3929,3931,3933],{"class":88,"line":328},[86,3930,896],{"class":117},[86,3932,121],{"class":99},[86,3934,3935],{"class":103}," Actions\n",[86,3937,3938,3940,3942],{"class":88,"line":353},[86,3939,908],{"class":117},[86,3941,121],{"class":99},[86,3943,3944],{"class":103}," State\n",[86,3946,3947,3949,3951],{"class":88,"line":367},[86,3948,919],{"class":117},[86,3950,121],{"class":99},[86,3952,3953],{"class":103}," Selectors\n",[86,3955,3956],{"class":88,"line":376},[86,3957,158],{"class":110},[86,3959,3960],{"class":88,"line":383},[86,3961,93],{"emptyLinePlaceholder":92},[86,3963,3964,3966,3968,3970,3972],{"class":88,"line":389},[86,3965,169],{"class":99},[86,3967,172],{"class":99},[86,3969,180],{"class":103},[86,3971,107],{"class":99},[86,3973,948],{"class":110},[86,3975,3976,3978,3980,3982],{"class":88,"line":394},[86,3977,794],{"class":103},[86,3979,797],{"class":99},[86,3981,125],{"class":124},[86,3983,196],{"class":110},[86,3985,3986,3988,3990,3992,3994,3996,3998,4000],{"class":88,"line":400},[86,3987,806],{"class":103},[86,3989,797],{"class":99},[86,3991,214],{"class":103},[86,3993,217],{"class":110},[86,3995,220],{"class":124},[86,3997,27],{"class":110},[86,3999,819],{"class":124},[86,4001,228],{"class":110},[86,4003,4004,4006,4008,4010,4012,4014,4016,4018,4020,4022],{"class":88,"line":426},[86,4005,826],{"class":103},[86,4007,797],{"class":99},[86,4009,214],{"class":103},[86,4011,217],{"class":110},[86,4013,220],{"class":124},[86,4015,27],{"class":110},[86,4017,839],{"class":103},[86,4019,217],{"class":110},[86,4021,656],{"class":103},[86,4023,846],{"class":110},[86,4025,4026,4028,4030,4032,4034,4036,4038,4040,4042],{"class":88,"line":432},[86,4027,1605],{"class":103},[86,4029,797],{"class":99},[86,4031,1610],{"class":103},[86,4033,217],{"class":110},[86,4035,1615],{"class":99},[86,4037,901],{"class":103},[86,4039,27],{"class":110},[86,4041,220],{"class":124},[86,4043,228],{"class":110},[86,4045,4046,4048,4050,4052,4054,4056,4058,4060],{"class":88,"line":438},[86,4047,1628],{"class":103},[86,4049,797],{"class":99},[86,4051,1497],{"class":103},[86,4053,217],{"class":110},[86,4055,1466],{"class":103},[86,4057,27],{"class":110},[86,4059,1059],{"class":103},[86,4061,228],{"class":110},[86,4063,4064,4066,4068,4070,4072,4074,4076,4078,4080,4082],{"class":88,"line":443},[86,4065,851],{"class":103},[86,4067,797],{"class":99},[86,4069,214],{"class":103},[86,4071,217],{"class":110},[86,4073,220],{"class":124},[86,4075,27],{"class":110},[86,4077,864],{"class":103},[86,4079,217],{"class":110},[86,4081,656],{"class":103},[86,4083,846],{"class":110},[86,4085,4086,4088,4090,4092,4094,4096,4098,4100,4102,4104],{"class":88,"line":452},[86,4087,1647],{"class":103},[86,4089,797],{"class":99},[86,4091,1652],{"class":103},[86,4093,217],{"class":110},[86,4095,1068],{"class":103},[86,4097,1659],{"class":110},[86,4099,1466],{"class":103},[86,4101,1664],{"class":110},[86,4103,1667],{"class":124},[86,4105,1670],{"class":110},[86,4107,4108,4110,4112,4114,4116,4118,4120,4122,4124,4126,4128],{"class":88,"line":461},[86,4109,1675],{"class":103},[86,4111,797],{"class":99},[86,4113,1680],{"class":110},[86,4115,100],{"class":117},[86,4117,121],{"class":99},[86,4119,1687],{"class":103},[86,4121,27],{"class":110},[86,4123,1160],{"class":117},[86,4125,121],{"class":99},[86,4127,1696],{"class":103},[86,4129,1699],{"class":110},[86,4131,4132],{"class":88,"line":466},[86,4133,1025],{"class":110},[86,4135,4136],{"class":88,"line":472},[86,4137,1030],{"class":110},[86,4139,4140],{"class":88,"line":477},[86,4141,1035],{"class":110},[86,4143,4144],{"class":88,"line":483},[86,4145,1040],{"class":110},[86,4147,4148],{"class":88,"line":488},[86,4149,1045],{"class":110},[86,4151,4152,4154,4156,4158,4160,4162,4164,4166,4168,4170,4172,4174,4176,4178],{"class":88,"line":494},[86,4153,1050],{"class":110},[86,4155,121],{"class":99},[86,4157,786],{"class":103},[86,4159,217],{"class":110},[86,4161,1059],{"class":103},[86,4163,27],{"class":110},[86,4165,656],{"class":103},[86,4167,27],{"class":110},[86,4169,1068],{"class":103},[86,4171,27],{"class":110},[86,4173,1073],{"class":103},[86,4175,1076],{"class":110},[86,4177,287],{"class":99},[86,4179,111],{"class":110},[86,4181,4182,4184,4186,4188,4190,4192,4194,4196,4198],{"class":88,"line":530},[86,4183,1754],{"class":99},[86,4185,1757],{"class":124},[86,4187,107],{"class":99},[86,4189,1762],{"class":110},[86,4191,1765],{"class":103},[86,4193,1768],{"class":110},[86,4195,211],{"class":99},[86,4197,1773],{"class":103},[86,4199,1776],{"class":110},[86,4201,4202,4204,4206,4208,4210,4212,4214,4216,4218,4220,4222,4224],{"class":88,"line":535},[86,4203,1754],{"class":99},[86,4205,1783],{"class":124},[86,4207,107],{"class":99},[86,4209,1788],{"class":110},[86,4211,1791],{"class":103},[86,4213,1794],{"class":110},[86,4215,1797],{"class":117},[86,4217,27],{"class":110},[86,4219,1802],{"class":117},[86,4221,284],{"class":110},[86,4223,287],{"class":99},[86,4225,111],{"class":110},[86,4227,4228,4230,4232,4234,4236,4238,4240,4242,4244,4246,4248],{"class":88,"line":555},[86,4229,1813],{"class":99},[86,4231,1816],{"class":124},[86,4233,107],{"class":99},[86,4235,1522],{"class":192},[86,4237,1823],{"class":110},[86,4239,1527],{"class":192},[86,4241,1802],{"class":110},[86,4243,1532],{"class":192},[86,4245,1832],{"class":99},[86,4247,1687],{"class":103},[86,4249,128],{"class":110},[86,4251,4252,4254,4256],{"class":88,"line":564},[86,4253,1841],{"class":110},[86,4255,305],{"class":99},[86,4257,1846],{"class":110},[86,4259,4260,4262],{"class":88,"line":570},[86,4261,1851],{"class":99},[86,4263,1854],{"class":110},[86,4265,4266,4268,4270,4272,4274,4276,4278,4280],{"class":88,"line":581},[86,4267,1859],{"class":110},[86,4269,211],{"class":99},[86,4271,214],{"class":103},[86,4273,217],{"class":110},[86,4275,1868],{"class":103},[86,4277,27],{"class":110},[86,4279,1466],{"class":103},[86,4281,1875],{"class":110},[86,4283,4284],{"class":88,"line":592},[86,4285,93],{"emptyLinePlaceholder":92},[86,4287,4288,4290,4292,4294,4296,4298,4300,4302,4304,4306,4308,4310,4312,4314,4316],{"class":88,"line":603},[86,4289,1754],{"class":99},[86,4291,1886],{"class":103},[86,4293,107],{"class":99},[86,4295,1381],{"class":110},[86,4297,272],{"class":117},[86,4299,121],{"class":99},[86,4301,684],{"class":103},[86,4303,107],{"class":99},[86,4305,1901],{"class":110},[86,4307,1802],{"class":117},[86,4309,121],{"class":99},[86,4311,1172],{"class":103},[86,4313,284],{"class":110},[86,4315,287],{"class":99},[86,4317,111],{"class":110},[86,4319,4320,4322,4324,4326,4328,4330,4332,4334],{"class":88,"line":614},[86,4321,1813],{"class":99},[86,4323,1920],{"class":124},[86,4325,107],{"class":99},[86,4327,1925],{"class":103},[86,4329,1928],{"class":110},[86,4331,1931],{"class":117},[86,4333,512],{"class":99},[86,4335,111],{"class":110},[86,4337,4338,4340,4342,4344],{"class":88,"line":620},[86,4339,356],{"class":99},[86,4341,1942],{"class":124},[86,4343,107],{"class":99},[86,4345,1947],{"class":110},[86,4347,4348,4350,4352,4354],{"class":88,"line":626},[86,4349,1952],{"class":110},[86,4351,211],{"class":99},[86,4353,684],{"class":103},[86,4355,1959],{"class":110},[86,4357,4359],{"class":88,"line":4358},51,[86,4360,1964],{"class":110},[86,4362,4364,4366],{"class":88,"line":4363},52,[86,4365,1851],{"class":99},[86,4367,1971],{"class":110},[86,4369,4371],{"class":88,"line":4370},53,[86,4372,1140],{"class":110},[86,4374,4376],{"class":88,"line":4375},54,[86,4377,93],{"emptyLinePlaceholder":92},[86,4379,4381,4383,4385,4387,4389,4391,4393,4395,4397,4399,4401,4403],{"class":88,"line":4380},55,[86,4382,1754],{"class":99},[86,4384,1986],{"class":124},[86,4386,107],{"class":99},[86,4388,1788],{"class":110},[86,4390,1791],{"class":103},[86,4392,1794],{"class":110},[86,4394,1797],{"class":117},[86,4396,27],{"class":110},[86,4398,2001],{"class":117},[86,4400,284],{"class":110},[86,4402,287],{"class":99},[86,4404,111],{"class":110},[86,4406,4408,4410,4412,4414,4416,4418,4420],{"class":88,"line":4407},56,[86,4409,2012],{"class":110},[86,4411,305],{"class":99},[86,4413,1381],{"class":110},[86,4415,1160],{"class":117},[86,4417,284],{"class":110},[86,4419,287],{"class":99},[86,4421,111],{"class":110},[86,4423,4425,4427,4429,4431,4433,4435,4437,4439,4441,4443,4445],{"class":88,"line":4424},57,[86,4426,356],{"class":99},[86,4428,1816],{"class":124},[86,4430,107],{"class":99},[86,4432,1522],{"class":192},[86,4434,1823],{"class":110},[86,4436,1527],{"class":192},[86,4438,2001],{"class":110},[86,4440,1532],{"class":192},[86,4442,1832],{"class":99},[86,4444,1687],{"class":103},[86,4446,128],{"class":110},[86,4448,4450],{"class":88,"line":4449},58,[86,4451,93],{"emptyLinePlaceholder":92},[86,4453,4455,4457],{"class":88,"line":4454},59,[86,4456,2057],{"class":99},[86,4458,111],{"class":110},[86,4460,4462],{"class":88,"line":4461},60,[86,4463,2064],{"class":110},[86,4465,4467],{"class":88,"line":4466},61,[86,4468,2069],{"class":110},[86,4470,4472],{"class":88,"line":4471},62,[86,4473,2074],{"class":110},[86,4475,4477],{"class":88,"line":4476},63,[86,4478,2079],{"class":110},[86,4480,4482,4484],{"class":88,"line":4481},64,[86,4483,1851],{"class":99},[86,4485,1854],{"class":110},[86,4487,4489,4491,4493],{"class":88,"line":4488},65,[86,4490,1859],{"class":110},[86,4492,211],{"class":99},[86,4494,111],{"class":110},[86,4496,4498,4500,4502,4504,4506,4508,4510,4512,4514,4516,4518,4520,4522,4524,4526,4528,4530,4532,4534,4536,4538,4540,4543,4545,4547,4549,4551,4553,4555,4557,4559,4561,4563,4565,4567,4569,4571,4573,4575,4577],{"class":88,"line":4497},66,[86,4499,2098],{"class":110},[86,4501,1466],{"class":103},[86,4503,2103],{"class":99},[86,4505,1610],{"class":103},[86,4507,217],{"class":110},[86,4509,1615],{"class":99},[86,4511,901],{"class":103},[86,4513,27],{"class":110},[86,4515,220],{"class":124},[86,4517,2118],{"class":110},[86,4519,121],{"class":99},[86,4521,2902],{"class":110},[86,4523,3294],{"class":103},[86,4525,797],{"class":99},[86,4527,1652],{"class":103},[86,4529,217],{"class":110},[86,4531,1068],{"class":103},[86,4533,1659],{"class":110},[86,4535,1466],{"class":103},[86,4537,1664],{"class":110},[86,4539,1667],{"class":124},[86,4541,4542],{"class":110},"]>(",[86,4544,1160],{"class":117},[86,4546,121],{"class":99},[86,4548,2171],{"class":103},[86,4550,284],{"class":110},[86,4552,287],{"class":99},[86,4554,1680],{"class":110},[86,4556,100],{"class":117},[86,4558,121],{"class":99},[86,4560,1497],{"class":103},[86,4562,217],{"class":110},[86,4564,1466],{"class":103},[86,4566,27],{"class":110},[86,4568,1059],{"class":103},[86,4570,2164],{"class":110},[86,4572,1160],{"class":117},[86,4574,121],{"class":99},[86,4576,2171],{"class":103},[86,4578,2174],{"class":110},[86,4580,4582],{"class":88,"line":4581},67,[86,4583,2179],{"class":110},[86,4585,4587],{"class":88,"line":4586},68,[86,4588,93],{"emptyLinePlaceholder":92},[86,4590,4592,4594],{"class":88,"line":4591},69,[86,4593,1118],{"class":99},[86,4595,111],{"class":110},[86,4597,4599],{"class":88,"line":4598},70,[86,4600,1030],{"class":110},[86,4602,4604],{"class":88,"line":4603},71,[86,4605,1125],{"class":110},[86,4607,4609],{"class":88,"line":4608},72,[86,4610,1135],{"class":110},[86,4612,4614],{"class":88,"line":4613},73,[86,4615,4616],{"class":110},"    selectors: selectors,\n",[86,4618,4620],{"class":88,"line":4619},74,[86,4621,1140],{"class":110},[86,4623,4625],{"class":88,"line":4624},75,[86,4626,931],{"class":110},[86,4628,4630],{"class":88,"line":4629},76,[86,4631,93],{"emptyLinePlaceholder":92},[86,4633,4635,4637,4639,4641,4643,4645,4647,4649,4651,4653,4655,4657,4659,4661,4663],{"class":88,"line":4634},77,[86,4636,100],{"class":99},[86,4638,3042],{"class":103},[86,4640,217],{"class":110},[86,4642,1177],{"class":103},[86,4644,797],{"class":99},[86,4646,125],{"class":124},[86,4648,107],{"class":99},[86,4650,125],{"class":124},[86,4652,27],{"class":110},[86,4654,661],{"class":103},[86,4656,107],{"class":99},[86,4658,731],{"class":124},[86,4660,669],{"class":110},[86,4662,305],{"class":99},[86,4664,111],{"class":110},[86,4666,4668,4670,4672,4674],{"class":88,"line":4667},78,[86,4669,1204],{"class":117},[86,4671,121],{"class":99},[86,4673,1209],{"class":103},[86,4675,196],{"class":110},[86,4677,4679,4681,4683,4685],{"class":88,"line":4678},79,[86,4680,691],{"class":117},[86,4682,121],{"class":99},[86,4684,1221],{"class":103},[86,4686,196],{"class":110},[86,4688,4690],{"class":88,"line":4689},80,[86,4691,158],{"class":110},[86,4693,4695],{"class":88,"line":4694},81,[86,4696,93],{"emptyLinePlaceholder":92},[86,4698,4700,4702,4704,4706,4708,4710,4712,4714,4716,4718,4720,4722,4724,4726,4728,4730,4732],{"class":88,"line":4699},82,[86,4701,100],{"class":99},[86,4703,3103],{"class":103},[86,4705,217],{"class":110},[86,4707,1059],{"class":103},[86,4709,797],{"class":99},[86,4711,125],{"class":124},[86,4713,27],{"class":110},[86,4715,3116],{"class":103},[86,4717,797],{"class":99},[86,4719,3121],{"class":103},[86,4721,217],{"class":110},[86,4723,3126],{"class":124},[86,4725,27],{"class":110},[86,4727,3126],{"class":124},[86,4729,3133],{"class":110},[86,4731,305],{"class":99},[86,4733,111],{"class":110},[86,4735,4737,4739,4741,4743],{"class":88,"line":4736},83,[86,4738,884],{"class":117},[86,4740,121],{"class":99},[86,4742,889],{"class":103},[86,4744,128],{"class":110},[86,4746,4748,4750,4752,4754],{"class":88,"line":4747},84,[86,4749,3152],{"class":117},[86,4751,121],{"class":99},[86,4753,3157],{"class":103},[86,4755,196],{"class":110},[86,4757,4759],{"class":88,"line":4758},85,[86,4760,158],{"class":110},[86,4762,4764],{"class":88,"line":4763},86,[86,4765,93],{"emptyLinePlaceholder":92},[86,4767,4769,4771,4773,4775,4777,4779,4781,4783,4785,4787,4789,4791,4793,4795,4797,4799,4801,4803,4805,4807,4809,4811,4813,4815,4817,4819],{"class":88,"line":4768},87,[86,4770,100],{"class":99},[86,4772,3174],{"class":103},[86,4774,217],{"class":110},[86,4776,3179],{"class":103},[86,4778,669],{"class":110},[86,4780,305],{"class":99},[86,4782,3186],{"class":103},[86,4784,797],{"class":99},[86,4786,1680],{"class":110},[86,4788,1823],{"class":117},[86,4790,121],{"class":99},[86,4792,3200],{"class":99},[86,4794,889],{"class":103},[86,4796,797],{"class":99},[86,4798,125],{"class":124},[86,4800,27],{"class":110},[86,4802,2465],{"class":117},[86,4804,121],{"class":99},[86,4806,3121],{"class":103},[86,4808,217],{"class":110},[86,4810,3219],{"class":99},[86,4812,684],{"class":103},[86,4814,27],{"class":110},[86,4816,3219],{"class":99},[86,4818,1172],{"class":103},[86,4820,3230],{"class":110},[86,4822,4824,4826,4828,4830,4832,4834,4836,4838,4840,4842,4844],{"class":88,"line":4823},88,[86,4825,3235],{"class":99},[86,4827,1172],{"class":103},[86,4829,797],{"class":99},[86,4831,3042],{"class":103},[86,4833,217],{"class":110},[86,4835,3219],{"class":99},[86,4837,1209],{"class":103},[86,4839,27],{"class":110},[86,4841,3219],{"class":99},[86,4843,1221],{"class":103},[86,4845,3256],{"class":110},[86,4847,4849,4851],{"class":88,"line":4848},89,[86,4850,3235],{"class":99},[86,4852,111],{"class":110},[86,4854,4856,4858,4860,4862,4864,4866,4868,4870],{"class":88,"line":4855},90,[86,4857,3267],{"class":117},[86,4859,121],{"class":99},[86,4861,3042],{"class":103},[86,4863,217],{"class":110},[86,4865,1177],{"class":103},[86,4867,27],{"class":110},[86,4869,661],{"class":103},[86,4871,228],{"class":110},[86,4873,4875,4877,4879,4881,4883,4885,4887,4889,4891,4893],{"class":88,"line":4874},91,[86,4876,3286],{"class":117},[86,4878,121],{"class":99},[86,4880,3291],{"class":110},[86,4882,3294],{"class":103},[86,4884,2103],{"class":99},[86,4886,889],{"class":103},[86,4888,3301],{"class":110},[86,4890,121],{"class":99},[86,4892,684],{"class":103},[86,4894,2174],{"class":110},[86,4896,4898,4900,4902,4904,4906],{"class":88,"line":4897},92,[86,4899,3312],{"class":110},[86,4901,121],{"class":99},[86,4903,3317],{"class":124},[86,4905,3320],{"class":99},[86,4907,3323],{"class":124},[86,4909,4911],{"class":88,"line":4910},93,[86,4912,93],{"emptyLinePlaceholder":92},[86,4914,4916,4918,4920,4922,4924],{"class":88,"line":4915},94,[86,4917,169],{"class":99},[86,4919,172],{"class":99},[86,4921,3336],{"class":103},[86,4923,107],{"class":99},[86,4925,948],{"class":110},[86,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955],{"class":88,"line":4928},95,[86,4930,3345],{"class":103},[86,4932,797],{"class":99},[86,4934,3103],{"class":103},[86,4936,217],{"class":110},[86,4938,220],{"class":124},[86,4940,27],{"class":110},[86,4942,3358],{"class":103},[86,4944,217],{"class":110},[86,4946,3126],{"class":124},[86,4948,27],{"class":110},[86,4950,3126],{"class":124},[86,4952,27],{"class":110},[86,4954,3126],{"class":124},[86,4956,846],{"class":110},[86,4958,4960,4962,4964,4966,4968,4970,4972,4974],{"class":88,"line":4959},96,[86,4961,806],{"class":103},[86,4963,797],{"class":99},[86,4965,3174],{"class":103},[86,4967,217],{"class":110},[86,4969,3385],{"class":103},[86,4971,3388],{"class":110},[86,4973,3391],{"class":192},[86,4975,1670],{"class":110},[86,4977,4979,4981,4983,4985,4987,4989,4991,4993],{"class":88,"line":4978},97,[86,4980,1675],{"class":103},[86,4982,797],{"class":99},[86,4984,3174],{"class":103},[86,4986,217],{"class":110},[86,4988,3385],{"class":103},[86,4990,3388],{"class":110},[86,4992,3410],{"class":192},[86,4994,1670],{"class":110},[86,4996,4998,5000,5002,5004,5006,5008,5010],{"class":88,"line":4997},98,[86,4999,2877],{"class":110},[86,5001,3419],{"class":117},[86,5003,121],{"class":99},[86,5005,3424],{"class":103},[86,5007,3427],{"class":110},[86,5009,287],{"class":99},[86,5011,111],{"class":110},[86,5013,5015,5017,5019,5021,5023,5025,5027,5029,5031,5033,5035,5037],{"class":88,"line":5014},99,[86,5016,1754],{"class":99},[86,5018,3438],{"class":124},[86,5020,107],{"class":99},[86,5022,3443],{"class":110},[86,5024,1791],{"class":103},[86,5026,1794],{"class":110},[86,5028,1797],{"class":117},[86,5030,27],{"class":110},[86,5032,3454],{"class":117},[86,5034,284],{"class":110},[86,5036,287],{"class":99},[86,5038,111],{"class":110},[86,5040,5042,5044,5046],{"class":88,"line":5041},100,[86,5043,3465],{"class":110},[86,5045,305],{"class":99},[86,5047,3470],{"class":110},[86,5049,5051,5053],{"class":88,"line":5050},101,[86,5052,1851],{"class":99},[86,5054,1854],{"class":110},[86,5056,5058,5060,5062,5064,5066,5068,5070,5072],{"class":88,"line":5057},102,[86,5059,1859],{"class":110},[86,5061,211],{"class":99},[86,5063,214],{"class":103},[86,5065,217],{"class":110},[86,5067,220],{"class":124},[86,5069,27],{"class":110},[86,5071,3358],{"class":103},[86,5073,1875],{"class":110},[86,5075,5077],{"class":88,"line":5076},103,[86,5078,93],{"emptyLinePlaceholder":92},[86,5080,5082,5084,5086,5088,5090,5092,5094,5096,5098,5100,5102,5104],{"class":88,"line":5081},104,[86,5083,1754],{"class":99},[86,5085,1886],{"class":124},[86,5087,107],{"class":99},[86,5089,3509],{"class":103},[86,5091,3512],{"class":110},[86,5093,211],{"class":99},[86,5095,3121],{"class":103},[86,5097,217],{"class":110},[86,5099,656],{"class":103},[86,5101,27],{"class":110},[86,5103,3525],{"class":103},[86,5105,2981],{"class":110},[86,5107,5109],{"class":88,"line":5108},105,[86,5110,93],{"emptyLinePlaceholder":92},[86,5112,5114,5116,5118,5120,5122],{"class":88,"line":5113},106,[86,5115,1754],{"class":99},[86,5117,3538],{"class":124},[86,5119,107],{"class":99},[86,5121,3543],{"class":103},[86,5123,3546],{"class":110},[86,5125,5127],{"class":88,"line":5126},107,[86,5128,93],{"emptyLinePlaceholder":92},[86,5130,5132,5134],{"class":88,"line":5131},108,[86,5133,1118],{"class":99},[86,5135,111],{"class":110},[86,5137,5139],{"class":88,"line":5138},109,[86,5140,3561],{"class":110},[86,5142,5144],{"class":88,"line":5143},110,[86,5145,1140],{"class":110},[86,5147,5149],{"class":88,"line":5148},111,[86,5150,931],{"class":110},[86,5152,5154],{"class":88,"line":5153},112,[86,5155,93],{"emptyLinePlaceholder":92},[86,5157,5159,5161,5163,5165,5167],{"class":88,"line":5158},113,[86,5160,169],{"class":99},[86,5162,172],{"class":99},[86,5164,2834],{"class":103},[86,5166,107],{"class":99},[86,5168,948],{"class":110},[86,5170,5172,5174,5176,5178],{"class":88,"line":5171},114,[86,5173,2843],{"class":103},[86,5175,797],{"class":99},[86,5177,2848],{"class":103},[86,5179,196],{"class":110},[86,5181,5183,5185,5187,5189,5191,5193,5195,5197],{"class":88,"line":5182},115,[86,5184,806],{"class":103},[86,5186,797],{"class":99},[86,5188,2859],{"class":103},[86,5190,217],{"class":110},[86,5192,2864],{"class":103},[86,5194,1659],{"class":110},[86,5196,2869],{"class":192},[86,5198,2872],{"class":110},[86,5200,5202,5204,5206,5208,5210,5212,5214],{"class":88,"line":5201},116,[86,5203,2877],{"class":110},[86,5205,2880],{"class":117},[86,5207,121],{"class":99},[86,5209,2885],{"class":103},[86,5211,284],{"class":110},[86,5213,287],{"class":99},[86,5215,111],{"class":110},[86,5217,5219,5221,5223,5225,5227,5229,5231,5233,5235,5237,5239,5241,5243,5245,5247,5249,5251,5253,5255,5257],{"class":88,"line":5218},117,[86,5220,1754],{"class":99},[86,5222,504],{"class":103},[86,5224,107],{"class":99},[86,5226,2902],{"class":110},[86,5228,2905],{"class":103},[86,5230,797],{"class":99},[86,5232,1381],{"class":110},[86,5234,272],{"class":117},[86,5236,121],{"class":99},[86,5238,684],{"class":103},[86,5240,284],{"class":110},[86,5242,287],{"class":99},[86,5244,731],{"class":124},[86,5246,2877],{"class":110},[86,5248,2926],{"class":117},[86,5250,121],{"class":99},[86,5252,2931],{"class":103},[86,5254,284],{"class":110},[86,5256,287],{"class":99},[86,5258,111],{"class":110},[86,5260,5262,5264,5266],{"class":88,"line":5261},118,[86,5263,1851],{"class":99},[86,5265,2944],{"class":103},[86,5267,561],{"class":110},[86,5269,5271],{"class":88,"line":5270},119,[86,5272,2951],{"class":110},[86,5274,5276],{"class":88,"line":5275},120,[86,5277,2956],{"class":110},[86,5279,5281],{"class":88,"line":5280},121,[86,5282,2956],{"class":110},[86,5284,5286],{"class":88,"line":5285},122,[86,5287,2965],{"class":110},[86,5289,5291,5293,5295,5297,5299,5301],{"class":88,"line":5290},123,[86,5292,2970],{"class":110},[86,5294,211],{"class":99},[86,5296,2859],{"class":103},[86,5298,217],{"class":110},[86,5300,2905],{"class":103},[86,5302,2981],{"class":110},[86,5304,5306],{"class":88,"line":5305},124,[86,5307,1140],{"class":110},[86,5309,5311],{"class":88,"line":5310},125,[86,5312,93],{"emptyLinePlaceholder":92},[86,5314,5316,5318],{"class":88,"line":5315},126,[86,5317,1118],{"class":99},[86,5319,2996],{"class":110},[86,5321,5323],{"class":88,"line":5322},127,[86,5324,931],{"class":110},[76,5326,5329],{"className":78,"code":5327,"filename":5328,"language":81,"meta":82,"style":82},"import { createSlice } from \"@/myReduxToolkit\";\n\ntype User = {\n  id: string;\n  username: string;\n  displayName: string;\n}\n\nexport const usersSlice = createSlice({\n  name: 'users',\n  defaultState: {\n    userById: {} as Record\u003Cstring, User>,\n    usernameById: {} as Record\u003Cstring, string>,\n  },\n  actions: {\n    addUser: (state, user: User) => {\n      state.userById[user.id] = user;\n      state.usernameById[user.username] = user.id;\n    },\n    deleteUser: (state, userId: string) => {\n      const user = state.userById[userId];\n      delete state.usernameById[user.username];\n      delete state.userById[userId];\n    }\n  },\n  selectors: {\n    selectUserByUsername: (state, username: string) => state.userById[state.usernameById[username]],\n    selectAllUsers: (state) => Object.values(state.userById),\n  }\n});\n\n","store/users/slice.ts",[20,5330,5331,5345,5349,5359,5369,5379,5389,5393,5397,5411,5419,5423,5441,5459,5463,5467,5489,5497,5505,5509,5531,5541,5547,5553,5557,5561,5565,5587,5608,5612],{"__ignoreMap":82},[86,5332,5333,5335,5338,5340,5343],{"class":88,"line":89},[86,5334,2788],{"class":99},[86,5336,5337],{"class":110}," { createSlice } ",[86,5339,2802],{"class":99},[86,5341,5342],{"class":192}," \"@/myReduxToolkit\"",[86,5344,128],{"class":110},[86,5346,5347],{"class":88,"line":96},[86,5348,93],{"emptyLinePlaceholder":92},[86,5350,5351,5353,5355,5357],{"class":88,"line":114},[86,5352,100],{"class":99},[86,5354,104],{"class":103},[86,5356,107],{"class":99},[86,5358,111],{"class":110},[86,5360,5361,5363,5365,5367],{"class":88,"line":131},[86,5362,118],{"class":117},[86,5364,121],{"class":99},[86,5366,125],{"class":124},[86,5368,128],{"class":110},[86,5370,5371,5373,5375,5377],{"class":88,"line":143},[86,5372,134],{"class":117},[86,5374,121],{"class":99},[86,5376,125],{"class":124},[86,5378,128],{"class":110},[86,5380,5381,5383,5385,5387],{"class":88,"line":155},[86,5382,146],{"class":117},[86,5384,121],{"class":99},[86,5386,125],{"class":124},[86,5388,128],{"class":110},[86,5390,5391],{"class":88,"line":161},[86,5392,158],{"class":110},[86,5394,5395],{"class":88,"line":166},[86,5396,93],{"emptyLinePlaceholder":92},[86,5398,5399,5401,5403,5405,5407,5409],{"class":88,"line":186},[86,5400,169],{"class":99},[86,5402,172],{"class":99},[86,5404,175],{"class":124},[86,5406,107],{"class":99},[86,5408,180],{"class":103},[86,5410,183],{"class":110},[86,5412,5413,5415,5417],{"class":88,"line":199},[86,5414,189],{"class":110},[86,5416,193],{"class":192},[86,5418,196],{"class":110},[86,5420,5421],{"class":88,"line":205},[86,5422,202],{"class":110},[86,5424,5425,5427,5429,5431,5433,5435,5437,5439],{"class":88,"line":231},[86,5426,208],{"class":110},[86,5428,211],{"class":99},[86,5430,214],{"class":103},[86,5432,217],{"class":110},[86,5434,220],{"class":124},[86,5436,27],{"class":110},[86,5438,225],{"class":103},[86,5440,228],{"class":110},[86,5442,5443,5445,5447,5449,5451,5453,5455,5457],{"class":88,"line":251},[86,5444,234],{"class":110},[86,5446,211],{"class":99},[86,5448,214],{"class":103},[86,5450,217],{"class":110},[86,5452,220],{"class":124},[86,5454,27],{"class":110},[86,5456,220],{"class":124},[86,5458,228],{"class":110},[86,5460,5461],{"class":88,"line":257},[86,5462,254],{"class":110},[86,5464,5465],{"class":88,"line":263},[86,5466,260],{"class":110},[86,5468,5469,5471,5473,5475,5477,5479,5481,5483,5485,5487],{"class":88,"line":292},[86,5470,266],{"class":103},[86,5472,269],{"class":110},[86,5474,272],{"class":117},[86,5476,27],{"class":110},[86,5478,277],{"class":117},[86,5480,121],{"class":99},[86,5482,104],{"class":103},[86,5484,284],{"class":110},[86,5486,287],{"class":99},[86,5488,111],{"class":110},[86,5490,5491,5493,5495],{"class":88,"line":299},[86,5492,302],{"class":110},[86,5494,305],{"class":99},[86,5496,308],{"class":110},[86,5498,5499,5501,5503],{"class":88,"line":311},[86,5500,314],{"class":110},[86,5502,305],{"class":99},[86,5504,319],{"class":110},[86,5506,5507],{"class":88,"line":322},[86,5508,325],{"class":110},[86,5510,5511,5513,5515,5517,5519,5521,5523,5525,5527,5529],{"class":88,"line":328},[86,5512,331],{"class":103},[86,5514,269],{"class":110},[86,5516,272],{"class":117},[86,5518,27],{"class":110},[86,5520,340],{"class":117},[86,5522,121],{"class":99},[86,5524,125],{"class":124},[86,5526,284],{"class":110},[86,5528,287],{"class":99},[86,5530,111],{"class":110},[86,5532,5533,5535,5537,5539],{"class":88,"line":353},[86,5534,356],{"class":99},[86,5536,359],{"class":124},[86,5538,107],{"class":99},[86,5540,364],{"class":110},[86,5542,5543,5545],{"class":88,"line":367},[86,5544,370],{"class":99},[86,5546,373],{"class":110},[86,5548,5549,5551],{"class":88,"line":376},[86,5550,370],{"class":99},[86,5552,364],{"class":110},[86,5554,5555],{"class":88,"line":383},[86,5556,386],{"class":110},[86,5558,5559],{"class":88,"line":389},[86,5560,254],{"class":110},[86,5562,5563],{"class":88,"line":394},[86,5564,397],{"class":110},[86,5566,5567,5569,5571,5573,5575,5577,5579,5581,5583,5585],{"class":88,"line":400},[86,5568,403],{"class":103},[86,5570,269],{"class":110},[86,5572,272],{"class":117},[86,5574,27],{"class":110},[86,5576,412],{"class":117},[86,5578,121],{"class":99},[86,5580,125],{"class":124},[86,5582,284],{"class":110},[86,5584,287],{"class":99},[86,5586,423],{"class":110},[86,5588,5589,5592,5594,5596,5598,5600,5602,5605],{"class":88,"line":426},[86,5590,5591],{"class":103},"    selectAllUsers",[86,5593,269],{"class":110},[86,5595,272],{"class":117},[86,5597,284],{"class":110},[86,5599,287],{"class":99},[86,5601,1762],{"class":110},[86,5603,5604],{"class":103},"values",[86,5606,5607],{"class":110},"(state.userById),\n",[86,5609,5610],{"class":88,"line":432},[86,5611,429],{"class":110},[86,5613,5614],{"class":88,"line":438},[86,5615,435],{"class":110},[76,5617,5620],{"className":78,"code":5618,"filename":5619,"language":81,"meta":82,"style":82},"import { configureStore, createUseSelector } from '@/myReduxToolkit';\nimport { usersSlice } from './users/slice';\n\nexport const { store } = configureStore([usersSlice]);\n\nexport const useSelector = createUseSelector(store);\n\n","store/index.ts",[20,5621,5622,5636,5650,5654,5674,5678],{"__ignoreMap":82},[86,5623,5624,5626,5629,5631,5634],{"class":88,"line":89},[86,5625,2788],{"class":99},[86,5627,5628],{"class":110}," { configureStore, createUseSelector } ",[86,5630,2802],{"class":99},[86,5632,5633],{"class":192}," '@/myReduxToolkit'",[86,5635,128],{"class":110},[86,5637,5638,5640,5643,5645,5648],{"class":88,"line":96},[86,5639,2788],{"class":99},[86,5641,5642],{"class":110}," { usersSlice } ",[86,5644,2802],{"class":99},[86,5646,5647],{"class":192}," './users/slice'",[86,5649,128],{"class":110},[86,5651,5652],{"class":88,"line":114},[86,5653,93],{"emptyLinePlaceholder":92},[86,5655,5656,5658,5660,5662,5664,5667,5669,5671],{"class":88,"line":131},[86,5657,169],{"class":99},[86,5659,172],{"class":99},[86,5661,1680],{"class":110},[86,5663,2880],{"class":124},[86,5665,5666],{"class":110}," } ",[86,5668,305],{"class":99},[86,5670,3336],{"class":103},[86,5672,5673],{"class":110},"([usersSlice]);\n",[86,5675,5676],{"class":88,"line":143},[86,5677,93],{"emptyLinePlaceholder":92},[86,5679,5680,5682,5684,5686,5688,5690],{"class":88,"line":155},[86,5681,169],{"class":99},[86,5683,172],{"class":99},[86,5685,504],{"class":124},[86,5687,107],{"class":99},[86,5689,2834],{"class":103},[86,5691,5692],{"class":110},"(store);\n",[76,5694,5699],{"className":5695,"code":5696,"filename":5697,"language":5698,"meta":82,"style":82},"language-tsx shiki shiki-themes github-light github-dark","const Test = () => {\n  const allUsers = useSelector(state => usersSlice.selectors.selectAllUsers(state.users));\n\n  console.log({\n    allUsers\n  });\n\n  return \u003Cdiv>\n    \u003Cbutton onClick={() => {\n      console.log(usersSlice.actions);\n      store.dispatch(usersSlice.actions.addUser({\n        displayName: String(Math.random()),\n        id: String(Math.random()),\n        username: String(Math.random()),\n      }));\n      console.log(store.getState());\n    }}>Add new user\u003C/button>\n\n    {allUsers.map((user) => \u003Cdiv key={user.username}>\n      \u003Cp>{user.displayName}\u003C/p>\n      \u003Cp>@{user.username}\u003C/p>\n    \u003C/div>)}\n  \u003C/div>;\n};\n","components/SomeComponent.tsx","tsx",[20,5700,5701,5716,5742,5746,5756,5761,5765,5769,5781,5801,5811,5826,5842,5855,5868,5873,5888,5897,5901,5929,5943,5956,5966,5975],{"__ignoreMap":82},[86,5702,5703,5705,5708,5710,5712,5714],{"class":88,"line":89},[86,5704,497],{"class":99},[86,5706,5707],{"class":103}," Test",[86,5709,107],{"class":99},[86,5711,2670],{"class":110},[86,5713,287],{"class":99},[86,5715,111],{"class":110},[86,5717,5718,5720,5723,5725,5727,5729,5731,5733,5736,5739],{"class":88,"line":96},[86,5719,1754],{"class":99},[86,5721,5722],{"class":124}," allUsers",[86,5724,107],{"class":99},[86,5726,504],{"class":103},[86,5728,507],{"class":110},[86,5730,272],{"class":117},[86,5732,512],{"class":99},[86,5734,5735],{"class":110}," usersSlice.selectors.",[86,5737,5738],{"class":103},"selectAllUsers",[86,5740,5741],{"class":110},"(state.users));\n",[86,5743,5744],{"class":88,"line":114},[86,5745,93],{"emptyLinePlaceholder":92},[86,5747,5748,5751,5754],{"class":88,"line":131},[86,5749,5750],{"class":110},"  console.",[86,5752,5753],{"class":103},"log",[86,5755,183],{"class":110},[86,5757,5758],{"class":88,"line":143},[86,5759,5760],{"class":110},"    allUsers\n",[86,5762,5763],{"class":88,"line":155},[86,5764,2179],{"class":110},[86,5766,5767],{"class":88,"line":161},[86,5768,93],{"emptyLinePlaceholder":92},[86,5770,5771,5773,5775,5779],{"class":88,"line":166},[86,5772,1118],{"class":99},[86,5774,2902],{"class":110},[86,5776,5778],{"class":5777},"s9eBZ","div",[86,5780,3256],{"class":110},[86,5782,5783,5786,5789,5792,5794,5797,5799],{"class":88,"line":186},[86,5784,5785],{"class":110},"    \u003C",[86,5787,5788],{"class":5777},"button",[86,5790,5791],{"class":103}," onClick",[86,5793,305],{"class":99},[86,5795,5796],{"class":110},"{() ",[86,5798,287],{"class":99},[86,5800,111],{"class":110},[86,5802,5803,5806,5808],{"class":88,"line":199},[86,5804,5805],{"class":110},"      console.",[86,5807,5753],{"class":103},[86,5809,5810],{"class":110},"(usersSlice.actions);\n",[86,5812,5813,5816,5819,5822,5824],{"class":88,"line":205},[86,5814,5815],{"class":110},"      store.",[86,5817,5818],{"class":103},"dispatch",[86,5820,5821],{"class":110},"(usersSlice.actions.",[86,5823,576],{"class":103},[86,5825,183],{"class":110},[86,5827,5828,5831,5833,5836,5839],{"class":88,"line":231},[86,5829,5830],{"class":110},"        displayName: ",[86,5832,1502],{"class":103},[86,5834,5835],{"class":110},"(Math.",[86,5837,5838],{"class":103},"random",[86,5840,5841],{"class":110},"()),\n",[86,5843,5844,5847,5849,5851,5853],{"class":88,"line":251},[86,5845,5846],{"class":110},"        id: ",[86,5848,1502],{"class":103},[86,5850,5835],{"class":110},[86,5852,5838],{"class":103},[86,5854,5841],{"class":110},[86,5856,5857,5860,5862,5864,5866],{"class":88,"line":257},[86,5858,5859],{"class":110},"        username: ",[86,5861,1502],{"class":103},[86,5863,5835],{"class":110},[86,5865,5838],{"class":103},[86,5867,5841],{"class":110},[86,5869,5870],{"class":88,"line":263},[86,5871,5872],{"class":110},"      }));\n",[86,5874,5875,5877,5879,5882,5885],{"class":88,"line":292},[86,5876,5805],{"class":110},[86,5878,5753],{"class":103},[86,5880,5881],{"class":110},"(store.",[86,5883,5884],{"class":103},"getState",[86,5886,5887],{"class":110},"());\n",[86,5889,5890,5893,5895],{"class":88,"line":299},[86,5891,5892],{"class":110},"    }}>Add new user\u003C/",[86,5894,5788],{"class":5777},[86,5896,3256],{"class":110},[86,5898,5899],{"class":88,"line":311},[86,5900,93],{"emptyLinePlaceholder":92},[86,5902,5903,5906,5909,5911,5913,5915,5917,5919,5921,5924,5926],{"class":88,"line":322},[86,5904,5905],{"class":110},"    {allUsers.",[86,5907,5908],{"class":103},"map",[86,5910,1794],{"class":110},[86,5912,277],{"class":117},[86,5914,284],{"class":110},[86,5916,287],{"class":99},[86,5918,2902],{"class":110},[86,5920,5778],{"class":5777},[86,5922,5923],{"class":103}," key",[86,5925,305],{"class":99},[86,5927,5928],{"class":110},"{user.username}>\n",[86,5930,5931,5934,5936,5939,5941],{"class":88,"line":328},[86,5932,5933],{"class":110},"      \u003C",[86,5935,16],{"class":5777},[86,5937,5938],{"class":110},">{user.displayName}\u003C/",[86,5940,16],{"class":5777},[86,5942,3256],{"class":110},[86,5944,5945,5947,5949,5952,5954],{"class":88,"line":353},[86,5946,5933],{"class":110},[86,5948,16],{"class":5777},[86,5950,5951],{"class":110},">@{user.username}\u003C/",[86,5953,16],{"class":5777},[86,5955,3256],{"class":110},[86,5957,5958,5961,5963],{"class":88,"line":367},[86,5959,5960],{"class":110},"    \u003C/",[86,5962,5778],{"class":5777},[86,5964,5965],{"class":110},">)}\n",[86,5967,5968,5971,5973],{"class":88,"line":376},[86,5969,5970],{"class":110},"  \u003C/",[86,5972,5778],{"class":5777},[86,5974,2981],{"class":110},[86,5976,5977],{"class":88,"line":383},[86,5978,931],{"class":110},[5980,5981,5982],"style",{},"html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .s4XuR, html code.shiki .s4XuR{--shiki-default:#E36209;--shiki-dark:#FFAB70}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .s9eBZ, html code.shiki .s9eBZ{--shiki-default:#22863A;--shiki-dark:#85E89D}",{"title":82,"searchDepth":96,"depth":96,"links":5984},[5985,5986,5987,5988,5989,5990,5991,5992],{"id":13,"depth":96,"text":14},{"id":70,"depth":96,"text":71},{"id":632,"depth":96,"text":633},{"id":1150,"depth":96,"text":1151},{"id":2465,"depth":96,"text":2466},{"id":2635,"depth":96,"text":2636},{"id":3003,"depth":96,"text":3004},{"id":3617,"depth":96,"text":3618},"2024-02-12","Как работает @reduxjs/toolkit, реализация его упрощенной версии","md",{},"/blog/implementing-own-redux-toolkit","/images/own-redux-preview.webp",{"title":6,"description":5994},"blog/implementing-own-redux-toolkit",[6002,6003,6004,6005],"react","redux","typescript","state-manager","OkJLGUCANe-AwCcFZCoF38kZekYrjpczJ8LxZZaSDu8",{"id":6008,"title":6009,"body":6010,"date":8655,"description":8656,"extension":5995,"meta":8657,"navigation":92,"path":8658,"previewImg":8659,"seo":8660,"stem":8661,"topics":8662,"__hash__":8665},"articles/blog/progressive-images-using-thumbhash.md","Progressive images при помощи base64 миниатюр",{"type":8,"value":6011,"toc":8647},[6012,6016,6019,6029,6032,6038,6045,6048,6054,6057,6063,6070,6074,6077,6084,6562,6565,6570,6677,6683,6864,6878,6889,7183,7186,7197,7200,7225,7228,7296,7299,7403,7406,7685,7689,7700,7946,7951,7958,8304,8308,8314,8644],[11,6013,6015],{"id":6014},"why","Зачем оно вообще нужно",[16,6017,6018],{},"Для начала поговорим про цифры. Если вы когда-нибудь делали аналитику сайта - то вы в курсе, что изображения весьма прожорливые. Скорее всего даже более прожорливые, чем ваш бандл.\nПеред тем, как пытаться оптимизировать что-либо еще - лучше начать именно с картинок.",[16,6020,6021,6022,31,6025,6028],{},"Однако даже если использовать ",[20,6023,6024],{},"WEBP",[20,6026,6027],{},"AVIF"," - картинки все равно будут весить неприлично много.\nОсобенно если их много.\nПри этом всегда стоит держать в голове, что среднестатистический пользователь вашего сайта скорее всего зайдет с мобильного телефона.\nИ у него вряд ли будет быстрый мобильный интернет. А медленный интернет накладывает свои ограничения:",[16,6030,6031],{},"UI может прыгать, пока все картинки не загрузятся (сделаем допущение, что вы не хотите или не можете привести все картинки к одному размеру)\nПри медленном интернете или если сервер слишком далеко от пользователя, он будет видеть огрызки картинок, что прямо скажем не красиво.",[16,6033,6034],{},[2459,6035],{"alt":6036,"src":6037},"Раздражает, правда?","https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNXJtZTh4dGJ2bDBiMnVuZHJkMmc2cWQxZzFkdGdzOXJxYjdhbGYzbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/QIQTfximd3AuQ/giphy.gif",[16,6039,6040,6041,6044],{},"А еще пользователь у нас очень привередливый и если мы не покажем ему хоть что-то в течении первых пары секунд - скорее всего мы его потеряем.\nИменно проблему ",[52,6042,6043],{},"показать хоть что-то"," и призвана решить прогрессивная загрузка изображений.",[16,6046,6047],{},"Идея заключается в том, что мы показываем пользователю миниатюру в низком разрешении, пока грузим оригинальную картинку.",[16,6049,6050],{},[2459,6051],{"alt":6052,"src":6053},"Пример из telegram","/images/progressive-images-using-thumbhash/telegram-example.png",[16,6055,6056],{},"Для реализации такого подхода я выбрал либу thumbhash, она весит \u003C 4kb и позволяет хранить хеш весом всего 30-40 байт.",[6058,6059],"code-example",{"height":6060,"open-file":6061,"project-id":6062},600,"ProgressiveImageExample.tsx","react-ts-c9v55cdz",[16,6064,6065,6066],{},"Еще примеры можно найти на официальном сайте: ",[43,6067,6068],{"href":6068,"rel":6069},"https://evanw.github.io/thumbhash/",[47],[11,6071,6073],{"id":6072},"generate-thumbhash-on-client-side","Генерация thumbhash на клиенте",[16,6075,6076],{},"Рассмотрим кейс, когда пользователь создает новый пост и сам загружает изображение. В этом случае сгенерировать thumb можно прямо на клиенте.",[16,6078,6079,6080,6083],{},"Для начала загрузка изображения - тут все стандартно, подписываемся на ",[20,6081,6082],{},"onChange"," у инпута и достаем оттуда файл",[76,6085,6087],{"className":5695,"code":6086,"language":5698,"meta":82,"style":82},"import { useCallback, useState } from \"react\";\n\nconst loadImage = (imageUrl: string) => {\n  return new Promise\u003CHTMLImageElement>((resolve) => {\n    const img = new Image();\n\n    img.src = imageUrl;\n\n    img.onload = () => {\n      resolve(img);\n    };\n  });\n};\n\nconst getImageUrl = (file: File) => {\n  // You can implement your own upload logic here\n  // For example we just create url on client-side\n  const url = URL.createObjectURL(file); \n  return url;\n};\n\nexport default function App() {\n  const [originalImageSrc, setOriginalImageSrc] = useState(\"\");\n\n  const handleFileUpload = useCallback(\n    async (event: React.ChangeEvent\u003CHTMLInputElement>) => {\n      if (!event.target.files?.length) {\n        return;\n      }\n      const file = event.target.files[0];\n      const url = await getImageUrl(file);\n      setOriginalImageSrc(url);\n    },\n    []\n  );\n\n  return (\n    \u003Cdiv className=\"App\">\n      \u003Cinput type=\"file\" onChange={handleFileUpload} />\n      \u003Cimg src={originalImageSrc} />\n    \u003C/div>\n  );\n}\n",[20,6088,6089,6103,6107,6131,6158,6175,6179,6189,6193,6209,6217,6221,6225,6229,6233,6258,6263,6268,6288,6295,6299,6303,6319,6350,6354,6367,6398,6417,6424,6429,6447,6463,6471,6475,6480,6484,6488,6494,6510,6532,6546,6554,6558],{"__ignoreMap":82},[86,6090,6091,6093,6096,6098,6101],{"class":88,"line":89},[86,6092,2788],{"class":99},[86,6094,6095],{"class":110}," { useCallback, useState } ",[86,6097,2802],{"class":99},[86,6099,6100],{"class":192}," \"react\"",[86,6102,128],{"class":110},[86,6104,6105],{"class":88,"line":96},[86,6106,93],{"emptyLinePlaceholder":92},[86,6108,6109,6111,6114,6116,6118,6121,6123,6125,6127,6129],{"class":88,"line":114},[86,6110,497],{"class":99},[86,6112,6113],{"class":103}," loadImage",[86,6115,107],{"class":99},[86,6117,1381],{"class":110},[86,6119,6120],{"class":117},"imageUrl",[86,6122,121],{"class":99},[86,6124,125],{"class":124},[86,6126,284],{"class":110},[86,6128,287],{"class":99},[86,6130,111],{"class":110},[86,6132,6133,6135,6138,6141,6143,6146,6149,6152,6154,6156],{"class":88,"line":131},[86,6134,1118],{"class":99},[86,6136,6137],{"class":99}," new",[86,6139,6140],{"class":124}," Promise",[86,6142,217],{"class":110},[86,6144,6145],{"class":103},"HTMLImageElement",[86,6147,6148],{"class":110},">((",[86,6150,6151],{"class":117},"resolve",[86,6153,284],{"class":110},[86,6155,287],{"class":99},[86,6157,111],{"class":110},[86,6159,6160,6162,6165,6167,6169,6172],{"class":88,"line":143},[86,6161,1813],{"class":99},[86,6163,6164],{"class":124}," img",[86,6166,107],{"class":99},[86,6168,6137],{"class":99},[86,6170,6171],{"class":103}," Image",[86,6173,6174],{"class":110},"();\n",[86,6176,6177],{"class":88,"line":155},[86,6178,93],{"emptyLinePlaceholder":92},[86,6180,6181,6184,6186],{"class":88,"line":161},[86,6182,6183],{"class":110},"    img.src ",[86,6185,305],{"class":99},[86,6187,6188],{"class":110}," imageUrl;\n",[86,6190,6191],{"class":88,"line":166},[86,6192,93],{"emptyLinePlaceholder":92},[86,6194,6195,6198,6201,6203,6205,6207],{"class":88,"line":186},[86,6196,6197],{"class":110},"    img.",[86,6199,6200],{"class":103},"onload",[86,6202,107],{"class":99},[86,6204,2670],{"class":110},[86,6206,287],{"class":99},[86,6208,111],{"class":110},[86,6210,6211,6214],{"class":88,"line":199},[86,6212,6213],{"class":103},"      resolve",[86,6215,6216],{"class":110},"(img);\n",[86,6218,6219],{"class":88,"line":205},[86,6220,2079],{"class":110},[86,6222,6223],{"class":88,"line":231},[86,6224,2179],{"class":110},[86,6226,6227],{"class":88,"line":251},[86,6228,931],{"class":110},[86,6230,6231],{"class":88,"line":257},[86,6232,93],{"emptyLinePlaceholder":92},[86,6234,6235,6237,6240,6242,6244,6247,6249,6252,6254,6256],{"class":88,"line":263},[86,6236,497],{"class":99},[86,6238,6239],{"class":103}," getImageUrl",[86,6241,107],{"class":99},[86,6243,1381],{"class":110},[86,6245,6246],{"class":117},"file",[86,6248,121],{"class":99},[86,6250,6251],{"class":103}," File",[86,6253,284],{"class":110},[86,6255,287],{"class":99},[86,6257,111],{"class":110},[86,6259,6260],{"class":88,"line":292},[86,6261,6262],{"class":295},"  // You can implement your own upload logic here\n",[86,6264,6265],{"class":88,"line":299},[86,6266,6267],{"class":295},"  // For example we just create url on client-side\n",[86,6269,6270,6272,6275,6277,6280,6282,6285],{"class":88,"line":311},[86,6271,1754],{"class":99},[86,6273,6274],{"class":124}," url",[86,6276,107],{"class":99},[86,6278,6279],{"class":124}," URL",[86,6281,38],{"class":110},[86,6283,6284],{"class":103},"createObjectURL",[86,6286,6287],{"class":110},"(file); \n",[86,6289,6290,6292],{"class":88,"line":322},[86,6291,1118],{"class":99},[86,6293,6294],{"class":110}," url;\n",[86,6296,6297],{"class":88,"line":328},[86,6298,931],{"class":110},[86,6300,6301],{"class":88,"line":353},[86,6302,93],{"emptyLinePlaceholder":92},[86,6304,6305,6307,6310,6313,6316],{"class":88,"line":367},[86,6306,169],{"class":99},[86,6308,6309],{"class":99}," default",[86,6311,6312],{"class":99}," function",[86,6314,6315],{"class":103}," App",[86,6317,6318],{"class":110},"() {\n",[86,6320,6321,6323,6326,6329,6331,6334,6337,6339,6342,6344,6347],{"class":88,"line":376},[86,6322,1754],{"class":99},[86,6324,6325],{"class":110}," [",[86,6327,6328],{"class":124},"originalImageSrc",[86,6330,27],{"class":110},[86,6332,6333],{"class":124},"setOriginalImageSrc",[86,6335,6336],{"class":110},"] ",[86,6338,305],{"class":99},[86,6340,6341],{"class":103}," useState",[86,6343,507],{"class":110},[86,6345,6346],{"class":192},"\"\"",[86,6348,6349],{"class":110},");\n",[86,6351,6352],{"class":88,"line":383},[86,6353,93],{"emptyLinePlaceholder":92},[86,6355,6356,6358,6361,6363,6365],{"class":88,"line":389},[86,6357,1754],{"class":99},[86,6359,6360],{"class":124}," handleFileUpload",[86,6362,107],{"class":99},[86,6364,545],{"class":103},[86,6366,561],{"class":110},[86,6368,6369,6372,6374,6377,6379,6382,6384,6387,6389,6392,6394,6396],{"class":88,"line":394},[86,6370,6371],{"class":99},"    async",[86,6373,1381],{"class":110},[86,6375,6376],{"class":117},"event",[86,6378,121],{"class":99},[86,6380,6381],{"class":103}," React",[86,6383,38],{"class":110},[86,6385,6386],{"class":103},"ChangeEvent",[86,6388,217],{"class":110},[86,6390,6391],{"class":103},"HTMLInputElement",[86,6393,1076],{"class":110},[86,6395,287],{"class":99},[86,6397,111],{"class":110},[86,6399,6400,6403,6405,6408,6411,6414],{"class":88,"line":400},[86,6401,6402],{"class":99},"      if",[86,6404,1381],{"class":110},[86,6406,6407],{"class":99},"!",[86,6409,6410],{"class":110},"event.target.files?.",[86,6412,6413],{"class":124},"length",[86,6415,6416],{"class":110},") {\n",[86,6418,6419,6422],{"class":88,"line":426},[86,6420,6421],{"class":99},"        return",[86,6423,128],{"class":110},[86,6425,6426],{"class":88,"line":432},[86,6427,6428],{"class":110},"      }\n",[86,6430,6431,6433,6436,6438,6441,6444],{"class":88,"line":438},[86,6432,356],{"class":99},[86,6434,6435],{"class":124}," file",[86,6437,107],{"class":99},[86,6439,6440],{"class":110}," event.target.files[",[86,6442,6443],{"class":124},"0",[86,6445,6446],{"class":110},"];\n",[86,6448,6449,6451,6453,6455,6458,6460],{"class":88,"line":443},[86,6450,356],{"class":99},[86,6452,6274],{"class":124},[86,6454,107],{"class":99},[86,6456,6457],{"class":99}," await",[86,6459,6239],{"class":103},[86,6461,6462],{"class":110},"(file);\n",[86,6464,6465,6468],{"class":88,"line":452},[86,6466,6467],{"class":103},"      setOriginalImageSrc",[86,6469,6470],{"class":110},"(url);\n",[86,6472,6473],{"class":88,"line":461},[86,6474,325],{"class":110},[86,6476,6477],{"class":88,"line":466},[86,6478,6479],{"class":110},"    []\n",[86,6481,6482],{"class":88,"line":472},[86,6483,623],{"class":110},[86,6485,6486],{"class":88,"line":477},[86,6487,93],{"emptyLinePlaceholder":92},[86,6489,6490,6492],{"class":88,"line":483},[86,6491,1118],{"class":99},[86,6493,674],{"class":110},[86,6495,6496,6498,6500,6503,6505,6508],{"class":88,"line":488},[86,6497,5785],{"class":110},[86,6499,5778],{"class":5777},[86,6501,6502],{"class":103}," className",[86,6504,305],{"class":99},[86,6506,6507],{"class":192},"\"App\"",[86,6509,3256],{"class":110},[86,6511,6512,6514,6517,6519,6521,6524,6527,6529],{"class":88,"line":494},[86,6513,5933],{"class":110},[86,6515,6516],{"class":5777},"input",[86,6518,2791],{"class":103},[86,6520,305],{"class":99},[86,6522,6523],{"class":192},"\"file\"",[86,6525,6526],{"class":103}," onChange",[86,6528,305],{"class":99},[86,6530,6531],{"class":110},"{handleFileUpload} />\n",[86,6533,6534,6536,6538,6541,6543],{"class":88,"line":530},[86,6535,5933],{"class":110},[86,6537,2459],{"class":5777},[86,6539,6540],{"class":103}," src",[86,6542,305],{"class":99},[86,6544,6545],{"class":110},"{originalImageSrc} />\n",[86,6547,6548,6550,6552],{"class":88,"line":535},[86,6549,5960],{"class":110},[86,6551,5778],{"class":5777},[86,6553,3256],{"class":110},[86,6555,6556],{"class":88,"line":555},[86,6557,623],{"class":110},[86,6559,6560],{"class":88,"line":564},[86,6561,158],{"class":110},[16,6563,6564],{},"Теперь нам необходимо считать файл как картинку, чтобы создать миниатюру.",[16,6566,6567,6568],{},"Для этого напишем небольшой хелпер, который загружает картинку по переданному url и возвращает ",[20,6569,6145],{},[76,6571,6573],{"className":78,"code":6572,"language":81,"meta":82,"style":82},"const loadImage = (imageUrl: string) => {\n  return new Promise\u003CHTMLImageElement>((resolve) => {\n    const img = new Image();\n    img.src = imageUrl;\n\n    img.onload = () => {\n      resolve(img);\n    };\n  });\n};\n",[20,6574,6575,6597,6619,6633,6641,6645,6659,6665,6669,6673],{"__ignoreMap":82},[86,6576,6577,6579,6581,6583,6585,6587,6589,6591,6593,6595],{"class":88,"line":89},[86,6578,497],{"class":99},[86,6580,6113],{"class":103},[86,6582,107],{"class":99},[86,6584,1381],{"class":110},[86,6586,6120],{"class":117},[86,6588,121],{"class":99},[86,6590,125],{"class":124},[86,6592,284],{"class":110},[86,6594,287],{"class":99},[86,6596,111],{"class":110},[86,6598,6599,6601,6603,6605,6607,6609,6611,6613,6615,6617],{"class":88,"line":96},[86,6600,1118],{"class":99},[86,6602,6137],{"class":99},[86,6604,6140],{"class":124},[86,6606,217],{"class":110},[86,6608,6145],{"class":103},[86,6610,6148],{"class":110},[86,6612,6151],{"class":117},[86,6614,284],{"class":110},[86,6616,287],{"class":99},[86,6618,111],{"class":110},[86,6620,6621,6623,6625,6627,6629,6631],{"class":88,"line":114},[86,6622,1813],{"class":99},[86,6624,6164],{"class":124},[86,6626,107],{"class":99},[86,6628,6137],{"class":99},[86,6630,6171],{"class":103},[86,6632,6174],{"class":110},[86,6634,6635,6637,6639],{"class":88,"line":131},[86,6636,6183],{"class":110},[86,6638,305],{"class":99},[86,6640,6188],{"class":110},[86,6642,6643],{"class":88,"line":143},[86,6644,93],{"emptyLinePlaceholder":92},[86,6646,6647,6649,6651,6653,6655,6657],{"class":88,"line":155},[86,6648,6197],{"class":110},[86,6650,6200],{"class":103},[86,6652,107],{"class":99},[86,6654,2670],{"class":110},[86,6656,287],{"class":99},[86,6658,111],{"class":110},[86,6660,6661,6663],{"class":88,"line":161},[86,6662,6213],{"class":103},[86,6664,6216],{"class":110},[86,6666,6667],{"class":88,"line":166},[86,6668,2079],{"class":110},[86,6670,6671],{"class":88,"line":186},[86,6672,2179],{"class":110},[86,6674,6675],{"class":88,"line":199},[86,6676,931],{"class":110},[16,6678,6679,6680,121],{},"Теперь необходимо создать миниатюру изображения, для этого воспользуемся ",[20,6681,6682],{},"canvas",[76,6684,6686],{"className":78,"code":6685,"language":81,"meta":82,"style":82},"const size = Math.max(img.width, img.height);\nconst w = img.width = Math.round(100 * img.width / size);\nconst h = img.height = Math.round(100 * img.height / size);\n\n// Create image thumb (100x100 maximum size)\nconst canvas = document.createElement('canvas');\nconst c = canvas.getContext('2d');\ncanvas.width = w;\ncanvas.height = h;\nc.drawImage(img, 0, 0, w, h);\n",[20,6687,6688,6706,6741,6771,6775,6780,6802,6824,6834,6844],{"__ignoreMap":82},[86,6689,6690,6692,6695,6697,6700,6703],{"class":88,"line":89},[86,6691,497],{"class":99},[86,6693,6694],{"class":124}," size",[86,6696,107],{"class":99},[86,6698,6699],{"class":110}," Math.",[86,6701,6702],{"class":103},"max",[86,6704,6705],{"class":110},"(img.width, img.height);\n",[86,6707,6708,6710,6713,6715,6718,6720,6722,6725,6727,6730,6733,6735,6738],{"class":88,"line":96},[86,6709,497],{"class":99},[86,6711,6712],{"class":124}," w",[86,6714,107],{"class":99},[86,6716,6717],{"class":110}," img.width ",[86,6719,305],{"class":99},[86,6721,6699],{"class":110},[86,6723,6724],{"class":103},"round",[86,6726,507],{"class":110},[86,6728,6729],{"class":124},"100",[86,6731,6732],{"class":99}," *",[86,6734,6717],{"class":110},[86,6736,6737],{"class":99},"/",[86,6739,6740],{"class":110}," size);\n",[86,6742,6743,6745,6748,6750,6753,6755,6757,6759,6761,6763,6765,6767,6769],{"class":88,"line":114},[86,6744,497],{"class":99},[86,6746,6747],{"class":124}," h",[86,6749,107],{"class":99},[86,6751,6752],{"class":110}," img.height ",[86,6754,305],{"class":99},[86,6756,6699],{"class":110},[86,6758,6724],{"class":103},[86,6760,507],{"class":110},[86,6762,6729],{"class":124},[86,6764,6732],{"class":99},[86,6766,6752],{"class":110},[86,6768,6737],{"class":99},[86,6770,6740],{"class":110},[86,6772,6773],{"class":88,"line":131},[86,6774,93],{"emptyLinePlaceholder":92},[86,6776,6777],{"class":88,"line":143},[86,6778,6779],{"class":295},"// Create image thumb (100x100 maximum size)\n",[86,6781,6782,6784,6787,6789,6792,6795,6797,6800],{"class":88,"line":155},[86,6783,497],{"class":99},[86,6785,6786],{"class":124}," canvas",[86,6788,107],{"class":99},[86,6790,6791],{"class":110}," document.",[86,6793,6794],{"class":103},"createElement",[86,6796,507],{"class":110},[86,6798,6799],{"class":192},"'canvas'",[86,6801,6349],{"class":110},[86,6803,6804,6806,6809,6811,6814,6817,6819,6822],{"class":88,"line":161},[86,6805,497],{"class":99},[86,6807,6808],{"class":124}," c",[86,6810,107],{"class":99},[86,6812,6813],{"class":110}," canvas.",[86,6815,6816],{"class":103},"getContext",[86,6818,507],{"class":110},[86,6820,6821],{"class":192},"'2d'",[86,6823,6349],{"class":110},[86,6825,6826,6829,6831],{"class":88,"line":166},[86,6827,6828],{"class":110},"canvas.width ",[86,6830,305],{"class":99},[86,6832,6833],{"class":110}," w;\n",[86,6835,6836,6839,6841],{"class":88,"line":186},[86,6837,6838],{"class":110},"canvas.height ",[86,6840,305],{"class":99},[86,6842,6843],{"class":110}," h;\n",[86,6845,6846,6849,6852,6855,6857,6859,6861],{"class":88,"line":199},[86,6847,6848],{"class":110},"c.",[86,6850,6851],{"class":103},"drawImage",[86,6853,6854],{"class":110},"(img, ",[86,6856,6443],{"class":124},[86,6858,27],{"class":110},[86,6860,6443],{"class":124},[86,6862,6863],{"class":110},", w, h);\n",[16,6865,6866,6867,6874,6875,38],{},"После чего достаем из полученной миниатюры ",[43,6868,6871],{"href":6869,"rel":6870},"https://developer.mozilla.org/en-US/docs/Web/API/ImageData",[47],[20,6872,6873],{},"ImageData"," и скармливаем полученный массив пикселей методу ",[20,6876,6877],{},"rgbaToThumbHash",[16,6879,6880,6881,6884,6885,6888],{},"Полученный ",[52,6882,6883],{},"Uint8Array"," я конвертирую в ",[52,6886,6887],{},"base64"," строку, которую мы затем можем сохранить на сервере.",[76,6890,6893],{"className":78,"code":6891,"highlights":6892,"language":81,"meta":82,"style":82},"import { rgbaToThumbHash } from 'thumbhash';\n\nasync function generateImageThumb(img: HTMLImageElement) {\n  const size = Math.max(img.width, img.height);\n  const w = img.width = Math.round(100 * img.width / size);\n  const h = img.height = Math.round(100 * img.height / size);\n\n  // // Create image thumb (100x100 maximum size)\n  const canvas = document.createElement('canvas');\n  const c = canvas.getContext('2d');\n  canvas.width = w;\n  canvas.height = h;\n  c.drawImage(img, 0, 0, w, h);\n  // Get pixels array\n  const pixels = c.getImageData(0, 0, w, h);\n  // Get thumbhash (Uint8Array)\n  const hash = rgbaToThumbHash(w, h, pixels.data);\n  // convert Uint8Array to base64 string\n  const binString = String.fromCodePoint(...hash);\n  return btoa(binString);\n}\n",[263,299,322],[20,6894,6895,6909,6913,6934,6948,6976,7004,7008,7016,7034,7052,7061,7070,7087,7092,7119,7124,7140,7145,7169,7179],{"__ignoreMap":82},[86,6896,6897,6899,6902,6904,6907],{"class":88,"line":89},[86,6898,2788],{"class":99},[86,6900,6901],{"class":110}," { rgbaToThumbHash } ",[86,6903,2802],{"class":99},[86,6905,6906],{"class":192}," 'thumbhash'",[86,6908,128],{"class":110},[86,6910,6911],{"class":88,"line":96},[86,6912,93],{"emptyLinePlaceholder":92},[86,6914,6915,6918,6920,6923,6925,6927,6929,6932],{"class":88,"line":114},[86,6916,6917],{"class":99},"async",[86,6919,6312],{"class":99},[86,6921,6922],{"class":103}," generateImageThumb",[86,6924,507],{"class":110},[86,6926,2459],{"class":117},[86,6928,121],{"class":99},[86,6930,6931],{"class":103}," HTMLImageElement",[86,6933,6416],{"class":110},[86,6935,6936,6938,6940,6942,6944,6946],{"class":88,"line":131},[86,6937,1754],{"class":99},[86,6939,6694],{"class":124},[86,6941,107],{"class":99},[86,6943,6699],{"class":110},[86,6945,6702],{"class":103},[86,6947,6705],{"class":110},[86,6949,6950,6952,6954,6956,6958,6960,6962,6964,6966,6968,6970,6972,6974],{"class":88,"line":143},[86,6951,1754],{"class":99},[86,6953,6712],{"class":124},[86,6955,107],{"class":99},[86,6957,6717],{"class":110},[86,6959,305],{"class":99},[86,6961,6699],{"class":110},[86,6963,6724],{"class":103},[86,6965,507],{"class":110},[86,6967,6729],{"class":124},[86,6969,6732],{"class":99},[86,6971,6717],{"class":110},[86,6973,6737],{"class":99},[86,6975,6740],{"class":110},[86,6977,6978,6980,6982,6984,6986,6988,6990,6992,6994,6996,6998,7000,7002],{"class":88,"line":155},[86,6979,1754],{"class":99},[86,6981,6747],{"class":124},[86,6983,107],{"class":99},[86,6985,6752],{"class":110},[86,6987,305],{"class":99},[86,6989,6699],{"class":110},[86,6991,6724],{"class":103},[86,6993,507],{"class":110},[86,6995,6729],{"class":124},[86,6997,6732],{"class":99},[86,6999,6752],{"class":110},[86,7001,6737],{"class":99},[86,7003,6740],{"class":110},[86,7005,7006],{"class":88,"line":161},[86,7007,93],{"emptyLinePlaceholder":92},[86,7009,7010,7013],{"class":88,"line":166},[86,7011,7012],{"class":295},"  //",[86,7014,7015],{"class":295}," // Create image thumb (100x100 maximum size)\n",[86,7017,7018,7020,7022,7024,7026,7028,7030,7032],{"class":88,"line":186},[86,7019,1754],{"class":99},[86,7021,6786],{"class":124},[86,7023,107],{"class":99},[86,7025,6791],{"class":110},[86,7027,6794],{"class":103},[86,7029,507],{"class":110},[86,7031,6799],{"class":192},[86,7033,6349],{"class":110},[86,7035,7036,7038,7040,7042,7044,7046,7048,7050],{"class":88,"line":199},[86,7037,1754],{"class":99},[86,7039,6808],{"class":124},[86,7041,107],{"class":99},[86,7043,6813],{"class":110},[86,7045,6816],{"class":103},[86,7047,507],{"class":110},[86,7049,6821],{"class":192},[86,7051,6349],{"class":110},[86,7053,7054,7057,7059],{"class":88,"line":205},[86,7055,7056],{"class":110},"  canvas.width ",[86,7058,305],{"class":99},[86,7060,6833],{"class":110},[86,7062,7063,7066,7068],{"class":88,"line":231},[86,7064,7065],{"class":110},"  canvas.height ",[86,7067,305],{"class":99},[86,7069,6843],{"class":110},[86,7071,7072,7075,7077,7079,7081,7083,7085],{"class":88,"line":251},[86,7073,7074],{"class":110},"  c.",[86,7076,6851],{"class":103},[86,7078,6854],{"class":110},[86,7080,6443],{"class":124},[86,7082,27],{"class":110},[86,7084,6443],{"class":124},[86,7086,6863],{"class":110},[86,7088,7089],{"class":88,"line":257},[86,7090,7091],{"class":295},"  // Get pixels array\n",[86,7093,7096,7098,7101,7103,7106,7109,7111,7113,7115,7117],{"class":7094,"line":263},[88,7095],"highlight",[86,7097,1754],{"class":99},[86,7099,7100],{"class":124}," pixels",[86,7102,107],{"class":99},[86,7104,7105],{"class":110}," c.",[86,7107,7108],{"class":103},"getImageData",[86,7110,507],{"class":110},[86,7112,6443],{"class":124},[86,7114,27],{"class":110},[86,7116,6443],{"class":124},[86,7118,6863],{"class":110},[86,7120,7121],{"class":88,"line":292},[86,7122,7123],{"class":295},"  // Get thumbhash (Uint8Array)\n",[86,7125,7127,7129,7132,7134,7137],{"class":7126,"line":299},[88,7095],[86,7128,1754],{"class":99},[86,7130,7131],{"class":124}," hash",[86,7133,107],{"class":99},[86,7135,7136],{"class":103}," rgbaToThumbHash",[86,7138,7139],{"class":110},"(w, h, pixels.data);\n",[86,7141,7142],{"class":88,"line":311},[86,7143,7144],{"class":295},"  // convert Uint8Array to base64 string\n",[86,7146,7148,7150,7153,7155,7158,7161,7163,7166],{"class":7147,"line":322},[88,7095],[86,7149,1754],{"class":99},[86,7151,7152],{"class":124}," binString",[86,7154,107],{"class":99},[86,7156,7157],{"class":110}," String.",[86,7159,7160],{"class":103},"fromCodePoint",[86,7162,507],{"class":110},[86,7164,7165],{"class":99},"...",[86,7167,7168],{"class":110},"hash);\n",[86,7170,7171,7173,7176],{"class":88,"line":328},[86,7172,1118],{"class":99},[86,7174,7175],{"class":103}," btoa",[86,7177,7178],{"class":110},"(binString);\n",[86,7180,7181],{"class":88,"line":353},[86,7182,158],{"class":110},[16,7184,7185],{},"В результате этих махинаций мы получаем такую строку",[76,7187,7191],{"className":7188,"code":7189,"language":7190,"meta":82,"style":82},"language-txt shiki shiki-themes github-light github-dark","0ucJJgoHiHeId5eYV4d3hneYiHiPiPc=\n","txt",[20,7192,7193],{"__ignoreMap":82},[86,7194,7195],{"class":88,"line":89},[86,7196,7189],{},[16,7198,7199],{},"Весит она всего 32 байта",[76,7201,7203],{"className":78,"code":7202,"language":81,"meta":82,"style":82},"new Blob([\"0ucJJgoHiHeId5eYV4d3hneYiHiPiPc=\"]).size; // 32\n",[20,7204,7205],{"__ignoreMap":82},[86,7206,7207,7210,7213,7216,7219,7222],{"class":88,"line":89},[86,7208,7209],{"class":99},"new",[86,7211,7212],{"class":103}," Blob",[86,7214,7215],{"class":110},"([",[86,7217,7218],{"class":192},"\"0ucJJgoHiHeId5eYV4d3hneYiHiPiPc=\"",[86,7220,7221],{"class":110},"]).size; ",[86,7223,7224],{"class":295},"// 32\n",[16,7226,7227],{},"Ее можно сохранить на сервере и присылать вместе с объектом поста",[76,7229,7231],{"className":78,"code":7230,"language":81,"meta":82,"style":82},"[\n  {\n    id: '1',\n    title: 'Post title',\n    image: '/path/to/image1.png',\n    thumbhash: '0ucJJgoHiHeId5eYV4d3hneYiHiPiPc=',\n  },\n  // ...\n];\n",[20,7232,7233,7238,7243,7253,7263,7273,7283,7287,7292],{"__ignoreMap":82},[86,7234,7235],{"class":88,"line":89},[86,7236,7237],{"class":110},"[\n",[86,7239,7240],{"class":88,"line":96},[86,7241,7242],{"class":110},"  {\n",[86,7244,7245,7248,7251],{"class":88,"line":114},[86,7246,7247],{"class":110},"    id: ",[86,7249,7250],{"class":192},"'1'",[86,7252,196],{"class":110},[86,7254,7255,7258,7261],{"class":88,"line":131},[86,7256,7257],{"class":110},"    title: ",[86,7259,7260],{"class":192},"'Post title'",[86,7262,196],{"class":110},[86,7264,7265,7268,7271],{"class":88,"line":143},[86,7266,7267],{"class":110},"    image: ",[86,7269,7270],{"class":192},"'/path/to/image1.png'",[86,7272,196],{"class":110},[86,7274,7275,7278,7281],{"class":88,"line":155},[86,7276,7277],{"class":110},"    thumbhash: ",[86,7279,7280],{"class":192},"'0ucJJgoHiHeId5eYV4d3hneYiHiPiPc='",[86,7282,196],{"class":110},[86,7284,7285],{"class":88,"line":161},[86,7286,254],{"class":110},[86,7288,7289],{"class":88,"line":166},[86,7290,7291],{"class":295},"  // ...\n",[86,7293,7294],{"class":88,"line":186},[86,7295,6446],{"class":110},[16,7297,7298],{},"Далее на клиенте нужно преобразовать ее сначала в Uint8Array, а затем в base64 картинку",[76,7300,7302],{"className":78,"code":7301,"language":81,"meta":82,"style":82},"const thumbToImageSrc = (thumb: string) => {\n  const binString = atob(thumb);\n  const data = Uint8Array.from(binString, (m) => m.codePointAt(0));\n  const src = thumbHashToDataURL(data);\n  return src;\n};\n",[20,7303,7304,7328,7342,7378,7392,7399],{"__ignoreMap":82},[86,7305,7306,7308,7311,7313,7315,7318,7320,7322,7324,7326],{"class":88,"line":89},[86,7307,497],{"class":99},[86,7309,7310],{"class":103}," thumbToImageSrc",[86,7312,107],{"class":99},[86,7314,1381],{"class":110},[86,7316,7317],{"class":117},"thumb",[86,7319,121],{"class":99},[86,7321,125],{"class":124},[86,7323,284],{"class":110},[86,7325,287],{"class":99},[86,7327,111],{"class":110},[86,7329,7330,7332,7334,7336,7339],{"class":88,"line":96},[86,7331,1754],{"class":99},[86,7333,7152],{"class":124},[86,7335,107],{"class":99},[86,7337,7338],{"class":103}," atob",[86,7340,7341],{"class":110},"(thumb);\n",[86,7343,7344,7346,7349,7351,7354,7356,7359,7362,7364,7366,7369,7372,7374,7376],{"class":88,"line":114},[86,7345,1754],{"class":99},[86,7347,7348],{"class":124}," data",[86,7350,107],{"class":99},[86,7352,7353],{"class":110}," Uint8Array.",[86,7355,2802],{"class":103},[86,7357,7358],{"class":110},"(binString, (",[86,7360,7361],{"class":117},"m",[86,7363,284],{"class":110},[86,7365,287],{"class":99},[86,7367,7368],{"class":110}," m.",[86,7370,7371],{"class":103},"codePointAt",[86,7373,507],{"class":110},[86,7375,6443],{"class":124},[86,7377,527],{"class":110},[86,7379,7380,7382,7384,7386,7389],{"class":88,"line":131},[86,7381,1754],{"class":99},[86,7383,6540],{"class":124},[86,7385,107],{"class":99},[86,7387,7388],{"class":103}," thumbHashToDataURL",[86,7390,7391],{"class":110},"(data);\n",[86,7393,7394,7396],{"class":88,"line":143},[86,7395,1118],{"class":99},[86,7397,7398],{"class":110}," src;\n",[86,7400,7401],{"class":88,"line":155},[86,7402,931],{"class":110},[16,7404,7405],{},"Наконец нам нужен компонент, который будет запускать загрузку оригинальной картинки и отображать thumbhash миниатюру на время загрузки",[76,7407,7409],{"className":5695,"code":7408,"language":5698,"meta":82,"style":82},"type ProgressiveImageProps = {\n    src: string;\n    thumbHash: string;\n}\n\nconst ProgressiveImage: React.FC\u003CProgressiveImageProps> = ({ src: originalImageSrc, thumbHash }) => {\n  const thumb = useMemo(() => thumbHash ? thumbToImageSrc(thumbHash) : null, [thumbHash]);\n  const [imgSrc, setImgSrc] = useState(thumb ? thumb : originalImageSrc);\n\n  const loadOriginalImage = useCallback(async () => {\n    await loadImage(originalImageSrc);\n    setImgSrc(originalImageSrc);\n  }, [originalImageSrc]);\n\n  useEffect(() => {\n    if (thumbHash ) {\n      loadOriginalImage();\n    };\n  }, [loadOriginalImage, thumbHash]);\n\n  return (\n    \u003Cimg src={imgSrc} />\n  );\n};\n",[20,7410,7411,7422,7433,7444,7448,7452,7500,7535,7568,7572,7593,7603,7610,7615,7619,7630,7638,7645,7649,7654,7658,7664,7677,7681],{"__ignoreMap":82},[86,7412,7413,7415,7418,7420],{"class":88,"line":89},[86,7414,100],{"class":99},[86,7416,7417],{"class":103}," ProgressiveImageProps",[86,7419,107],{"class":99},[86,7421,111],{"class":110},[86,7423,7424,7427,7429,7431],{"class":88,"line":96},[86,7425,7426],{"class":117},"    src",[86,7428,121],{"class":99},[86,7430,125],{"class":124},[86,7432,128],{"class":110},[86,7434,7435,7438,7440,7442],{"class":88,"line":114},[86,7436,7437],{"class":117},"    thumbHash",[86,7439,121],{"class":99},[86,7441,125],{"class":124},[86,7443,128],{"class":110},[86,7445,7446],{"class":88,"line":131},[86,7447,158],{"class":110},[86,7449,7450],{"class":88,"line":143},[86,7451,93],{"emptyLinePlaceholder":92},[86,7453,7454,7456,7459,7461,7463,7465,7468,7470,7473,7475,7477,7480,7483,7486,7488,7490,7493,7496,7498],{"class":88,"line":155},[86,7455,497],{"class":99},[86,7457,7458],{"class":103}," ProgressiveImage",[86,7460,121],{"class":99},[86,7462,6381],{"class":103},[86,7464,38],{"class":110},[86,7466,7467],{"class":103},"FC",[86,7469,217],{"class":110},[86,7471,7472],{"class":103},"ProgressiveImageProps",[86,7474,669],{"class":110},[86,7476,305],{"class":99},[86,7478,7479],{"class":110}," ({ ",[86,7481,7482],{"class":117},"src",[86,7484,7485],{"class":110},": ",[86,7487,6328],{"class":117},[86,7489,27],{"class":110},[86,7491,7492],{"class":117},"thumbHash",[86,7494,7495],{"class":110}," }) ",[86,7497,287],{"class":99},[86,7499,111],{"class":110},[86,7501,7502,7504,7507,7509,7512,7514,7516,7519,7522,7524,7527,7529,7532],{"class":88,"line":161},[86,7503,1754],{"class":99},[86,7505,7506],{"class":124}," thumb",[86,7508,107],{"class":99},[86,7510,7511],{"class":103}," useMemo",[86,7513,548],{"class":110},[86,7515,287],{"class":99},[86,7517,7518],{"class":110}," thumbHash ",[86,7520,7521],{"class":99},"?",[86,7523,7310],{"class":103},[86,7525,7526],{"class":110},"(thumbHash) ",[86,7528,121],{"class":99},[86,7530,7531],{"class":124}," null",[86,7533,7534],{"class":110},", [thumbHash]);\n",[86,7536,7537,7539,7541,7544,7546,7549,7551,7553,7555,7558,7560,7563,7565],{"class":88,"line":166},[86,7538,1754],{"class":99},[86,7540,6325],{"class":110},[86,7542,7543],{"class":124},"imgSrc",[86,7545,27],{"class":110},[86,7547,7548],{"class":124},"setImgSrc",[86,7550,6336],{"class":110},[86,7552,305],{"class":99},[86,7554,6341],{"class":103},[86,7556,7557],{"class":110},"(thumb ",[86,7559,7521],{"class":99},[86,7561,7562],{"class":110}," thumb ",[86,7564,121],{"class":99},[86,7566,7567],{"class":110}," originalImageSrc);\n",[86,7569,7570],{"class":88,"line":186},[86,7571,93],{"emptyLinePlaceholder":92},[86,7573,7574,7576,7579,7581,7583,7585,7587,7589,7591],{"class":88,"line":199},[86,7575,1754],{"class":99},[86,7577,7578],{"class":124}," loadOriginalImage",[86,7580,107],{"class":99},[86,7582,545],{"class":103},[86,7584,507],{"class":110},[86,7586,6917],{"class":99},[86,7588,2670],{"class":110},[86,7590,287],{"class":99},[86,7592,111],{"class":110},[86,7594,7595,7598,7600],{"class":88,"line":205},[86,7596,7597],{"class":99},"    await",[86,7599,6113],{"class":103},[86,7601,7602],{"class":110},"(originalImageSrc);\n",[86,7604,7605,7608],{"class":88,"line":231},[86,7606,7607],{"class":103},"    setImgSrc",[86,7609,7602],{"class":110},[86,7611,7612],{"class":88,"line":251},[86,7613,7614],{"class":110},"  }, [originalImageSrc]);\n",[86,7616,7617],{"class":88,"line":257},[86,7618,93],{"emptyLinePlaceholder":92},[86,7620,7621,7624,7626,7628],{"class":88,"line":263},[86,7622,7623],{"class":103},"  useEffect",[86,7625,548],{"class":110},[86,7627,287],{"class":99},[86,7629,111],{"class":110},[86,7631,7632,7635],{"class":88,"line":292},[86,7633,7634],{"class":99},"    if",[86,7636,7637],{"class":110}," (thumbHash ) {\n",[86,7639,7640,7643],{"class":88,"line":299},[86,7641,7642],{"class":103},"      loadOriginalImage",[86,7644,6174],{"class":110},[86,7646,7647],{"class":88,"line":311},[86,7648,2079],{"class":110},[86,7650,7651],{"class":88,"line":322},[86,7652,7653],{"class":110},"  }, [loadOriginalImage, thumbHash]);\n",[86,7655,7656],{"class":88,"line":328},[86,7657,93],{"emptyLinePlaceholder":92},[86,7659,7660,7662],{"class":88,"line":353},[86,7661,1118],{"class":99},[86,7663,674],{"class":110},[86,7665,7666,7668,7670,7672,7674],{"class":88,"line":367},[86,7667,5785],{"class":110},[86,7669,2459],{"class":5777},[86,7671,6540],{"class":103},[86,7673,305],{"class":99},[86,7675,7676],{"class":110},"{imgSrc} />\n",[86,7678,7679],{"class":88,"line":376},[86,7680,623],{"class":110},[86,7682,7683],{"class":88,"line":383},[86,7684,931],{"class":110},[11,7686,7688],{"id":7687},"generate-thumbhash-on-server-side","Генерация thumbhash на сервере",[16,7690,7691,7692,7699],{},"Скорее всего будет использоваться ",[43,7693,7696],{"href":7694,"rel":7695},"https://developer.mozilla.org/ru/docs/Web/API/FormData",[47],[20,7697,7698],{},"FormData",", чтобы загрузить файл на сервер.",[76,7701,7703],{"className":78,"code":7702,"language":81,"meta":82,"style":82},"export async function POST(request: NextRequest) {\n  const formData = await request.formData();\n  const file = formData.get('file') as File;\n\n  if (!file) {\n    return NextResponse.json({\n      code: 'FILE_NOT_FOUND'\n    }, {\n      status: 404\n    });\n  }\n\n  const arrayBuffer = await file.arrayBuffer();\n  const buffer = Buffer.from(arrayBuffer);\n\n  const url = await uploadFile(buffer); // save file on your server somehow\n  const thumbhash = await generateThumbhash(buffer); // We need to implement this\n\n  return NextResponse.json({\n    url,\n    thumbhash\n  });\n}\n",[20,7704,7705,7729,7748,7775,7779,7791,7803,7811,7816,7824,7828,7832,7836,7855,7872,7876,7895,7914,7918,7928,7933,7938,7942],{"__ignoreMap":82},[86,7706,7707,7709,7712,7714,7717,7719,7722,7724,7727],{"class":88,"line":89},[86,7708,169],{"class":99},[86,7710,7711],{"class":99}," async",[86,7713,6312],{"class":99},[86,7715,7716],{"class":103}," POST",[86,7718,507],{"class":110},[86,7720,7721],{"class":117},"request",[86,7723,121],{"class":99},[86,7725,7726],{"class":103}," NextRequest",[86,7728,6416],{"class":110},[86,7730,7731,7733,7736,7738,7740,7743,7746],{"class":88,"line":96},[86,7732,1754],{"class":99},[86,7734,7735],{"class":124}," formData",[86,7737,107],{"class":99},[86,7739,6457],{"class":99},[86,7741,7742],{"class":110}," request.",[86,7744,7745],{"class":103},"formData",[86,7747,6174],{"class":110},[86,7749,7750,7752,7754,7756,7759,7762,7764,7767,7769,7771,7773],{"class":88,"line":114},[86,7751,1754],{"class":99},[86,7753,6435],{"class":124},[86,7755,107],{"class":99},[86,7757,7758],{"class":110}," formData.",[86,7760,7761],{"class":103},"get",[86,7763,507],{"class":110},[86,7765,7766],{"class":192},"'file'",[86,7768,284],{"class":110},[86,7770,211],{"class":99},[86,7772,6251],{"class":103},[86,7774,128],{"class":110},[86,7776,7777],{"class":88,"line":131},[86,7778,93],{"emptyLinePlaceholder":92},[86,7780,7781,7784,7786,7788],{"class":88,"line":143},[86,7782,7783],{"class":99},"  if",[86,7785,1381],{"class":110},[86,7787,6407],{"class":99},[86,7789,7790],{"class":110},"file) {\n",[86,7792,7793,7795,7798,7801],{"class":88,"line":155},[86,7794,1851],{"class":99},[86,7796,7797],{"class":110}," NextResponse.",[86,7799,7800],{"class":103},"json",[86,7802,183],{"class":110},[86,7804,7805,7808],{"class":88,"line":161},[86,7806,7807],{"class":110},"      code: ",[86,7809,7810],{"class":192},"'FILE_NOT_FOUND'\n",[86,7812,7813],{"class":88,"line":166},[86,7814,7815],{"class":110},"    }, {\n",[86,7817,7818,7821],{"class":88,"line":186},[86,7819,7820],{"class":110},"      status: ",[86,7822,7823],{"class":124},"404\n",[86,7825,7826],{"class":88,"line":199},[86,7827,1964],{"class":110},[86,7829,7830],{"class":88,"line":205},[86,7831,429],{"class":110},[86,7833,7834],{"class":88,"line":231},[86,7835,93],{"emptyLinePlaceholder":92},[86,7837,7838,7840,7843,7845,7847,7850,7853],{"class":88,"line":251},[86,7839,1754],{"class":99},[86,7841,7842],{"class":124}," arrayBuffer",[86,7844,107],{"class":99},[86,7846,6457],{"class":99},[86,7848,7849],{"class":110}," file.",[86,7851,7852],{"class":103},"arrayBuffer",[86,7854,6174],{"class":110},[86,7856,7857,7859,7862,7864,7867,7869],{"class":88,"line":257},[86,7858,1754],{"class":99},[86,7860,7861],{"class":124}," buffer",[86,7863,107],{"class":99},[86,7865,7866],{"class":110}," Buffer.",[86,7868,2802],{"class":103},[86,7870,7871],{"class":110},"(arrayBuffer);\n",[86,7873,7874],{"class":88,"line":263},[86,7875,93],{"emptyLinePlaceholder":92},[86,7877,7878,7880,7882,7884,7886,7889,7892],{"class":88,"line":292},[86,7879,1754],{"class":99},[86,7881,6274],{"class":124},[86,7883,107],{"class":99},[86,7885,6457],{"class":99},[86,7887,7888],{"class":103}," uploadFile",[86,7890,7891],{"class":110},"(buffer); ",[86,7893,7894],{"class":295},"// save file on your server somehow\n",[86,7896,7897,7899,7902,7904,7906,7909,7911],{"class":88,"line":299},[86,7898,1754],{"class":99},[86,7900,7901],{"class":124}," thumbhash",[86,7903,107],{"class":99},[86,7905,6457],{"class":99},[86,7907,7908],{"class":103}," generateThumbhash",[86,7910,7891],{"class":110},[86,7912,7913],{"class":295},"// We need to implement this\n",[86,7915,7916],{"class":88,"line":311},[86,7917,93],{"emptyLinePlaceholder":92},[86,7919,7920,7922,7924,7926],{"class":88,"line":322},[86,7921,1118],{"class":99},[86,7923,7797],{"class":110},[86,7925,7800],{"class":103},[86,7927,183],{"class":110},[86,7929,7930],{"class":88,"line":328},[86,7931,7932],{"class":110},"    url,\n",[86,7934,7935],{"class":88,"line":353},[86,7936,7937],{"class":110},"    thumbhash\n",[86,7939,7940],{"class":88,"line":367},[86,7941,2179],{"class":110},[86,7943,7944],{"class":88,"line":376},[86,7945,158],{"class":110},[7947,7948,7950],"h3",{"id":7949},"generate-thumbhash-on-server-side-using-canvas","При помощи canvas",[16,7952,7953,7954],{},"Чтобы сгенерировать thumbhash, нужно считать данные изображения, только вот сервере у нас нет нативной поддержки canvas и нужно будет воспользоваться сторонней библиотекой, например ",[43,7955,7956],{"href":7956,"rel":7957},"https://www.npmjs.com/package/canvas",[47],[76,7959,7961],{"className":78,"code":7960,"language":81,"meta":82,"style":82},"import { createCanvas, loadImage } from \"canvas\";\n\nasync function loadImageAndConvertToHashWithCanvas(\n  buffer: Buffer\n) {\n  const maxSize = 100;\n  // load image\n  const image = await loadImage(buffer);\n  const width = image.width;\n  const height = image.height;\n  // calculate new size\n  const scale = Math.min(maxSize / width, maxSize / height);\n  const resizedWidth = Math.floor(width * scale);\n  const resizedHeight = Math.floor(height * scale);\n  // create thumb with new size\n  const canvas = createCanvas(resizedWidth, resizedHeight);\n  const ctx = canvas.getContext(\"2d\");\n  ctx.drawImage(image, 0, 0, resizedWidth, resizedHeight);\n  // get pixels array\n  const imageData = ctx.getImageData(0, 0, resizedWidth, resizedHeight);\n  const rgba = new Uint8Array(imageData.data.buffer);\n  // generate thumbhash\n  const hash = rgbaToThumbHash(resizedWidth, resizedHeight, rgba);\n  // convert it to base64\n  const base64 = Buffer.from(hash).toString('base64');\n  return base64;\n}\n",[20,7962,7963,7977,7981,7992,8002,8006,8020,8025,8041,8053,8065,8070,8097,8120,8140,8145,8159,8179,8198,8203,8227,8244,8249,8262,8267,8293,8300],{"__ignoreMap":82},[86,7964,7965,7967,7970,7972,7975],{"class":88,"line":89},[86,7966,2788],{"class":99},[86,7968,7969],{"class":110}," { createCanvas, loadImage } ",[86,7971,2802],{"class":99},[86,7973,7974],{"class":192}," \"canvas\"",[86,7976,128],{"class":110},[86,7978,7979],{"class":88,"line":96},[86,7980,93],{"emptyLinePlaceholder":92},[86,7982,7983,7985,7987,7990],{"class":88,"line":114},[86,7984,6917],{"class":99},[86,7986,6312],{"class":99},[86,7988,7989],{"class":103}," loadImageAndConvertToHashWithCanvas",[86,7991,561],{"class":110},[86,7993,7994,7997,7999],{"class":88,"line":131},[86,7995,7996],{"class":117},"  buffer",[86,7998,121],{"class":99},[86,8000,8001],{"class":103}," Buffer\n",[86,8003,8004],{"class":88,"line":143},[86,8005,6416],{"class":110},[86,8007,8008,8010,8013,8015,8018],{"class":88,"line":155},[86,8009,1754],{"class":99},[86,8011,8012],{"class":124}," maxSize",[86,8014,107],{"class":99},[86,8016,8017],{"class":124}," 100",[86,8019,128],{"class":110},[86,8021,8022],{"class":88,"line":161},[86,8023,8024],{"class":295},"  // load image\n",[86,8026,8027,8029,8032,8034,8036,8038],{"class":88,"line":166},[86,8028,1754],{"class":99},[86,8030,8031],{"class":124}," image",[86,8033,107],{"class":99},[86,8035,6457],{"class":99},[86,8037,6113],{"class":103},[86,8039,8040],{"class":110},"(buffer);\n",[86,8042,8043,8045,8048,8050],{"class":88,"line":186},[86,8044,1754],{"class":99},[86,8046,8047],{"class":124}," width",[86,8049,107],{"class":99},[86,8051,8052],{"class":110}," image.width;\n",[86,8054,8055,8057,8060,8062],{"class":88,"line":199},[86,8056,1754],{"class":99},[86,8058,8059],{"class":124}," height",[86,8061,107],{"class":99},[86,8063,8064],{"class":110}," image.height;\n",[86,8066,8067],{"class":88,"line":205},[86,8068,8069],{"class":295},"  // calculate new size\n",[86,8071,8072,8074,8077,8079,8081,8084,8087,8089,8092,8094],{"class":88,"line":231},[86,8073,1754],{"class":99},[86,8075,8076],{"class":124}," scale",[86,8078,107],{"class":99},[86,8080,6699],{"class":110},[86,8082,8083],{"class":103},"min",[86,8085,8086],{"class":110},"(maxSize ",[86,8088,6737],{"class":99},[86,8090,8091],{"class":110}," width, maxSize ",[86,8093,6737],{"class":99},[86,8095,8096],{"class":110}," height);\n",[86,8098,8099,8101,8104,8106,8108,8111,8114,8117],{"class":88,"line":251},[86,8100,1754],{"class":99},[86,8102,8103],{"class":124}," resizedWidth",[86,8105,107],{"class":99},[86,8107,6699],{"class":110},[86,8109,8110],{"class":103},"floor",[86,8112,8113],{"class":110},"(width ",[86,8115,8116],{"class":99},"*",[86,8118,8119],{"class":110}," scale);\n",[86,8121,8122,8124,8127,8129,8131,8133,8136,8138],{"class":88,"line":257},[86,8123,1754],{"class":99},[86,8125,8126],{"class":124}," resizedHeight",[86,8128,107],{"class":99},[86,8130,6699],{"class":110},[86,8132,8110],{"class":103},[86,8134,8135],{"class":110},"(height ",[86,8137,8116],{"class":99},[86,8139,8119],{"class":110},[86,8141,8142],{"class":88,"line":263},[86,8143,8144],{"class":295},"  // create thumb with new size\n",[86,8146,8147,8149,8151,8153,8156],{"class":88,"line":292},[86,8148,1754],{"class":99},[86,8150,6786],{"class":124},[86,8152,107],{"class":99},[86,8154,8155],{"class":103}," createCanvas",[86,8157,8158],{"class":110},"(resizedWidth, resizedHeight);\n",[86,8160,8161,8163,8166,8168,8170,8172,8174,8177],{"class":88,"line":299},[86,8162,1754],{"class":99},[86,8164,8165],{"class":124}," ctx",[86,8167,107],{"class":99},[86,8169,6813],{"class":110},[86,8171,6816],{"class":103},[86,8173,507],{"class":110},[86,8175,8176],{"class":192},"\"2d\"",[86,8178,6349],{"class":110},[86,8180,8181,8184,8186,8189,8191,8193,8195],{"class":88,"line":311},[86,8182,8183],{"class":110},"  ctx.",[86,8185,6851],{"class":103},[86,8187,8188],{"class":110},"(image, ",[86,8190,6443],{"class":124},[86,8192,27],{"class":110},[86,8194,6443],{"class":124},[86,8196,8197],{"class":110},", resizedWidth, resizedHeight);\n",[86,8199,8200],{"class":88,"line":322},[86,8201,8202],{"class":295},"  // get pixels array\n",[86,8204,8205,8207,8210,8212,8215,8217,8219,8221,8223,8225],{"class":88,"line":328},[86,8206,1754],{"class":99},[86,8208,8209],{"class":124}," imageData",[86,8211,107],{"class":99},[86,8213,8214],{"class":110}," ctx.",[86,8216,7108],{"class":103},[86,8218,507],{"class":110},[86,8220,6443],{"class":124},[86,8222,27],{"class":110},[86,8224,6443],{"class":124},[86,8226,8197],{"class":110},[86,8228,8229,8231,8234,8236,8238,8241],{"class":88,"line":353},[86,8230,1754],{"class":99},[86,8232,8233],{"class":124}," rgba",[86,8235,107],{"class":99},[86,8237,6137],{"class":99},[86,8239,8240],{"class":103}," Uint8Array",[86,8242,8243],{"class":110},"(imageData.data.buffer);\n",[86,8245,8246],{"class":88,"line":367},[86,8247,8248],{"class":295},"  // generate thumbhash\n",[86,8250,8251,8253,8255,8257,8259],{"class":88,"line":376},[86,8252,1754],{"class":99},[86,8254,7131],{"class":124},[86,8256,107],{"class":99},[86,8258,7136],{"class":103},[86,8260,8261],{"class":110},"(resizedWidth, resizedHeight, rgba);\n",[86,8263,8264],{"class":88,"line":383},[86,8265,8266],{"class":295},"  // convert it to base64\n",[86,8268,8269,8271,8274,8276,8278,8280,8283,8286,8288,8291],{"class":88,"line":389},[86,8270,1754],{"class":99},[86,8272,8273],{"class":124}," base64",[86,8275,107],{"class":99},[86,8277,7866],{"class":110},[86,8279,2802],{"class":103},[86,8281,8282],{"class":110},"(hash).",[86,8284,8285],{"class":103},"toString",[86,8287,507],{"class":110},[86,8289,8290],{"class":192},"'base64'",[86,8292,6349],{"class":110},[86,8294,8295,8297],{"class":88,"line":394},[86,8296,1118],{"class":99},[86,8298,8299],{"class":110}," base64;\n",[86,8301,8302],{"class":88,"line":400},[86,8303,158],{"class":110},[7947,8305,8307],{"id":8306},"generate-thumbhash-on-server-side-using-sharp","При помощи sharp",[16,8309,8310,8311],{},"Так же можно воспользоваться библиотекой ",[20,8312,8313],{},"sharp",[76,8315,8317],{"className":78,"code":8316,"language":81,"meta":82,"style":82},"import sharp from \"sharp\";\n\nconst loadImageAndConvertToHashWithSharp = async (buffer: Buffer) => {\n  // load image\n  const sharpImage = sharp(buffer);\n  const imageMetadata = await sharpImage.metadata();\n  // calculate new size\n  const size = Math.max(imageMetadata.width || 1, imageMetadata.height || 1);\n  const w = Math.round(100 * (imageMetadata.width || 1) / size);\n  const h = Math.round(100 * (imageMetadata.height || 1) / size);\n  // create thumb with new size\n  const { data } = await sharpImage\n    .resize({\n      withoutEnlargement: true,\n      width: w,\n      height: h,\n    })\n    .ensureAlpha() // rgbaToThumbHash require 4 channals\n    .raw()\n    .toBuffer({ resolveWithObject: true });\n  // generate thumbhash\n  const hash = rgbaToThumbHash(w, h, data);\n  // convert it to base64\n  const base64 = Buffer.from(hash).toString('base64');\n  return base64;\n};\n",[20,8318,8319,8333,8337,8364,8368,8382,8401,8405,8435,8466,8497,8501,8519,8529,8539,8544,8549,8553,8566,8576,8591,8595,8608,8612,8634,8640],{"__ignoreMap":82},[86,8320,8321,8323,8326,8328,8331],{"class":88,"line":89},[86,8322,2788],{"class":99},[86,8324,8325],{"class":110}," sharp ",[86,8327,2802],{"class":99},[86,8329,8330],{"class":192}," \"sharp\"",[86,8332,128],{"class":110},[86,8334,8335],{"class":88,"line":96},[86,8336,93],{"emptyLinePlaceholder":92},[86,8338,8339,8341,8344,8346,8348,8350,8353,8355,8358,8360,8362],{"class":88,"line":114},[86,8340,497],{"class":99},[86,8342,8343],{"class":103}," loadImageAndConvertToHashWithSharp",[86,8345,107],{"class":99},[86,8347,7711],{"class":99},[86,8349,1381],{"class":110},[86,8351,8352],{"class":117},"buffer",[86,8354,121],{"class":99},[86,8356,8357],{"class":103}," Buffer",[86,8359,284],{"class":110},[86,8361,287],{"class":99},[86,8363,111],{"class":110},[86,8365,8366],{"class":88,"line":131},[86,8367,8024],{"class":295},[86,8369,8370,8372,8375,8377,8380],{"class":88,"line":143},[86,8371,1754],{"class":99},[86,8373,8374],{"class":124}," sharpImage",[86,8376,107],{"class":99},[86,8378,8379],{"class":103}," sharp",[86,8381,8040],{"class":110},[86,8383,8384,8386,8389,8391,8393,8396,8399],{"class":88,"line":155},[86,8385,1754],{"class":99},[86,8387,8388],{"class":124}," imageMetadata",[86,8390,107],{"class":99},[86,8392,6457],{"class":99},[86,8394,8395],{"class":110}," sharpImage.",[86,8397,8398],{"class":103},"metadata",[86,8400,6174],{"class":110},[86,8402,8403],{"class":88,"line":161},[86,8404,8069],{"class":295},[86,8406,8407,8409,8411,8413,8415,8417,8420,8423,8426,8429,8431,8433],{"class":88,"line":166},[86,8408,1754],{"class":99},[86,8410,6694],{"class":124},[86,8412,107],{"class":99},[86,8414,6699],{"class":110},[86,8416,6702],{"class":103},[86,8418,8419],{"class":110},"(imageMetadata.width ",[86,8421,8422],{"class":99},"||",[86,8424,8425],{"class":124}," 1",[86,8427,8428],{"class":110},", imageMetadata.height ",[86,8430,8422],{"class":99},[86,8432,8425],{"class":124},[86,8434,6349],{"class":110},[86,8436,8437,8439,8441,8443,8445,8447,8449,8451,8453,8456,8458,8460,8462,8464],{"class":88,"line":186},[86,8438,1754],{"class":99},[86,8440,6712],{"class":124},[86,8442,107],{"class":99},[86,8444,6699],{"class":110},[86,8446,6724],{"class":103},[86,8448,507],{"class":110},[86,8450,6729],{"class":124},[86,8452,6732],{"class":99},[86,8454,8455],{"class":110}," (imageMetadata.width ",[86,8457,8422],{"class":99},[86,8459,8425],{"class":124},[86,8461,284],{"class":110},[86,8463,6737],{"class":99},[86,8465,6740],{"class":110},[86,8467,8468,8470,8472,8474,8476,8478,8480,8482,8484,8487,8489,8491,8493,8495],{"class":88,"line":199},[86,8469,1754],{"class":99},[86,8471,6747],{"class":124},[86,8473,107],{"class":99},[86,8475,6699],{"class":110},[86,8477,6724],{"class":103},[86,8479,507],{"class":110},[86,8481,6729],{"class":124},[86,8483,6732],{"class":99},[86,8485,8486],{"class":110}," (imageMetadata.height ",[86,8488,8422],{"class":99},[86,8490,8425],{"class":124},[86,8492,284],{"class":110},[86,8494,6737],{"class":99},[86,8496,6740],{"class":110},[86,8498,8499],{"class":88,"line":205},[86,8500,8144],{"class":295},[86,8502,8503,8505,8507,8510,8512,8514,8516],{"class":88,"line":231},[86,8504,1754],{"class":99},[86,8506,1680],{"class":110},[86,8508,8509],{"class":124},"data",[86,8511,5666],{"class":110},[86,8513,305],{"class":99},[86,8515,6457],{"class":99},[86,8517,8518],{"class":110}," sharpImage\n",[86,8520,8521,8524,8527],{"class":88,"line":251},[86,8522,8523],{"class":110},"    .",[86,8525,8526],{"class":103},"resize",[86,8528,183],{"class":110},[86,8530,8531,8534,8537],{"class":88,"line":257},[86,8532,8533],{"class":110},"      withoutEnlargement: ",[86,8535,8536],{"class":124},"true",[86,8538,196],{"class":110},[86,8540,8541],{"class":88,"line":263},[86,8542,8543],{"class":110},"      width: w,\n",[86,8545,8546],{"class":88,"line":292},[86,8547,8548],{"class":110},"      height: h,\n",[86,8550,8551],{"class":88,"line":299},[86,8552,617],{"class":110},[86,8554,8555,8557,8560,8563],{"class":88,"line":311},[86,8556,8523],{"class":110},[86,8558,8559],{"class":103},"ensureAlpha",[86,8561,8562],{"class":110},"() ",[86,8564,8565],{"class":295},"// rgbaToThumbHash require 4 channals\n",[86,8567,8568,8570,8573],{"class":88,"line":322},[86,8569,8523],{"class":110},[86,8571,8572],{"class":103},"raw",[86,8574,8575],{"class":110},"()\n",[86,8577,8578,8580,8583,8586,8588],{"class":88,"line":328},[86,8579,8523],{"class":110},[86,8581,8582],{"class":103},"toBuffer",[86,8584,8585],{"class":110},"({ resolveWithObject: ",[86,8587,8536],{"class":124},[86,8589,8590],{"class":110}," });\n",[86,8592,8593],{"class":88,"line":353},[86,8594,8248],{"class":295},[86,8596,8597,8599,8601,8603,8605],{"class":88,"line":367},[86,8598,1754],{"class":99},[86,8600,7131],{"class":124},[86,8602,107],{"class":99},[86,8604,7136],{"class":103},[86,8606,8607],{"class":110},"(w, h, data);\n",[86,8609,8610],{"class":88,"line":376},[86,8611,8266],{"class":295},[86,8613,8614,8616,8618,8620,8622,8624,8626,8628,8630,8632],{"class":88,"line":383},[86,8615,1754],{"class":99},[86,8617,8273],{"class":124},[86,8619,107],{"class":99},[86,8621,7866],{"class":110},[86,8623,2802],{"class":103},[86,8625,8282],{"class":110},[86,8627,8285],{"class":103},[86,8629,507],{"class":110},[86,8631,8290],{"class":192},[86,8633,6349],{"class":110},[86,8635,8636,8638],{"class":88,"line":389},[86,8637,1118],{"class":99},[86,8639,8299],{"class":110},[86,8641,8642],{"class":88,"line":394},[86,8643,931],{"class":110},[5980,8645,8646],{},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .s4XuR, html code.shiki .s4XuR{--shiki-default:#E36209;--shiki-dark:#FFAB70}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .s9eBZ, html code.shiki .s9eBZ{--shiki-default:#22863A;--shiki-dark:#85E89D}",{"title":82,"searchDepth":96,"depth":96,"links":8648},[8649,8650,8651],{"id":6014,"depth":96,"text":6015},{"id":6072,"depth":96,"text":6073},{"id":7687,"depth":96,"text":7688,"children":8652},[8653,8654],{"id":7949,"depth":114,"text":7950},{"id":8306,"depth":114,"text":8307},"2024-01-22","Прогрессивная загрузка изображений при помощи создания миниатюр в thumbhash и их использование в React",{},"/blog/progressive-images-using-thumbhash","/images/image-thumb-preview.webp",{"title":6009,"description":8656},"blog/progressive-images-using-thumbhash",[8663,6002,8664],"images","node.js","3LPPKEE8XZT4UIR2vkmVIVrk9_jr5rlo_-Di3FuX-KE",1751114697170]